import{Q as ya}from"./QPage-DqAH0F3p.js";import{x as We,j as S,y as U,z as Xe,l as z,O as da,Q as ca,I as ka,B as ma,D as Ue,ah as qa,ai as Sa,aj as wa,aa as Aa,ak as Fa,al as Ca,a as ie,b as ve,n as X,p as R,a2 as ce,h as n,g as d,a1 as la,w as c,f as L,t as w,o as x,k as qe,R as Re,e as F,S as Y,a3 as K,s as O,U as Pe,T as Je,q as B,af as ja,ac as Te,a6 as Da,ag as Ea,v as re,i as Ye,V as za}from"./index-B4QQtCX7.js";import{Q as Ee}from"./QSpinnerHourglass-BJSb96dH.js";import{a as oa,Q as J}from"./QBtn-C-aNyInZ.js";import{Q as sa}from"./ClosePopup-DMTUaPG6.js";import{d as me,a as Ke,_ as je,Q as Ve,b as he,c as Ia,e as Be,u as ue}from"./CustomErrorBanner.vue_vue_type_script_setup_true_lang-DBTLD8xq.js";import{a as be,Q as Ne,b as xe}from"./QCardSection-7odpSX0S.js";import{c as Ua,d as Ra,_ as Me}from"./_plugin-vue_export-helper-BlOQ7VLK.js";import{d as $e,Q as Ie,c as fe,_ as Fe}from"./QItem-BX9y_1c8.js";import{e as Pa,f as Ma,u as $a,b as Ta,v as Va,Q as oe,a as Le}from"./use-timeout-Dk6CO65c.js";import{b as Ba,h as na,a as Q,f as Na}from"./bus-CVwhliaE.js";import{b as Qa,a as Ae}from"./api-CoAF7EnE.js";import{u as fa}from"./useFormUtils-0r598LcF.js";import{d as ra,c as _e,_ as Oa,D as La,N as Ha,A as Ga}from"./document-BWekl-9c.js";import{u as Wa}from"./serverEnvironment-AswETgyQ.js";import{I as Xa}from"./InteractiveTagsFieldCustomSelect-owqF6o8u.js";import{Q as Ce}from"./QInput-CjvEs_If.js";import{Q as Qe}from"./QItemLabel-CGAxV7IM.js";import{Q as va,a as ye,D as ia}from"./dateTime-BFTmAOKA.js";import{g as pa}from"./common-CaK3FoAb.js";import{Q as Ja}from"./QMarkupTable-DelunEBn.js";import{c as de}from"./dateUtils-tkffsgZl.js";import"./scroll-CCWCkPPq.js";import"./session-BvJG7K2f.js";import"./index-CG2WSiiR.js";import"./QSelect-Dvj2_7Nw.js";import"./BrowseByTagButton.vue_vue_type_script_setup_true_lang-BqhrY0lq.js";const Ya=["top","middle","bottom"],Oe=We({name:"QBadge",props:{color:String,textColor:String,floating:Boolean,transparent:Boolean,multiLine:Boolean,outline:Boolean,rounded:Boolean,label:[Number,String],align:{type:String,validator:e=>Ya.includes(e)}},setup(e,{slots:o}){const r=S(()=>e.align!==void 0?{verticalAlign:e.align}:null),u=S(()=>{const p=e.outline===!0&&e.color||e.textColor;return`q-badge flex inline items-center no-wrap q-badge--${e.multiLine===!0?"multi":"single"}-line`+(e.outline===!0?" q-badge--outline":e.color!==void 0?` bg-${e.color}`:"")+(p!==void 0?` text-${p}`:"")+(e.floating===!0?" q-badge--floating":"")+(e.rounded===!0?" q-badge--rounded":"")+(e.transparent===!0?" q-badge--transparent":"")});return()=>U("div",{class:u.value,style:r.value,role:"status","aria-label":e.label},Ua(o.default,e.label!==void 0?[e.label]:[]))}}),Ka={...Pa,min:{type:Number,default:0},max:{type:Number,default:100},color:String,centerColor:String,trackColor:String,fontSize:String,rounded:Boolean,thickness:{type:Number,default:.2,validator:e=>e>=0&&e<=1},angle:{type:Number,default:0},showValue:Boolean,reverse:Boolean,instantFeedback:Boolean},He=50,ga=2*He,ha=ga*Math.PI,Za=Math.round(ha*1e3)/1e3,et=We({name:"QCircularProgress",props:{...Ka,value:{type:Number,default:0},animationSpeed:{type:[String,Number],default:600},indeterminate:Boolean},setup(e,{slots:o}){const{proxy:{$q:r}}=Xe(),u=Ma(e),p=S(()=>{const b=(r.lang.rtl===!0?-1:1)*e.angle;return{transform:e.reverse!==(r.lang.rtl===!0)?`scale3d(-1, 1, 1) rotate3d(0, 0, 1, ${-90-b}deg)`:`rotate3d(0, 0, 1, ${b-90}deg)`}}),_=S(()=>e.instantFeedback!==!0&&e.indeterminate!==!0?{transition:`stroke-dashoffset ${e.animationSpeed}ms ease 0s, stroke ${e.animationSpeed}ms ease`}:""),q=S(()=>ga/(1-e.thickness/2)),m=S(()=>`${q.value/2} ${q.value/2} ${q.value} ${q.value}`),A=S(()=>Ba(e.value,e.min,e.max)),k=S(()=>e.max-e.min),l=S(()=>e.thickness/2*q.value),C=S(()=>{const b=(e.max-A.value)/k.value,a=e.rounded===!0&&A.value<e.max&&b<.25?l.value/2*(1-b/.25):0;return ha*b+a});function j({thickness:b,offset:a,color:h,cls:T,rounded:t}){return U("circle",{class:"q-circular-progress__"+T+(h!==void 0?` text-${h}`:""),style:_.value,fill:"transparent",stroke:"currentColor","stroke-width":b,"stroke-dasharray":Za,"stroke-dashoffset":a,"stroke-linecap":t,cx:q.value,cy:q.value,r:He})}return()=>{const b=[];e.centerColor!==void 0&&e.centerColor!=="transparent"&&b.push(U("circle",{class:`q-circular-progress__center text-${e.centerColor}`,fill:"currentColor",r:He-l.value/2,cx:q.value,cy:q.value})),e.trackColor!==void 0&&e.trackColor!=="transparent"&&b.push(j({cls:"track",thickness:l.value,offset:0,color:e.trackColor})),b.push(j({cls:"circle",thickness:l.value,offset:C.value,color:e.color,rounded:e.rounded===!0?"round":void 0}));const a=[U("svg",{class:"q-circular-progress__svg",style:p.value,viewBox:m.value,"aria-hidden":"true"},b)];return e.showValue===!0&&a.push(U("div",{class:"q-circular-progress__text absolute-full row flex-center content-center",style:{fontSize:e.fontSize}},o.default!==void 0?o.default():[U("div",A.value)])),U("div",{class:`q-circular-progress q-circular-progress--${e.indeterminate===!0?"in":""}determinate`,style:u.value,role:"progressbar","aria-valuemin":e.min,"aria-valuemax":e.max,"aria-valuenow":e.indeterminate===!0?void 0:A.value},Ra(o.internal,a))}}});function ke(e,o,r,u){const p=[];return e.forEach(_=>{u(_)===!0?p.push(_):o.push({failedPropValidation:r,file:_})}),p}function ze(e){e?.dataTransfer&&(e.dataTransfer.dropEffect="copy"),ca(e)}const at={multiple:Boolean,accept:String,capture:String,maxFileSize:[Number,String],maxTotalSize:[Number,String],maxFiles:[Number,String],filter:Function},tt=["rejected"];function lt({editable:e,dnd:o,getFileInput:r,addFilesToQueue:u}){const{props:p,emit:_,proxy:q}=Xe(),m=z(null),A=S(()=>p.accept!==void 0?p.accept.split(",").map(f=>(f=f.trim(),f==="*"?"*/":(f.endsWith("/*")&&(f=f.slice(0,f.length-1)),f.toUpperCase()))):null),k=S(()=>parseInt(p.maxFiles,10)),l=S(()=>parseInt(p.maxTotalSize,10));function C(f){if(e.value)if(f!==Object(f)&&(f={target:null}),f.target?.matches('input[type="file"]')===!0)f.clientX===0&&f.clientY===0&&da(f);else{const g=r();g!==f.target&&g?.click(f)}}function j(f){e.value&&f&&u(null,f)}function b(f,g,N,$){let E=Array.from(g||f.target.files);const P=[],H=()=>{P.length!==0&&_("rejected",P)};if(p.accept!==void 0&&A.value.indexOf("*/")===-1&&(E=ke(E,P,"accept",I=>A.value.some(V=>I.type.toUpperCase().startsWith(V)||I.name.toUpperCase().endsWith(V))),E.length===0))return H();if(p.maxFileSize!==void 0){const I=parseInt(p.maxFileSize,10);if(E=ke(E,P,"max-file-size",V=>V.size<=I),E.length===0)return H()}if(p.multiple!==!0&&E.length!==0&&(E=[E[0]]),E.forEach(I=>{I.__key=I.webkitRelativePath+I.lastModified+I.name+I.size}),$===!0){const I=N.map(V=>V.__key);E=ke(E,P,"duplicate",V=>I.includes(V.__key)===!1)}if(E.length===0)return H();if(p.maxTotalSize!==void 0){let I=$===!0?N.reduce((V,ee)=>V+ee.size,0):0;if(E=ke(E,P,"max-total-size",V=>(I+=V.size,I<=l.value)),E.length===0)return H()}if(typeof p.filter=="function"){const I=p.filter(E);E=ke(E,P,"filter",V=>I.includes(V))}if(p.maxFiles!==void 0){let I=$===!0?N.length:0;if(E=ke(E,P,"max-files",()=>(I++,I<=k.value)),E.length===0)return H()}if(H(),E.length!==0)return E}function a(f){ze(f),o.value!==!0&&(o.value=!0)}function h(f){ca(f),(f.relatedTarget!==null||ka.is.safari!==!0?f.relatedTarget!==m.value:document.elementsFromPoint(f.clientX,f.clientY).includes(m.value)===!1)===!0&&(o.value=!1)}function T(f){ze(f);const g=f.dataTransfer.files;g.length!==0&&u(null,g),o.value=!1}function t(f){if(o.value===!0)return U("div",{ref:m,class:`q-${f}__dnd absolute-full`,onDragenter:ze,onDragover:ze,onDragleave:h,onDrop:T})}return Object.assign(q,{pickFiles:C,addFiles:j}),{pickFiles:C,addFiles:j,onDragover:a,onDragleave:h,processFiles:b,getDndNode:t,maxFilesNumber:k,maxTotalSizeNumber:l}}function ua(e){return(e*100).toFixed(2)+"%"}const ot={...$a,...at,label:String,color:String,textColor:String,square:Boolean,flat:Boolean,bordered:Boolean,noThumbnails:Boolean,thumbnailFit:{type:String,default:"cover"},autoUpload:Boolean,hideUploadBtn:Boolean,disable:Boolean,readonly:Boolean},ba=[...tt,"start","finish","added","removed"];function st(e,o){const r=Xe(),{props:u,slots:p,emit:_,proxy:q}=r,{$q:m}=q,A=Ta(u,m);function k(v,M,G){if(v.__status=M,M==="idle"){v.__uploaded=0,v.__progress=0,v.__sizeLabel=na(v.size),v.__progressLabel="0.00%";return}if(M==="failed"){q.$forceUpdate();return}v.__uploaded=M==="uploaded"?v.size:G,v.__progress=M==="uploaded"?1:Math.min(.9999,v.__uploaded/v.size),v.__progressLabel=ua(v.__progress),q.$forceUpdate()}const l=S(()=>u.disable!==!0&&u.readonly!==!0),C=z(!1),j=z(null),b=z(null),a={files:z([]),queuedFiles:z([]),uploadedFiles:z([]),uploadedSize:z(0),updateFileStatus:k,isAlive:()=>Va(r)===!1},{pickFiles:h,addFiles:T,onDragover:t,onDragleave:f,processFiles:g,getDndNode:N,maxFilesNumber:$,maxTotalSizeNumber:E}=lt({editable:l,dnd:C,getFileInput:y,addFilesToQueue:Ze});Object.assign(a,e({props:u,slots:p,emit:_,helpers:a,exposeApi:v=>{Object.assign(a,v)}})),a.isBusy===void 0&&(a.isBusy=z(!1));const P=z(0),H=S(()=>P.value===0?0:a.uploadedSize.value/P.value),I=S(()=>ua(H.value)),V=S(()=>na(P.value)),ee=S(()=>l.value===!0&&a.isUploading.value!==!0&&(u.multiple===!0||a.queuedFiles.value.length===0)&&(u.maxFiles===void 0||a.files.value.length<$.value)&&(u.maxTotalSize===void 0||P.value<E.value)),D=S(()=>l.value===!0&&a.isBusy.value!==!0&&a.isUploading.value!==!0&&a.queuedFiles.value.length!==0);Aa(Fa,aa);const ae=S(()=>"q-uploader column no-wrap"+(A.value===!0?" q-uploader--dark q-dark":"")+(u.bordered===!0?" q-uploader--bordered":"")+(u.square===!0?" q-uploader--square no-border-radius":"")+(u.flat===!0?" q-uploader--flat no-shadow":"")+(u.disable===!0?" disabled q-uploader--disable":"")+(C.value===!0?" q-uploader--dnd":"")),se=S(()=>"q-uploader__header"+(u.color!==void 0?` bg-${u.color}`:"")+(u.textColor!==void 0?` text-${u.textColor}`:""));ma(a.isUploading,(v,M)=>{M===!1&&v===!0?_("start"):M===!0&&v===!1&&_("finish")});function ne(){u.disable===!1&&(a.abort(),a.uploadedSize.value=0,P.value=0,i(),a.files.value=[],a.queuedFiles.value=[],a.uploadedFiles.value=[])}function Z(){u.disable===!1&&De(["uploaded"],()=>{a.uploadedFiles.value=[]})}function pe(){De(["idle","failed"],({size:v})=>{P.value-=v,a.queuedFiles.value=[]})}function De(v,M){if(u.disable===!0)return;const G={files:[],size:0},te=a.files.value.filter(W=>v.indexOf(W.__status)===-1?!0:(G.size+=W.size,G.files.push(W),W.__img!==void 0&&window.URL.revokeObjectURL(W.__img.src),!1));G.files.length!==0&&(a.files.value=te,M(G),_("removed",G.files))}function s(v){u.disable||(v.__status==="uploaded"?a.uploadedFiles.value=a.uploadedFiles.value.filter(M=>M.__key!==v.__key):v.__status==="uploading"?v.__abort():P.value-=v.size,a.files.value=a.files.value.filter(M=>M.__key!==v.__key?!0:(M.__img!==void 0&&window.URL.revokeObjectURL(M.__img.src),!1)),a.queuedFiles.value=a.queuedFiles.value.filter(M=>M.__key!==v.__key),_("removed",[v]))}function i(){a.files.value.forEach(v=>{v.__img!==void 0&&window.URL.revokeObjectURL(v.__img.src)})}function y(){return b.value||j.value.getElementsByClassName("q-uploader__input")[0]}function Ze(v,M){const G=g(v,M,a.files.value,!0),te=y();te!=null&&(te.value=""),G!==void 0&&(G.forEach(W=>{if(a.updateFileStatus(W,"idle"),P.value+=W.size,u.noThumbnails!==!0&&W.type.toUpperCase().startsWith("IMAGE")){const ta=new Image;ta.src=window.URL.createObjectURL(W),W.__img=ta}}),a.files.value=a.files.value.concat(G),a.queuedFiles.value=a.queuedFiles.value.concat(G),_("added",G),u.autoUpload===!0&&a.upload())}function ea(){D.value===!0&&a.upload()}function Se(v,M,G){if(v===!0){const te={type:"a",key:M,icon:m.iconSet.uploader[M],flat:!0,dense:!0};let W;return M==="add"?(te.onClick=h,W=aa):te.onClick=G,U(J,te,W)}}function aa(){return U("input",{ref:b,class:"q-uploader__input overflow-hidden absolute-full",tabindex:-1,type:"file",title:"",accept:u.accept,multiple:u.multiple===!0?"multiple":void 0,capture:u.capture,onMousedown:da,onClick:h,onChange:Ze})}function xa(){return p.header!==void 0?p.header(ge):[U("div",{class:"q-uploader__header-content column"},[U("div",{class:"flex flex-center no-wrap q-gutter-xs"},[Se(a.queuedFiles.value.length!==0,"removeQueue",pe),Se(a.uploadedFiles.value.length!==0,"removeUploaded",Z),a.isUploading.value===!0?U(oa,{class:"q-uploader__spinner"}):null,U("div",{class:"col column justify-center"},[u.label!==void 0?U("div",{class:"q-uploader__title"},[u.label]):null,U("div",{class:"q-uploader__subtitle"},[V.value+" / "+I.value])]),Se(ee.value,"add"),Se(u.hideUploadBtn===!1&&D.value===!0,"upload",a.upload),Se(a.isUploading.value,"clear",a.abort)])])]}function _a(){return p.list!==void 0?p.list(ge):a.files.value.map(v=>U("div",{key:v.__key,class:"q-uploader__file relative-position"+(u.noThumbnails!==!0&&v.__img!==void 0?" q-uploader__file--img":"")+(v.__status==="failed"?" q-uploader__file--failed":v.__status==="uploaded"?" q-uploader__file--uploaded":""),style:u.noThumbnails!==!0&&v.__img!==void 0?{backgroundImage:'url("'+v.__img.src+'")',backgroundSize:u.thumbnailFit}:null},[U("div",{class:"q-uploader__file-header row flex-center no-wrap"},[v.__status==="failed"?U(oe,{class:"q-uploader__file-status",name:m.iconSet.type.negative,color:"negative"}):null,U("div",{class:"q-uploader__file-header-content col"},[U("div",{class:"q-uploader__title"},[v.name]),U("div",{class:"q-uploader__subtitle row items-center no-wrap"},[v.__sizeLabel+" / "+v.__progressLabel])]),v.__status==="uploading"?U(et,{value:v.__progress,min:0,max:1,indeterminate:v.__progress===0}):U(J,{round:!0,dense:!0,flat:!0,icon:m.iconSet.uploader[v.__status==="uploaded"?"done":"clear"],onClick:()=>{s(v)}})])]))}Ue(()=>{a.isUploading.value===!0&&a.abort(),a.files.value.length!==0&&i()});const ge={};for(const v in a)qa(a[v])===!0?Sa(ge,v,()=>a[v].value):ge[v]=a[v];return Object.assign(ge,{upload:ea,reset:ne,removeUploadedFiles:Z,removeQueuedFiles:pe,removeFile:s,pickFiles:h,addFiles:T}),wa(ge,{canAddFiles:()=>ee.value,canUpload:()=>D.value,uploadSizeLabel:()=>V.value,uploadProgressLabel:()=>I.value}),o({...a,upload:ea,reset:ne,removeUploadedFiles:Z,removeQueuedFiles:pe,removeFile:s,pickFiles:h,addFiles:T,canAddFiles:ee,canUpload:D,uploadSizeLabel:V,uploadProgressLabel:I}),()=>{const v=[U("div",{class:se.value},xa()),U("div",{class:"q-uploader__list scroll"},_a()),N("uploader")];a.isBusy.value===!0&&v.push(U("div",{class:"q-uploader__overlay absolute-full flex flex-center"},[U(oa)]));const M={ref:j,class:ae.value};return ee.value===!0&&Object.assign(M,{onDragover:t,onDragleave:f}),U("div",M,v)}}const nt=()=>!0;function rt(e){const o={};return e.forEach(r=>{o[r]=nt}),o}const it=rt(ba),ut=({name:e,props:o,emits:r,injectPlugin:u})=>We({name:e,props:{...ot,...o},emits:Ca(r)===!0?{...it,...r}:[...ba,...r],setup(p,{expose:_}){return st(u,_)}});function le(e){return typeof e=="function"?e:()=>e}const dt="QUploader",ct={url:[Function,String],method:{type:[Function,String],default:"POST"},fieldName:{type:[Function,String],default:()=>e=>e.name},headers:[Function,Array],formFields:[Function,Array],withCredentials:[Function,Boolean],sendRaw:[Function,Boolean],batch:[Function,Boolean],factory:Function},mt=["factoryFailed","uploaded","failed","uploading"];function ft({props:e,emit:o,helpers:r}){const u=z([]),p=z([]),_=z(0),q=S(()=>({url:le(e.url),method:le(e.method),headers:le(e.headers),formFields:le(e.formFields),fieldName:le(e.fieldName),withCredentials:le(e.withCredentials),sendRaw:le(e.sendRaw),batch:le(e.batch)})),m=S(()=>_.value>0),A=S(()=>p.value.length!==0);let k;function l(){u.value.forEach(a=>{a.abort()}),p.value.length!==0&&(k=!0)}function C(){const a=r.queuedFiles.value.slice(0);r.queuedFiles.value=[],q.value.batch(a)?j(a):a.forEach(h=>{j([h])})}function j(a){if(_.value++,typeof e.factory!="function"){b(a,{});return}const h=e.factory(a);if(!h)o("factoryFailed",new Error("QUploader: factory() does not return properly"),a),_.value--;else if(typeof h.catch=="function"&&typeof h.then=="function"){p.value.push(h);const T=t=>{r.isAlive()===!0&&(p.value=p.value.filter(f=>f!==h),p.value.length===0&&(k=!1),r.queuedFiles.value=r.queuedFiles.value.concat(a),a.forEach(f=>{r.updateFileStatus(f,"failed")}),o("factoryFailed",t,a),_.value--)};h.then(t=>{k===!0?T(new Error("Aborted")):r.isAlive()===!0&&(p.value=p.value.filter(f=>f!==h),b(a,t))}).catch(T)}else b(a,h||{})}function b(a,h){const T=new FormData,t=new XMLHttpRequest,f=(D,ae)=>h[D]!==void 0?le(h[D])(ae):q.value[D](ae),g=f("url",a);if(!g){console.error("q-uploader: invalid or no URL specified"),_.value--;return}const N=f("formFields",a);N!==void 0&&N.forEach(D=>{T.append(D.name,D.value)});let $=0,E=0,P=0,H=0,I;t.upload.addEventListener("progress",D=>{if(I===!0)return;const ae=Math.min(H,D.loaded);r.uploadedSize.value+=ae-P,P=ae;let se=P-E;for(let ne=$;se>0&&ne<a.length;ne++){const Z=a[ne];if(se>Z.size)se-=Z.size,$++,E+=Z.size,r.updateFileStatus(Z,"uploading",Z.size);else{r.updateFileStatus(Z,"uploading",se);return}}},!1),t.onreadystatechange=()=>{t.readyState<4||(t.status&&t.status<400?(r.uploadedFiles.value=r.uploadedFiles.value.concat(a),a.forEach(D=>{r.updateFileStatus(D,"uploaded")}),o("uploaded",{files:a,xhr:t})):(I=!0,r.uploadedSize.value-=P,r.queuedFiles.value=r.queuedFiles.value.concat(a),a.forEach(D=>{r.updateFileStatus(D,"failed")}),o("failed",{files:a,xhr:t})),_.value--,u.value=u.value.filter(D=>D!==t))},t.open(f("method",a),g),f("withCredentials",a)===!0&&(t.withCredentials=!0);const V=f("headers",a);V!==void 0&&V.forEach(D=>{t.setRequestHeader(D.name,D.value)});const ee=f("sendRaw",a);a.forEach(D=>{r.updateFileStatus(D,"uploading",0),ee!==!0&&T.append(f("fieldName",D),D,D.name),D.xhr=t,D.__abort=()=>{t.abort()},H+=D.size}),o("uploading",{files:a,xhr:t}),u.value.push(t),ee===!0?t.send(new Blob(a)):t.send(T)}return{isUploading:m,isBusy:A,abort:l,upload:C}}const vt={name:dt,props:ct,emits:mt,injectPlugin:ft},pt=ut(vt);class we{id;filename;filesize;start;end;uploading;done;error;errorHTTPCode;errorMessage;processed;constructor(o,r,u,p,_,q,m,A,k,l,C){this.id=o,this.filename=r,this.filesize=u,this.start=p,this.end=_,this.uploading=q,this.done=m,this.error=A,this.errorHTTPCode=k,this.errorMessage=l,this.processed=C}}const gt={class:"row q-col-gutter-x-sm"},ht={style:{"font-size":"14px"}},bt={key:1,class:"col-6"},xt={style:{"font-size":"14px"}},_t=ie({__name:"DocumentMetadataTopForm",props:{createdAt:{},updatedAt:{}},setup(e){const o=e,{t:r}=ve(),{screen:u}=$e(),p=S(()=>u.gt.xs),_=S(()=>o.createdAt?.timestamp!=o.updatedAt?.timestamp),q=S({get(){return o.createdAt?.dateTime},set(){}}),m=S({get(){return o.createdAt?.dateTime},set(){}});return(A,k)=>(x(),X("div",gt,[e.createdAt?(x(),X("div",{key:0,class:ce({"col-6":_.value,"col-12":!_.value})},[n(Ce,{dense:"",class:"q-mb-md",outlined:"",modelValue:q.value,"onUpdate:modelValue":k[0]||(k[0]=l=>q.value=l),label:d(r)("Created on"),readonly:""},la({_:2},[p.value?{name:"append",fn:c(()=>[L("span",ht,w(e.createdAt?.timeAgo),1)]),key:"0"}:void 0]),1032,["modelValue","label"])],2)):R("",!0),m.value?(x(),X("div",bt,[n(Ce,{dense:"",class:"q-mb-md",outlined:"",modelValue:m.value,"onUpdate:modelValue":k[1]||(k[1]=l=>m.value=l),label:d(r)("Last update"),readonly:""},la({_:2},[p.value?{name:"append",fn:c(()=>[L("span",xt,w(e.updatedAt?.timeAgo),1)]),key:"0"}:void 0]),1032,["modelValue","label"])])):R("",!0)]))}}),yt={key:1,class:"q-list-attachments-container scroll"},kt={key:0},qt=ie({__name:"DocumentDetailsAttachments",props:{attachments:{},disable:{type:Boolean,default:!1}},emits:["update:modelValue","addAttachment","previewAttachmentAtIndex","removeAttachmentAtIndex"],setup(e,{emit:o}){const{t:r}=ve(),u=o,p=e,{screen:_}=$e(),q=qe({...me}),m=S(()=>p.disable||q.ajaxRunning),A=qe([]),k=S(()=>p.attachments?.length>0),l=z(null),C=t=>{if(A.length=0,t){const f=pa(String(t));A.push(...p.attachments.filter(g=>!g.name?.match(f)).map(g=>g.id))}},j=()=>{u("addAttachment")},b=t=>{u("removeAttachmentAtIndex",t)},a=t=>{u("previewAttachmentAtIndex",t)},h=t=>{Q.emit("showAttachmentShareDialog",{attachmentId:t.id,create:!t.shared})},T=(t,f)=>{Qa(ra(t),f).then(()=>{}).catch(()=>{})};return Re(()=>{Q.on("reAuthSucess",t=>{t.to?.includes("DocumentDetailsAttachments.onRemoveAttachmentAtIndex")})}),Ue(()=>{Q.off("reAuthSucess")}),(t,f)=>(x(),F(va,{class:"bg-transparent q-pa-sm"},{default:c(()=>[n(Ie,{class:"transparent-background text-color-primary q-pa-none"},{default:c(()=>[Y(n(fe,null,{default:c(()=>[n(Ce,{type:"search",outlined:"",dense:"",clearable:"",disable:m.value||!k.value,modelValue:l.value,"onUpdate:modelValue":[f[0]||(f[0]=g=>l.value=g),C],modelModifiers:{trim:!0},label:d(r)("Filter by text on attachment filename"),placeholder:d(r)("type text search condition")},{prepend:c(()=>[n(oe,{name:"filter_alt"})]),_:1},8,["disable","modelValue","label","placeholder"])]),_:1},512),[[K,k.value]]),n(fe,{side:""},{default:c(()=>[n(J,{size:"md",label:d(r)("Add attachment"),icon:"add","no-caps":"",class:"bg-blue text-white full-width",disable:m.value,onClick:O(j,["stop"])},null,8,["label","disable"])]),_:1})]),_:1}),n(Le,{class:"q-my-md"}),q.ajaxErrors&&q.ajaxErrorMessage?(x(),F(Ke,{key:0,text:q.ajaxErrorMessage,"api-error":q.ajaxAPIErrorDetails,class:"q-mt-lg"},null,8,["text","api-error"])):R("",!0),k.value?(x(),X("div",yt,[(x(!0),X(Pe,null,Je(e.attachments,(g,N)=>(x(),X("div",{key:g.id},[Y(n(Ie,{class:"q-pa-xs bg-transparent",clickable:"",href:d(ra)(g.id,!0),onClick:O($=>T(g.id,g.name),["stop","prevent"])},{default:c(()=>[n(fe,{class:"q-mx-sm"},{default:c(()=>[n(Qe,null,{default:c(()=>[B(w(g.name),1)]),_:2},1024),n(Qe,{caption:""},{default:c(()=>[B(w(d(r)("Size: "))+w(d(Na).humanStorageSize(g.size)),1)]),_:2},1024),n(Qe,{caption:""},{default:c(()=>[B(w(d(r)("Uploaded on: "))+w(g.createdAt.dateTime)+" ("+w(g.createdAt.timeAgo)+") ",1)]),_:2},1024),d(_).lt.xl?(x(),X("div",kt,[n(ye,{size:"md",square:"",class:ce(["theme-default-q-chip shadow-1 full-width text-center",{"cursor-not-allowed":m.value}]),clickable:!m.value,onClick:O($=>b(N),["stop","prevent"])},{default:c(()=>[n(be,{class:"theme-default-q-avatar text-white bg-blue-6",icon:"delete"}),B(" "+w(d(r)("Remove")),1)]),_:1},8,["class","clickable","onClick"]),d(_e)(g.name)?(x(),F(ye,{key:0,size:"md",square:"",class:ce(["theme-default-q-chip shadow-1 full-width",{"cursor-not-allowed":m.value||!d(_e)(g.name)}]),clickable:!m.value&&d(_e)(g.name),onClick:O($=>a(N),["stop","prevent"])},{default:c(()=>[n(be,{class:"theme-default-q-avatar text-white bg-blue-6",icon:"preview"}),B(" "+w(d(r)("Preview")),1)]),_:1},8,["class","clickable","onClick"])):R("",!0),n(ye,{size:"md",square:"",class:"theme-default-q-chip shadow-1 full-width",clickable:!m.value,onClick:O($=>h(g),["stop","prevent"])},{default:c(()=>[n(be,{class:"theme-default-q-avatar text-white bg-blue-6",icon:"share"}),B(" "+w(d(r)(g.shared?"Shared":"Share")),1)]),_:2},1032,["clickable","onClick"])])):R("",!0)]),_:2},1024),d(_).lt.xl?R("",!0):(x(),F(fe,{key:0,side:"",middle:"",class:"q-mr-sm q-item-section-attachment-actions"},{default:c(()=>[n(ye,{size:"md",square:"",class:ce(["theme-default-q-chip shadow-1 full-width text-center",{"cursor-not-allowed":m.value}]),clickable:!m.value,onClick:O($=>b(N),["stop","prevent"])},{default:c(()=>[n(be,{class:"theme-default-q-avatar text-white bg-blue-6",icon:"delete"}),B(" "+w(d(r)("Remove")),1)]),_:1},8,["class","clickable","onClick"]),d(_e)(g.name)?(x(),F(ye,{key:0,size:"md",square:"",class:ce(["theme-default-q-chip shadow-1 full-width",{"cursor-not-allowed":m.value||!d(_e)(g.name)}]),clickable:!m.value&&d(_e)(g.name),onClick:O($=>a(N),["stop","prevent"])},{default:c(()=>[n(be,{class:"theme-default-q-avatar text-white bg-blue-6",icon:"preview"}),B(" "+w(d(r)("Preview")),1)]),_:1},8,["class","clickable","onClick"])):R("",!0),n(ye,{size:"md",square:"",class:"theme-default-q-chip shadow-1 full-width",clickable:!m.value,onClick:O($=>h(g),["stop","prevent"])},{default:c(()=>[n(be,{class:"theme-default-q-avatar text-white bg-blue-6",icon:"share"}),B(" "+w(d(r)(g.shared?"Shared":"Share")),1)]),_:2},1032,["clickable","onClick"])]),_:2},1024)),n(Fe,null,{default:c(()=>[B(w(d(r)("Click to download")),1)]),_:1})]),_:2},1032,["href","onClick"]),[[K,!A.includes(g.id)]]),N!==e.attachments?.length-1?Y((x(),F(Le,{key:0,class:"q-my-sm"},null,512)),[[K,!A.includes(g.id)]]):R("",!0)]))),128))])):m.value?R("",!0):(x(),F(je,{key:2,warning:"",text:"No document attachments found",class:"q-ma-none"}))]),_:1}))}}),St=Me(qt,[["__scopeId","data-v-3e5632ac"]]),wt={key:0},At={class:"readonly-label"},Ft={class:"absolute-top-right text-grey q-mt-sm"},Ct={key:0,class:"text-red q-ml-sm error-message"},jt=ie({__name:"InteractiveTextFieldCustomInput",props:{modelValue:{},label:{default:""},maxLines:{default:2},rules:{default:()=>[]},autofocus:{type:Boolean,default:!1},startModeEditable:{type:Boolean,default:!0},error:{type:Boolean,default:!1},errorMessage:{default:""}},emits:["update:modelValue"],setup(e,{expose:o,emit:r}){const u=e,p=ja(),{t:_}=ve(),q=$e(),m=S(()=>q.platform.is.desktop),A=r,k=z(null),l=z(!u.startModeEditable),C=S({get(){return u.modelValue},set(g){A("update:modelValue",g)}}),j=z(!m.value),b=z(!0),a=()=>{re().then(()=>{k.value?.focus()}).catch(g=>{console.error(g)})},h=()=>{m.value&&(j.value=!0)},T=()=>{m.value&&(j.value=!1)},t=()=>{l.value=!l.value,l.value||a()};return o({focus:a,unsetReadOnly:()=>{l.value=!1}}),Re(()=>{u.autofocus&&u.startModeEditable&&a()}),(g,N)=>l.value?(x(),X("div",wt,[L("div",{class:ce(["cursor-pointer q-pa-sm q-mb-md relative-position white-space-pre-line read-only-input-container",{"border-error":e.error}]),onMouseenter:h,onMouseleave:T,onClick:t},[L("div",At,w(u.label),1),L("span",Ft,[Te(g.$slots,"top-icon-prepend",{showTopHoverIcons:j.value},void 0,!0),Y(n(oe,{class:"icon-hover",name:b.value?"expand":"unfold_less",size:"sm",onClick:N[0]||(N[0]=O($=>b.value=!b.value,["stop"])),"aria-label":d(_)(b.value?"Click to expand":"Click to collapse")},{default:c(()=>[n(Fe,null,{default:c(()=>[B(w(d(_)(b.value?"Click to expand":"Click to collapse")),1)]),_:1})]),_:1},8,["name","aria-label"]),[[K,j.value]]),Y(n(oe,{class:"icon-hover q-ml-sm",name:"edit",size:"sm","aria-label":d(_)("Click to toggle edit mode")},{default:c(()=>[n(Fe,null,{default:c(()=>[B(w(d(_)("Click to toggle edit mode")),1)]),_:1})]),_:1},8,["aria-label"]),[[K,j.value]]),Te(g.$slots,"top-icon-append",{showTopHoverIcons:j.value},void 0,!0)]),L("div",{class:ce(["q-mt-sm",{collapsed:b.value}]),style:Da(`--max-lines: ${e.maxLines}`)},w(C.value),7)],34),e.error?(x(),X("p",Ct,w(e.errorMessage),1)):R("",!0)])):(x(),F(d(Ce),Ea({key:1},d(p),{ref_key:"qInputRef",ref:k,label:e.label,modelValue:C.value,"onUpdate:modelValue":N[1]||(N[1]=$=>C.value=$),modelModifiers:{trim:!0},rules:e.rules,error:e.error,"error-message":e.errorMessage}),{append:c(()=>[e.error?R("",!0):(x(),F(oe,{key:0,name:"done",class:"cursor-pointer",onClick:O(t,["stop"])},{default:c(()=>[n(Fe,null,{default:c(()=>[B(w(d(_)("Click to toggle edit mode")),1)]),_:1})]),_:1})),Te(g.$slots,"icon-append-on-edit",{},void 0,!0)]),_:3},16,["label","modelValue","rules","error","error-message"]))}}),Ge=Me(jt,[["__scopeId","data-v-52922d18"]]),Dt={key:0,class:"q-list-notes-container scroll"},Et=ie({__name:"DocumentDetailsNotes",props:{notes:{},disable:{type:Boolean,default:!1}},emits:["update:modelValue","addNote","removeNoteAtIndex"],setup(e,{emit:o}){const{t:r}=ve(),{requiredFieldRule:u,fieldIsRequiredLabel:p}=fa(),_=o,q=e,m=qe([]),A=S(()=>q.notes?.length>0),k=z(null),l=b=>{if(m.length=0,b){const a=pa(String(b));m.push(...q.notes.filter(h=>!h.body?.match(a)).map(h=>h.id))}},C=()=>{_("addNote")},j=b=>{_("removeNoteAtIndex",b)};return(b,a)=>(x(),F(va,{class:"bg-transparent q-pa-sm"},{default:c(()=>[n(Ie,{class:"transparent-background text-color-primary q-pa-none"},{default:c(()=>[Y(n(fe,null,{default:c(()=>[n(Ce,{type:"search",outlined:"",dense:"",clearable:"",disable:e.disable||!A.value,modelValue:k.value,"onUpdate:modelValue":[a[0]||(a[0]=h=>k.value=h),l],modelModifiers:{trim:!0},label:d(r)("Filter by text on note body"),placeholder:d(r)("type text search condition")},{prepend:c(()=>[n(oe,{name:"filter_alt"})]),_:1},8,["disable","modelValue","label","placeholder"])]),_:1},512),[[K,A.value]]),n(fe,{side:""},{default:c(()=>[n(J,{size:"md",label:d(r)("Add note"),icon:"add","no-caps":"",class:"bg-blue text-white full-width",disable:e.disable,onClick:O(C,["stop","prevent"])},null,8,["label","disable"])]),_:1})]),_:1}),n(Le,{class:"q-my-md"}),A.value?(x(),X("div",Dt,[(x(!0),X(Pe,null,Je(e.notes,(h,T)=>Y((x(),F(Ie,{class:"q-pa-none bg-transparent",key:h.id},{default:c(()=>[n(fe,null,{default:c(()=>[n(Ge,{modelValue:h.body,"onUpdate:modelValue":t=>h.body=t,modelModifiers:{trim:!0},dense:"",outlined:"",type:"textarea",maxlength:"4096",autogrow:"",name:"description",label:`${h.createdAt.dateTime} (${h.createdAt.timeAgo})`,"start-mode-editable":!!h.startOnEditMode,disable:e.disable,clearable:"","max-lines":6,rules:[d(u)],error:!h.body,"error-message":d(p),autofocus:h.startOnEditMode,placeholder:d(r)("type note body")},{"top-icon-append":c(({showTopHoverIcons:t})=>[Y(n(oe,{name:"delete",size:"sm",class:"q-ml-sm q-mr-sm icon-hover",clickable:"",onClick:O(f=>j(T),["stop","prevent"])},{default:c(()=>[n(Fe,null,{default:c(()=>[B(w(d(r)("Click to remove note")),1)]),_:1})]),_:1},8,["onClick"]),[[K,t]])]),"icon-append-on-edit":c(()=>[n(oe,{name:"delete",size:"sm",class:"cursor-pointer",clickable:"",onClick:O(t=>j(T),["stop","prevent"])},null,8,["onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue","label","start-mode-editable","disable","rules","error","error-message","autofocus","placeholder"])]),_:2},1024)]),_:2},1024)),[[K,!m.includes(h.id)]])),128))])):e.disable?R("",!0):(x(),F(je,{key:1,warning:"",text:"No document notes found",class:"q-ma-none"}))]),_:1}))}}),zt=Me(Et,[["__scopeId","data-v-5c2aefac"]]),It={class:"text-left"},Ut={class:"text-left"},Rt=ie({__name:"DocumentDetailsHistory",props:{modelValue:{},disable:{type:Boolean,default:!1}},setup(e){const{t:o}=ve(),r=e,u=S({get(){return r.modelValue},set(){}}),p=S(()=>u.value?.length>0);return(_,q)=>p.value?(x(),F(Ja,{key:0,class:"bg-transparent q-pa-sm q-list-history-container scroll"},{default:c(()=>[L("thead",null,[L("tr",null,[L("th",It,w(d(o)("Date")),1),L("th",Ut,w(d(o)("Operation")),1)])]),L("tbody",null,[(x(!0),X(Pe,null,Je(u.value,m=>(x(),X("tr",{key:m.id},[L("td",null,w(m.createdAt.dateTime)+" ("+w(m.createdAt.timeAgo)+")",1),L("td",null,[n(oe,{size:"md",name:m.icon,class:"q-mr-sm"},null,8,["name"]),B(w(d(o)(m.label)),1)])]))),128))])]),_:1})):e.disable?R("",!0):(x(),F(je,{key:1,warning:"",text:"No document history found",class:"q-ma-none"}))}}),Pt=Me(Rt,[["__scopeId","data-v-cfe34ec1"]]),Mt={class:"q-ma-md"},$t=ie({__name:"DeleteDocumentConfirmationDialog",props:{documentId:{}},emits:["close"],setup(e,{emit:o}){const{t:r}=ve(),u=o,p=Ye(),_=e,q=z(!0),m=qe({...me}),A=z(!1),k=()=>{Object.assign(m,me),m.ajaxRunning=!0,Ae.document.remove(_.documentId).then(()=>{A.value=!0}).catch(C=>{if(m.ajaxErrors=!0,C.isAPIError)switch(m.ajaxAPIErrorDetails=C.customAPIErrorDetails,C.response.status){case 401:m.ajaxErrors=!1,Q.emit("reAuthRequired",{emitter:"DeleteDocumentConfirmationDialog.onDelete"});break;case 403:m.ajaxErrorMessage="Error removing (non existent) document";break;case 404:m.ajaxErrorMessage="Error removing document: access denied";break;default:m.ajaxErrorMessage="API Error: fatal error";break}else m.ajaxErrorMessage=`Uncaught exception: ${C}`,console.error(C)}).finally(()=>{m.ajaxRunning=!1})},l=()=>{q.value=!1,A.value?p.push({name:"index"}).catch(C=>{console.error(C)}):u("close")};return Re(()=>{Q.on("reAuthSucess",C=>{C.to?.includes("DeleteDocumentConfirmationDialog.onDelete")&&k()})}),Ue(()=>{Q.off("reAuthSucess")}),(C,j)=>(x(),F(Oa,{modelValue:q.value,"onUpdate:modelValue":j[0]||(j[0]=b=>q.value=b),onClose:l,width:"1280px","max-width":"80vw"},{"header-left":c(()=>[B(w(d(r)("Delete document")),1)]),body:c(()=>[L("div",Mt,[L("p",null,w(d(r)("You are about to delete the current document. Are you sure? (this action cannot be undone).")),1),A.value?(x(),F(je,{key:0,class:"q-mt-lg",success:"",text:"The document has been deleted. Upon closing this dialog, you will be redirected to the home screen."})):m.ajaxErrors&&m.ajaxErrorMessage?(x(),F(Ke,{key:1,text:m.ajaxErrorMessage,"api-error":m.ajaxAPIErrorDetails,class:"q-mt-lg"},null,8,["text","api-error"])):R("",!0)])]),actions:c(()=>[A.value?R("",!0):(x(),F(J,{key:0,class:"action-secondary",onClick:O(l,["stop"]),icon:"close",label:d(r)("Cancel"),disable:m.ajaxRunning},null,8,["label","disable"])),A.value?R("",!0):(x(),F(J,{key:1,color:"primary",onClick:O(k,["stop"]),icon:"done",label:d(r)("Ok"),disable:m.ajaxRunning},null,8,["label","disable"])),A.value?(x(),F(J,{key:2,color:"primary",onClick:O(l,["stop"]),icon:"done",label:d(r)("Close")},null,8,["label"])):R("",!0)]),_:1},8,["modelValue"]))}}),Tt={class:"col-12 col-lg-6 col-xl-6 q-px-sm flex"},Vt={class:"col-12 col-lg-6 col-xl-6 q-px-sm flex"},Bt=ie({__name:"DocumentForm",props:{documentId:{}},setup(e){const{t:o}=ve(),r=Ye(),{screen:u}=$e(),p=Wa(),{requiredFieldRule:_,fieldIsRequiredLabel:q}=fa(),m=e;ma(()=>m.documentId,s=>{s?(l.id=s,P()):(l.reset(),b.value?.unsetReadOnly(),re().then(()=>{b.value?.focus()}).catch(i=>{console.error(i)}))});const A=S(()=>u.gt.md),k=S(()=>!m.documentId),l=qe(new La),C=S(()=>p.maxUploadFileSize),j=z(null),b=z(null),a=z(!0),h=z(!1),T=z(!1),t=qe({...me}),f=z(!1),g=z("metadata"),N=z("metadata"),$=z("attachments"),E=s=>{s.preventDefault();const i=s.dataTransfer?.files||[];i.length&&j.value?.addFiles(i)},P=()=>{l.id&&(t.ajaxRunning||(a.value=!0,Object.assign(t,me),t.ajaxRunning=!0,g.value="metadata",Ae.document.get(l.id).then(s=>{l.parseJSONResponse(o,s)}).catch(s=>{if(t.ajaxErrors=!0,s.isAPIError)switch(t.ajaxAPIErrorDetails=s.customAPIErrorDetails,s.response.status){case 401:t.ajaxErrors=!1,Q.emit("reAuthRequired",{emitter:"DocumentPage.onRefresh"});break;case 404:t.ajaxErrorMessage="Document not found",a.value=!1;break;default:t.ajaxErrorMessage="API Error: fatal error";break}else t.ajaxErrorMessage=`Uncaught exception: ${s}`,console.error(s)}).finally(()=>{t.ajaxRunning=!1,t.ajaxErrors||g.value=="metadata"&&re().then(()=>{b.value?.focus()}).catch(s=>{console.error(s)})})))},H=()=>{t.ajaxRunning||(h.value=!1,Object.assign(t,me),t.ajaxRunning=!0,k.value?(l.id||(l.id=ue()),Ae.document.add(l).then(()=>{r.push({name:"document",params:{id:l.id}}).catch(s=>{console.error(s)})}).catch(s=>{if(t.ajaxErrors=!0,s.isAPIError)switch(t.ajaxAPIErrorDetails=s.customAPIErrorDetails,s.response.status){case 400:s.response.data.invalidOrMissingParams.find(function(i){return i==="title"})?(t.ajaxErrorMessage=o("API Error: missing document title param"),g.value="metadata",re().then(()=>{b.value?.focus()}).catch(i=>{console.error(i)})):s.response.data.invalidOrMissingParams.find(function(i){return i==="noteBody"})?(t.ajaxErrorMessage=o("API Error: missing document note body"),g.value="details",$.value="notes"):t.ajaxErrorMessage="API Error: fatal error";break;case 401:t.ajaxErrors=!1,Q.emit("reAuthRequired",{emitter:"AdvancedSearchPage.onSubmitForm"});break;default:t.ajaxErrorMessage="API Error: fatal error";break}else t.ajaxErrorMessage=`Uncaught exception: ${s}`,console.error(s)}).finally(()=>{t.ajaxRunning=!1,t.ajaxErrors||(h.value=!0,g.value=="metadata"&&re().then(()=>{b.value?.focus()}).catch(s=>{console.error(s)}))})):Ae.document.update(l).then(s=>{l.parseJSONResponse(o,s)}).catch(s=>{if(t.ajaxErrors=!0,s.isAPIError)switch(t.ajaxAPIErrorDetails=s.customAPIErrorDetails,s.response.status){case 400:s.response.data.invalidOrMissingParams.find(function(i){return i==="title"})?(t.ajaxErrorMessage=o("API Error: missing document title param"),g.value="metadata",re().then(()=>{b.value?.focus()}).catch(i=>{console.error(i)})):s.response.data.invalidOrMissingParams.find(function(i){return i==="noteBody"})?(t.ajaxErrorMessage=o("API Error: missing document note body"),g.value="details",$.value="notes"):t.ajaxErrorMessage="API Error: fatal error";break;case 401:t.ajaxErrors=!1,Q.emit("reAuthRequired",{emitter:"AdvancedSearchPage.onSubmitForm"});break;default:t.ajaxErrorMessage="API Error: fatal error";break}else t.ajaxErrorMessage=`Uncaught exception: ${s}`,console.error(s)}).finally(()=>{t.ajaxRunning=!1,t.ajaxErrors||(h.value=!0,g.value=="metadata"&&re().then(()=>{b.value?.focus()}).catch(s=>{console.error(s)}))}))},I=()=>{l.id&&(f.value=!0)},V=s=>{$.value="attachments",re().then(()=>{j.value?.pickFiles(s)}).catch(i=>{console.error(i)})},ee=s=>{l.attachments[s].orphaned?(Object.assign(t,me),t.ajaxRunning=!0,Ae.document.removeFile(l.attachments[s].id).then(()=>{l.attachments=l.attachments.filter((i,y)=>y!==s)}).catch(i=>{if(t.ajaxErrors=!0,i.isAPIError)switch(t.ajaxAPIErrorDetails=i.customAPIErrorDetails,i.response.status){case 401:t.ajaxErrors=!1,Q.emit("reAuthRequired",{emitter:"DocumentDetailsAttachments.onRemoveAttachmentAtIndex"});break;default:t.ajaxErrorMessage="API Error: fatal error";break}else t.ajaxErrorMessage=`Uncaught exception: ${i}`,console.error(i)}).finally(()=>{t.ajaxRunning=!1})):l.attachments=l.attachments.filter((i,y)=>y!==s)},D=()=>{l.notes.unshift(new Ha(ue(),"",new ia(o,de()),!1,!0))},ae=s=>{l.notes=l.notes.filter((i,y)=>y!==s)},se=()=>{T.value=!0,Q.emit("showUploadingDialog",{transfers:j.value?.files.map(s=>new we(ue(),s.name,s.size,de(),null,!1,!1,!1,null,null,!1))})},ne=s=>{let i=null;try{s.xhr instanceof XMLHttpRequest?i=JSON.parse(s.xhr.response):s.xhr.data&&(i=s.xhr.data)}catch(y){console.error(y)}i!=null?(l.attachments.unshift(new Ga(i.data.id,s.files[0].name,"",s.files[0].size,new ia(o,de()),!0,!1)),Q.emit("refreshUploadingDialog.fileUploaded",{transfers:s.files.map(y=>new we(ue(),y.name,y.size,0,null,!1,!1,!1,null,null,!1))})):Q.emit("refreshUploadingDialog.fileUploadRejected",{transfers:s.files.map(y=>new we(ue(),y.name,y.size,de(),de(),!1,!1,!0,500,"Transfer rejected",!0))})},Z=s=>{console.log("rejected");const i=s.map(y=>new we(ue(),y.file.name,y.file.size,0,null,!1,!1,!0,y.failedPropValidation=="max-file-size"?413:500,y.failedPropValidation=="max-file-size"?"Content Too Large":"Internal Server Error",!1));Q.emit("refreshUploadingDialog.fileUploadRejected",{transfers:i})},pe=s=>{Q.emit("refreshUploadingDialog.fileUploadFailed",{transfers:s.files.map(i=>new we(ue(),i.name,i.size,de(),de(),!1,!1,!0,s.xhr.status,"Transfer failed",!0))})},De=()=>{T.value=!1,j.value?.reset()};return Re(()=>{k.value||m.documentId&&(l.id=m.documentId,P()),Q.on("reAuthSucess",s=>{s.to?.includes("DocumentPage.onRefresh")&&P(),s.to?.includes("DocumentPage.onSubmitForm")&&H()}),Q.on("attachmentShareChanged",s=>{s.attachmentShare&&l.attachments.forEach(i=>{i.id===s.attachmentShare.attachment.id&&(i.shared=s.attachmentShare.enabled)})}),Q.on("attachmentShareDeleted",s=>{s.attachmentId&&l.attachments.forEach(i=>{i.id===s.attachmentId&&(i.shared=!1)})})}),Ue(()=>{Q.off("reAuthSucess"),Q.off("attachmentShareChanged"),Q.off("attachmentShareDeleted")}),(s,i)=>(x(),X(Pe,null,[L("div",{onDragover:i[11]||(i[11]=O(()=>{},["prevent"])),onDragenter:i[12]||(i[12]=O(()=>{},["prevent"])),onDrop:E},[n(d(pt),{ref_key:"uploaderRef",ref:j,class:"hidden","hide-upload-btn":"","no-thumbnails":"","auto-upload":"","field-name":"file",method:"POST",url:"api3/attachment","max-file-size":C.value,multiple:"",onUploaded:ne,onRejected:Z,onFailed:pe,onStart:se,onFinish:De},null,8,["max-file-size"]),n(Ne,{flat:"",class:"bg-transparent"},{default:c(()=>[L("form",{onSubmit:O(H,["prevent","stop"]),autocorrect:"off",autocapitalize:"off",autocomplete:"off",spellcheck:"false"},[a.value?(x(),F(sa,{key:0,class:"q-ma-sm",spread:""},{default:c(()=>[n(J,{type:"submit",icon:"save",size:"md",color:"primary",title:d(o)("Save"),label:d(o)("Save"),"no-caps":"",onClick:H,disable:t.ajaxRunning||T.value||!l.title,loading:t.ajaxRunning},{loading:c(()=>[n(Ee,{class:"on-left"}),B(" "+w(d(o)("Saving...")),1)]),_:1},8,["title","label","disable","loading"]),k.value?R("",!0):(x(),F(J,{key:0,type:"button",icon:"autorenew",size:"md",color:"secondary",title:d(o)("Reload"),label:d(o)("Reload"),"no-caps":"",onClick:P,loading:t.ajaxRunning},{loading:c(()=>[n(Ee,{class:"on-left"}),B(" "+w(d(o)("Loading...")),1)]),_:1},8,["title","label","loading"])),k.value?R("",!0):(x(),F(J,{key:1,type:"button",icon:"delete",size:"md",color:"red",title:d(o)("Delete"),label:d(o)("Delete"),"no-caps":"",onClick:I},null,8,["title","label"]))]),_:1})):R("",!0),n(Ve,{class:"lt-lg q-mb-sm",modelValue:g.value,"onUpdate:modelValue":i[0]||(i[0]=y=>g.value=y)},{default:c(()=>[n(he,{name:"metadata",icon:"description",label:d(o)("Document metadata"),class:"cursor-default full-width","no-caps":""},null,8,["label"]),n(he,{name:"details",icon:"list_alt",label:d(o)("Document details"),class:"cursor-default full-width","no-caps":""},null,8,["label"])]),_:1},8,["modelValue"]),a.value?(x(),F(xe,{key:1,class:"row q-pa-none"},{default:c(()=>[Y(L("div",Tt,[n(Ne,{class:"q-ma-xs q-mt-sm full-width"},{default:c(()=>[n(xe,{class:"q-pa-none q-mb-sm gt-md"},{default:c(()=>[n(Ve,{modelValue:N.value,"onUpdate:modelValue":i[1]||(i[1]=y=>N.value=y)},{default:c(()=>[n(he,{name:"metadata",icon:"description",label:d(o)("Document metadata"),"no-caps":"",class:"cursor-default full-width"},null,8,["label"])]),_:1},8,["modelValue"])]),_:1}),n(xe,{class:"q-pa-md"},{default:c(()=>[k.value?R("",!0):(x(),F(_t,{key:0,"created-at":l.createdAt,"updated-at":l.updatedAt},null,8,["created-at","updated-at"])),n(Ge,{ref_key:"documentTitleFieldRef",ref:b,dense:"",class:"q-mb-md",maxlength:"128",outlined:"",modelValue:l.title,"onUpdate:modelValue":i[2]||(i[2]=y=>l.title=y),modelModifiers:{trim:!0},type:"textarea",autogrow:"",name:"title",label:d(o)("Document title"),disable:t.ajaxRunning,autofocus:!0,clearable:"","start-mode-editable":k.value,rules:[d(_)],error:!l.title,"error-message":d(q),"max-lines":1},null,8,["modelValue","label","disable","start-mode-editable","rules","error","error-message"]),n(Ge,{dense:"",class:"q-mb-md",outlined:"",modelValue:l.description,"onUpdate:modelValue":i[3]||(i[3]=y=>l.description=y),modelModifiers:{trim:!0},type:"textarea",maxlength:"4096",autogrow:"",name:"description",label:d(o)("Document description"),disable:t.ajaxRunning,clearable:"","start-mode-editable":k.value,"max-lines":6},null,8,["modelValue","label","disable","start-mode-editable"]),n(Xa,{dense:"",modelValue:l.tags,"onUpdate:modelValue":i[4]||(i[4]=y=>l.tags=y),disabled:t.ajaxRunning,"start-mode-editable":k.value,"deny-change-editable-mode":k.value,clearable:""},null,8,["modelValue","disabled","start-mode-editable","deny-change-editable-mode"])]),_:1})]),_:1})],512),[[K,A.value||g.value=="metadata"]]),Y(L("div",Vt,[n(Ne,{class:"q-ma-xs q-mt-sm full-width"},{default:c(()=>[n(xe,{class:"q-pa-none q-mb-sm",style:{"border-bottom":"2px solid rgba(0, 0, 0, 0.12)"}},{default:c(()=>[n(Ve,{modelValue:$.value,"onUpdate:modelValue":i[5]||(i[5]=y=>$.value=y),align:"left"},{default:c(()=>[n(he,{name:"attachments",icon:"attach_file",disable:t.ajaxRunning,label:d(o)("Attachments")},{default:c(()=>[Y(n(Oe,{floating:""},{default:c(()=>[B(w(l.attachments.length),1)]),_:1},512),[[K,l.hasAttachments]])]),_:1},8,["disable","label"]),n(he,{name:"notes",icon:"forum",disable:t.ajaxRunning,label:d(o)("Notes")},{default:c(()=>[Y(n(Oe,{floating:""},{default:c(()=>[B(w(l.notes.length),1)]),_:1},512),[[K,l.hasNotes]])]),_:1},8,["disable","label"]),l.id?(x(),F(he,{key:0,name:"history",icon:"view_timeline",disable:t.ajaxRunning,label:d(o)("History")},{default:c(()=>[Y(n(Oe,{floating:""},{default:c(()=>[B(w(l.historyOperations.length),1)]),_:1},512),[[K,l.hasHistoryOperations]])]),_:1},8,["disable","label"])):R("",!0)]),_:1},8,["modelValue"])]),_:1}),n(xe,{class:"q-pa-none"},{default:c(()=>[n(Ia,{modelValue:$.value,"onUpdate:modelValue":i[10]||(i[10]=y=>$.value=y),animated:"",class:"bg-transparent"},{default:c(()=>[n(Be,{name:"attachments",class:"q-pa-none"},{default:c(()=>[n(St,{attachments:l.attachments,disable:t.ajaxRunning,onAddAttachment:V,onPreviewAttachmentAtIndex:i[6]||(i[6]=y=>l.previewAttachment(y)),onRemoveAttachmentAtIndex:i[7]||(i[7]=y=>ee(y))},null,8,["attachments","disable"])]),_:1}),n(Be,{name:"notes",class:"q-pa-none"},{default:c(()=>[n(zt,{notes:l.notes,disable:t.ajaxRunning,onAddNote:D,onRemoveNoteAtIndex:i[8]||(i[8]=y=>ae(y))},null,8,["notes","disable"])]),_:1}),l.id?(x(),F(Be,{key:0,name:"history",class:"q-pa-none"},{default:c(()=>[n(Pt,{modelValue:l.historyOperations,"onUpdate:modelValue":i[9]||(i[9]=y=>l.historyOperations=y),disable:t.ajaxRunning},null,8,["modelValue","disable"])]),_:1})):R("",!0)]),_:1},8,["modelValue"])]),_:1})]),_:1})],512),[[K,A.value||g.value=="details"]])]),_:1})):R("",!0),n(xe,{class:"q-ma-xs q-mt-sm q-px-xs"},{default:c(()=>[h.value?(x(),F(je,{key:0,class:"q-mt-md",text:"Document saved",success:""})):t.ajaxErrors&&t.ajaxErrorMessage?(x(),F(Ke,{key:1,class:"q-mt-md","api-error":t.ajaxAPIErrorDetails,text:t.ajaxErrorMessage},null,8,["api-error","text"])):R("",!0)]),_:1}),a.value?(x(),F(sa,{key:2,class:"q-ma-sm",spread:""},{default:c(()=>[n(J,{type:"submit",icon:"save",size:"md",color:"primary",title:d(o)("Save"),label:d(o)("Save"),"no-caps":"",onClick:H,disable:t.ajaxRunning||T.value||!l.title,loading:t.ajaxRunning},{loading:c(()=>[n(Ee,{class:"on-left"}),B(" "+w(d(o)("Saving...")),1)]),_:1},8,["title","label","disable","loading"]),k.value?R("",!0):(x(),F(J,{key:0,type:"button",icon:"autorenew",size:"md",color:"secondary",title:d(o)("Reload"),label:d(o)("Reload"),"no-caps":"",onClick:P,loading:t.ajaxRunning},{loading:c(()=>[n(Ee,{class:"on-left"}),B(" "+w(d(o)("Loading...")),1)]),_:1},8,["title","label","loading"])),k.value?R("",!0):(x(),F(J,{key:1,type:"button",icon:"delete",size:"md",color:"red",title:d(o)("Delete"),label:d(o)("Delete"),"no-caps":"",onClick:I},null,8,["title","label"]))]),_:1})):R("",!0)],32)]),_:1})],32),f.value&&l.id?(x(),F($t,{key:0,"document-id":l.id,onClose:i[13]||(i[13]=y=>f.value=!1)},null,8,["document-id"])):R("",!0)],64))}}),pl=ie({__name:"DocumentPage",setup(e){const o=Ye(),r=za(),u=z(r.name=="document"&&String(r.params?.id)||null);return o.beforeEach(p=>{p.name=="newDocument"?u.value=null:p.name=="document"&&p.params.id&&(u.value=String(p.params.id))}),(p,_)=>(x(),F(ya,null,{default:c(()=>[n(Bt,{"document-id":u.value},null,8,["document-id"])]),_:1}))}});export{pl as default};
