import{d as k,b as d,a as R,c as $}from"./CustomErrorBanner.vue_vue_type_script_setup_true_lang-Cbck3fGF.js";import{Q as z,a as C}from"./QItem-BUqn2UGP.js";import{Q as D,a as F}from"./QInput-C8tsE61X.js";import{Q as T}from"./QBtn-BMgEeOPb.js";import{Q as G}from"./ClosePopup-BcGTXUO_.js";import{a as L,b as N,k as E,a9 as O,l as y,R as H,v as u,n as j,h as r,p as _,w as n,ac as J,f as g,g as o,e as S,q as x,t as f,r as W,G as K,s as X,o as h}from"./index-BwTDC915.js";import{a as Y}from"./api-CoaNhV9A.js";import{u as Z}from"./useFormUtils-Cdj2NjEO.js";import{u as ee}from"./serverEnvironment-CXSouptd.js";import{u as ae}from"./session-B3nmnnYo.js";import{d as se,_ as re}from"./PasswordFieldCustomInput.vue_vue_type_script_setup_true_lang-S5ESJ3Dv.js";import{_ as oe,a as te,b as le}from"./GitHubButton.vue_vue_type_script_setup_true_lang-D4YI5vnm.js";const ne={class:"q-mt-sm q-mb-md text-h4 text-weight-bolder"},ie={class:"text-color-secondary"},me={key:0},be=L({__name:"LoginForm",props:{showExtraBottom:{type:Boolean,default:!0}},emits:["success"],setup(V,{emit:A}){const I=A,{t:i}=N(),{requiredFieldRule:w}=Z(),M=ee(),P=ae(),a=E({...k}),t=E({...se}),b=O("lastUsedEmail",null),p=b.get(),l=E({email:p||"",password:""}),m=y(null),c=y(null),Q=()=>{t.email.hasErrors=!1,t.email.message=null,t.password.hasErrors=!1,t.password.message=null,m.value?.resetValidation(),c.value?.resetValidation()},q=async()=>{Q();try{await m.value?.validate(),await c.value?.validate(),m.value?.hasError?m.value?.focus():c.value?.hasError?c.value?.focus():B()}catch(s){console.error("Validation error",s)}},B=()=>{l.email&&l.password?(Object.assign(a,k),a.ajaxRunning=!0,Y.auth.login(l.email,l.password).then(s=>{P.setAccessToken(s.data.accessToken),b.set(l.email),I("success",s.data)}).catch(s=>{if(a.ajaxErrors=!0,s.isAPIError)switch(a.ajaxAPIErrorDetails=s.customAPIErrorDetails,s.response.status){case 400:s.response.data.invalidOrMissingParams.find(function(e){return e==="email"})?(a.ajaxErrorMessage="API Error: missing email param",u().then(()=>{m.value?.focus()}).catch(e=>{console.error(e)})):s.response.data.invalidOrMissingParams.find(function(e){return e==="password"})?(a.ajaxErrorMessage="API Error: missing password param",u().then(()=>{c.value?.focus()}).catch(e=>{console.error(e)})):(a.ajaxErrorMessage="API Error: invalid/missing param",u().then(()=>{m.value?.focus()}).catch(e=>{console.error(e)}));break;case 404:t.email.hasErrors=!0,t.email.message="Email not registered",u().then(()=>{m.value?.focus()}).catch(e=>{console.error(e)});break;case 401:t.password.hasErrors=!0,t.password.message="Invalid password",u().then(()=>{c.value?.focus()}).catch(e=>{console.error(e)});break;default:a.ajaxErrorMessage="API Error: fatal error";break}else a.ajaxErrorMessage=`Uncaught exception: ${s}`,console.error(s)}).finally(()=>{a.ajaxRunning=!1})):console.error("Missing email|password values")};return H(()=>{u().then(()=>{p?c.value?.focus():m.value?.focus()}).catch(s=>{console.error(s)})}),(s,e)=>{const U=W("router-link");return h(),j("form",{onSubmit:X(q,["prevent","stop"]),autocorrect:"off",autocapitalize:"off",autocomplete:"off",spellcheck:"false"},[r(d,{class:"text-center"},{default:n(()=>[r(R,{square:"",size:"128px"},{default:n(()=>[...e[2]||(e[2]=[g("img",{src:"icons/favicon-128x128.png"},null,-1)])]),_:1}),J(s.$slots,"slogan",{},()=>[g("h4",ne,f(o(i)(o(p)?"Glad to see you again!":"Welcome aboard!")),1),g("div",ie,f(o(i)(o(p)?"Let's get back to organizing.":"Let's start organizing.")),1)])]),_:3}),r(d,null,{default:n(()=>[r(o(D),{dense:"",outlined:"",ref_key:"emailRef",ref:m,modelValue:l.email,"onUpdate:modelValue":e[0]||(e[0]=v=>l.email=v),type:"email",name:"email",label:o(i)("Email"),disable:a.ajaxRunning,rules:[o(w)],"lazy-rules":"",error:t.email.hasErrors,"error-message":t.email.message?o(i)(t.email.message):""},{prepend:n(()=>[r(z,{name:"alternate_email"})]),_:1},8,["modelValue","label","disable","rules","error","error-message"]),r(re,{dense:"",outlined:"",ref_key:"passwordRef",ref:c,class:"q-mt-md",modelValue:l.password,"onUpdate:modelValue":e[1]||(e[1]=v=>l.password=v),name:"password",label:o(i)("Password"),disable:a.ajaxRunning,rules:[o(w)],"lazy-rules":"",error:t.password.hasErrors,"error-message":t.password.message?o(i)(t.password.message):""},null,8,["modelValue","label","disable","rules","error","error-message"])]),_:1}),r(d,null,{default:n(()=>[r(T,{color:"primary",size:"md",label:s.$t("Sign in"),"no-caps":"",class:"full-width",icon:"account_circle",disable:a.ajaxRunning||!(l.email&&l.password),loading:a.ajaxRunning,type:"submit"},{loading:n(()=>[r(F,{class:"on-left"}),x(" "+f(o(i)("Sign in")),1)]),_:1},8,["label","disable","loading"]),a.ajaxErrors&&a.ajaxErrorMessage?(h(),S($,{key:0,text:a.ajaxErrorMessage,"api-error":a.ajaxAPIErrorDetails,class:"q-mt-lg"},null,8,["text","api-error"])):_("",!0)]),_:1}),V.showExtraBottom?(h(),j("div",me,[o(M).isSignUpAllowed?(h(),S(d,{key:0,class:"text-center q-pt-none"},{default:n(()=>[g("div",null,[x(f(o(i)("Don't have an account yet ?"))+" ",1),r(U,{to:{name:"register"},class:"main-app-text-link-hover"},{default:n(()=>[x(f(o(i)("Click here to sign up")),1)]),_:1})])]),_:1})):_("",!0),r(C,{class:"q-mb-sm"}),r(d,{class:"text-center q-py-none"},{default:n(()=>[r(G,{flat:"",square:""},{default:n(()=>[r(oe),r(te),r(le,{label:"@2025 HomeDocs",href:o(K)},null,8,["href"])]),_:1})]),_:1})])):_("",!0)],32)}}});export{be as _};
