import{Q as ya}from"./QPage-BLWONRqG.js";import{x as We,j as A,y as R,z as Xe,l as I,O as da,Q as ca,I as ka,B as ma,D as Ue,ah as qa,ai as Aa,aj as Sa,aa as wa,ak as Fa,al as ja,a as ie,b as ve,n as X,p as P,a2 as ce,h as n,g as d,a1 as la,w as m,f as O,t as j,o as h,k as ye,R as Re,e as F,S as Y,a3 as K,s as Q,U as Pe,T as Je,q as B,af as Da,ac as Te,a6 as Ca,ag as Ea,v as re,i as Ye,V as za}from"./index-Ct92d8Em.js";import{Q as we,a as De}from"./QInput-DCOUNvfM.js";import{a as oa,Q as J}from"./QBtn-DctWh9_T.js";import{Q as sa}from"./ClosePopup-CNyqlWth.js";import{d as me,c as Ke,_ as Fe,a as Ce,Q as Ve,e as Be,f as be,b as he,h as Ia,i as Ne,u as ue}from"./CustomErrorBanner.vue_vue_type_script_setup_true_lang-BwzH5vCg.js";import{c as Ua,d as Ra,_ as Me}from"./_plugin-vue_export-helper-oRIn74M6.js";import{k as Pa,l as Ma,b as $a,e as Ta,v as Va,Q as oe,j as $e,h as Ie,i as fe,a as Le,_ as Se}from"./QItem-D3SSeFk8.js";import{b as Ba,h as na,a as H,Q as Oe,f as Na}from"./QItemLabel-BTaOLrdI.js";import{b as Oa,a as Ae}from"./api-ByO76S85.js";import{u as fa}from"./useFormUtils-B_DmTkpa.js";import{d as ra,c as xe,_ as Qa,D as La,N as Ha,A as Ga}from"./document-CIfyGa1Z.js";import{u as Wa}from"./serverEnvironment-T24gP8gM.js";import{I as Xa}from"./InteractiveTagsFieldCustomSelect-DNMrD4Wd.js";import{Q as va,a as Ee,D as ia,c as de}from"./date-time-ByGSvQ9F.js";import{g as pa}from"./common-CaK3FoAb.js";import{Q as Ja}from"./QMarkupTable-BsEaLHgn.js";import"./session-XhBIPT0q.js";import"./index-CG2WSiiR.js";import"./BrowseByTagButton.vue_vue_type_script_setup_true_lang-DWuVX2e0.js";const Ya=["top","middle","bottom"],Qe=We({name:"QBadge",props:{color:String,textColor:String,floating:Boolean,transparent:Boolean,multiLine:Boolean,outline:Boolean,rounded:Boolean,label:[Number,String],align:{type:String,validator:e=>Ya.includes(e)}},setup(e,{slots:s}){const r=A(()=>e.align!==void 0?{verticalAlign:e.align}:null),i=A(()=>{const p=e.outline===!0&&e.color||e.textColor;return`q-badge flex inline items-center no-wrap q-badge--${e.multiLine===!0?"multi":"single"}-line`+(e.outline===!0?" q-badge--outline":e.color!==void 0?` bg-${e.color}`:"")+(p!==void 0?` text-${p}`:"")+(e.floating===!0?" q-badge--floating":"")+(e.rounded===!0?" q-badge--rounded":"")+(e.transparent===!0?" q-badge--transparent":"")});return()=>R("div",{class:i.value,style:r.value,role:"status","aria-label":e.label},Ua(s.default,e.label!==void 0?[e.label]:[]))}}),Ka={...Pa,min:{type:Number,default:0},max:{type:Number,default:100},color:String,centerColor:String,trackColor:String,fontSize:String,rounded:Boolean,thickness:{type:Number,default:.2,validator:e=>e>=0&&e<=1},angle:{type:Number,default:0},showValue:Boolean,reverse:Boolean,instantFeedback:Boolean},He=50,ga=2*He,ba=ga*Math.PI,Za=Math.round(ba*1e3)/1e3,et=We({name:"QCircularProgress",props:{...Ka,value:{type:Number,default:0},animationSpeed:{type:[String,Number],default:600},indeterminate:Boolean},setup(e,{slots:s}){const{proxy:{$q:r}}=Xe(),i=Ma(e),p=A(()=>{const g=(r.lang.rtl===!0?-1:1)*e.angle;return{transform:e.reverse!==(r.lang.rtl===!0)?`scale3d(-1, 1, 1) rotate3d(0, 0, 1, ${-90-g}deg)`:`rotate3d(0, 0, 1, ${g-90}deg)`}}),x=A(()=>e.instantFeedback!==!0&&e.indeterminate!==!0?{transition:`stroke-dashoffset ${e.animationSpeed}ms ease 0s, stroke ${e.animationSpeed}ms ease`}:""),k=A(()=>ga/(1-e.thickness/2)),f=A(()=>`${k.value/2} ${k.value/2} ${k.value} ${k.value}`),S=A(()=>Ba(e.value,e.min,e.max)),y=A(()=>e.max-e.min),l=A(()=>e.thickness/2*k.value),D=A(()=>{const g=(e.max-S.value)/y.value,a=e.rounded===!0&&S.value<e.max&&g<.25?l.value/2*(1-g/.25):0;return ba*g+a});function C({thickness:g,offset:a,color:b,cls:w,rounded:t}){return R("circle",{class:"q-circular-progress__"+w+(b!==void 0?` text-${b}`:""),style:x.value,fill:"transparent",stroke:"currentColor","stroke-width":g,"stroke-dasharray":Za,"stroke-dashoffset":a,"stroke-linecap":t,cx:k.value,cy:k.value,r:He})}return()=>{const g=[];e.centerColor!==void 0&&e.centerColor!=="transparent"&&g.push(R("circle",{class:`q-circular-progress__center text-${e.centerColor}`,fill:"currentColor",r:He-l.value/2,cx:k.value,cy:k.value})),e.trackColor!==void 0&&e.trackColor!=="transparent"&&g.push(C({cls:"track",thickness:l.value,offset:0,color:e.trackColor})),g.push(C({cls:"circle",thickness:l.value,offset:D.value,color:e.color,rounded:e.rounded===!0?"round":void 0}));const a=[R("svg",{class:"q-circular-progress__svg",style:p.value,viewBox:f.value,"aria-hidden":"true"},g)];return e.showValue===!0&&a.push(R("div",{class:"q-circular-progress__text absolute-full row flex-center content-center",style:{fontSize:e.fontSize}},s.default!==void 0?s.default():[R("div",S.value)])),R("div",{class:`q-circular-progress q-circular-progress--${e.indeterminate===!0?"in":""}determinate`,style:i.value,role:"progressbar","aria-valuemin":e.min,"aria-valuemax":e.max,"aria-valuenow":e.indeterminate===!0?void 0:S.value},Ra(s.internal,a))}}});function _e(e,s,r,i){const p=[];return e.forEach(x=>{i(x)===!0?p.push(x):s.push({failedPropValidation:r,file:x})}),p}function ze(e){e?.dataTransfer&&(e.dataTransfer.dropEffect="copy"),ca(e)}const at={multiple:Boolean,accept:String,capture:String,maxFileSize:[Number,String],maxTotalSize:[Number,String],maxFiles:[Number,String],filter:Function},tt=["rejected"];function lt({editable:e,dnd:s,getFileInput:r,addFilesToQueue:i}){const{props:p,emit:x,proxy:k}=Xe(),f=I(null),S=A(()=>p.accept!==void 0?p.accept.split(",").map(o=>(o=o.trim(),o==="*"?"*/":(o.endsWith("/*")&&(o=o.slice(0,o.length-1)),o.toUpperCase()))):null),y=A(()=>parseInt(p.maxFiles,10)),l=A(()=>parseInt(p.maxTotalSize,10));function D(o){if(e.value)if(o!==Object(o)&&(o={target:null}),o.target?.matches('input[type="file"]')===!0)o.clientX===0&&o.clientY===0&&da(o);else{const q=r();q!==o.target&&q?.click(o)}}function C(o){e.value&&o&&i(null,o)}function g(o,q,V,N){let z=Array.from(q||o.target.files);const M=[],L=()=>{M.length!==0&&x("rejected",M)};if(p.accept!==void 0&&S.value.indexOf("*/")===-1&&(z=_e(z,M,"accept",U=>S.value.some(T=>U.type.toUpperCase().startsWith(T)||U.name.toUpperCase().endsWith(T))),z.length===0))return L();if(p.maxFileSize!==void 0){const U=parseInt(p.maxFileSize,10);if(z=_e(z,M,"max-file-size",T=>T.size<=U),z.length===0)return L()}if(p.multiple!==!0&&z.length!==0&&(z=[z[0]]),z.forEach(U=>{U.__key=U.webkitRelativePath+U.lastModified+U.name+U.size}),N===!0){const U=V.map(T=>T.__key);z=_e(z,M,"duplicate",T=>U.includes(T.__key)===!1)}if(z.length===0)return L();if(p.maxTotalSize!==void 0){let U=N===!0?V.reduce((T,ee)=>T+ee.size,0):0;if(z=_e(z,M,"max-total-size",T=>(U+=T.size,U<=l.value)),z.length===0)return L()}if(typeof p.filter=="function"){const U=p.filter(z);z=_e(z,M,"filter",T=>U.includes(T))}if(p.maxFiles!==void 0){let U=N===!0?V.length:0;if(z=_e(z,M,"max-files",()=>(U++,U<=y.value)),z.length===0)return L()}if(L(),z.length!==0)return z}function a(o){ze(o),s.value!==!0&&(s.value=!0)}function b(o){ca(o),(o.relatedTarget!==null||ka.is.safari!==!0?o.relatedTarget!==f.value:document.elementsFromPoint(o.clientX,o.clientY).includes(f.value)===!1)===!0&&(s.value=!1)}function w(o){ze(o);const q=o.dataTransfer.files;q.length!==0&&i(null,q),s.value=!1}function t(o){if(s.value===!0)return R("div",{ref:f,class:`q-${o}__dnd absolute-full`,onDragenter:ze,onDragover:ze,onDragleave:b,onDrop:w})}return Object.assign(k,{pickFiles:D,addFiles:C}),{pickFiles:D,addFiles:C,onDragover:a,onDragleave:b,processFiles:g,getDndNode:t,maxFilesNumber:y,maxTotalSizeNumber:l}}function ua(e){return(e*100).toFixed(2)+"%"}const ot={...$a,...at,label:String,color:String,textColor:String,square:Boolean,flat:Boolean,bordered:Boolean,noThumbnails:Boolean,thumbnailFit:{type:String,default:"cover"},autoUpload:Boolean,hideUploadBtn:Boolean,disable:Boolean,readonly:Boolean},ha=[...tt,"start","finish","added","removed"];function st(e,s){const r=Xe(),{props:i,slots:p,emit:x,proxy:k}=r,{$q:f}=k,S=Ta(i,f);function y(v,$,G){if(v.__status=$,$==="idle"){v.__uploaded=0,v.__progress=0,v.__sizeLabel=na(v.size),v.__progressLabel="0.00%";return}if($==="failed"){k.$forceUpdate();return}v.__uploaded=$==="uploaded"?v.size:G,v.__progress=$==="uploaded"?1:Math.min(.9999,v.__uploaded/v.size),v.__progressLabel=ua(v.__progress),k.$forceUpdate()}const l=A(()=>i.disable!==!0&&i.readonly!==!0),D=I(!1),C=I(null),g=I(null),a={files:I([]),queuedFiles:I([]),uploadedFiles:I([]),uploadedSize:I(0),updateFileStatus:y,isAlive:()=>Va(r)===!1},{pickFiles:b,addFiles:w,onDragover:t,onDragleave:o,processFiles:q,getDndNode:V,maxFilesNumber:N,maxTotalSizeNumber:z}=lt({editable:l,dnd:D,getFileInput:_,addFilesToQueue:Ze});Object.assign(a,e({props:i,slots:p,emit:x,helpers:a,exposeApi:v=>{Object.assign(a,v)}})),a.isBusy===void 0&&(a.isBusy=I(!1));const M=I(0),L=A(()=>M.value===0?0:a.uploadedSize.value/M.value),U=A(()=>ua(L.value)),T=A(()=>na(M.value)),ee=A(()=>l.value===!0&&a.isUploading.value!==!0&&(i.multiple===!0||a.queuedFiles.value.length===0)&&(i.maxFiles===void 0||a.files.value.length<N.value)&&(i.maxTotalSize===void 0||M.value<z.value)),E=A(()=>l.value===!0&&a.isBusy.value!==!0&&a.isUploading.value!==!0&&a.queuedFiles.value.length!==0);wa(Fa,aa);const ae=A(()=>"q-uploader column no-wrap"+(S.value===!0?" q-uploader--dark q-dark":"")+(i.bordered===!0?" q-uploader--bordered":"")+(i.square===!0?" q-uploader--square no-border-radius":"")+(i.flat===!0?" q-uploader--flat no-shadow":"")+(i.disable===!0?" disabled q-uploader--disable":"")+(D.value===!0?" q-uploader--dnd":"")),se=A(()=>"q-uploader__header"+(i.color!==void 0?` bg-${i.color}`:"")+(i.textColor!==void 0?` text-${i.textColor}`:""));ma(a.isUploading,(v,$)=>{$===!1&&v===!0?x("start"):$===!0&&v===!1&&x("finish")});function ne(){i.disable===!1&&(a.abort(),a.uploadedSize.value=0,M.value=0,c(),a.files.value=[],a.queuedFiles.value=[],a.uploadedFiles.value=[])}function Z(){i.disable===!1&&je(["uploaded"],()=>{a.uploadedFiles.value=[]})}function pe(){je(["idle","failed"],({size:v})=>{M.value-=v,a.queuedFiles.value=[]})}function je(v,$){if(i.disable===!0)return;const G={files:[],size:0},te=a.files.value.filter(W=>v.indexOf(W.__status)===-1?!0:(G.size+=W.size,G.files.push(W),W.__img!==void 0&&window.URL.revokeObjectURL(W.__img.src),!1));G.files.length!==0&&(a.files.value=te,$(G),x("removed",G.files))}function u(v){i.disable||(v.__status==="uploaded"?a.uploadedFiles.value=a.uploadedFiles.value.filter($=>$.__key!==v.__key):v.__status==="uploading"?v.__abort():M.value-=v.size,a.files.value=a.files.value.filter($=>$.__key!==v.__key?!0:($.__img!==void 0&&window.URL.revokeObjectURL($.__img.src),!1)),a.queuedFiles.value=a.queuedFiles.value.filter($=>$.__key!==v.__key),x("removed",[v]))}function c(){a.files.value.forEach(v=>{v.__img!==void 0&&window.URL.revokeObjectURL(v.__img.src)})}function _(){return g.value||C.value.getElementsByClassName("q-uploader__input")[0]}function Ze(v,$){const G=q(v,$,a.files.value,!0),te=_();te!=null&&(te.value=""),G!==void 0&&(G.forEach(W=>{if(a.updateFileStatus(W,"idle"),M.value+=W.size,i.noThumbnails!==!0&&W.type.toUpperCase().startsWith("IMAGE")){const ta=new Image;ta.src=window.URL.createObjectURL(W),W.__img=ta}}),a.files.value=a.files.value.concat(G),a.queuedFiles.value=a.queuedFiles.value.concat(G),x("added",G),i.autoUpload===!0&&a.upload())}function ea(){E.value===!0&&a.upload()}function ke(v,$,G){if(v===!0){const te={type:"a",key:$,icon:f.iconSet.uploader[$],flat:!0,dense:!0};let W;return $==="add"?(te.onClick=b,W=aa):te.onClick=G,R(J,te,W)}}function aa(){return R("input",{ref:g,class:"q-uploader__input overflow-hidden absolute-full",tabindex:-1,type:"file",title:"",accept:i.accept,multiple:i.multiple===!0?"multiple":void 0,capture:i.capture,onMousedown:da,onClick:b,onChange:Ze})}function xa(){return p.header!==void 0?p.header(ge):[R("div",{class:"q-uploader__header-content column"},[R("div",{class:"flex flex-center no-wrap q-gutter-xs"},[ke(a.queuedFiles.value.length!==0,"removeQueue",pe),ke(a.uploadedFiles.value.length!==0,"removeUploaded",Z),a.isUploading.value===!0?R(oa,{class:"q-uploader__spinner"}):null,R("div",{class:"col column justify-center"},[i.label!==void 0?R("div",{class:"q-uploader__title"},[i.label]):null,R("div",{class:"q-uploader__subtitle"},[T.value+" / "+U.value])]),ke(ee.value,"add"),ke(i.hideUploadBtn===!1&&E.value===!0,"upload",a.upload),ke(a.isUploading.value,"clear",a.abort)])])]}function _a(){return p.list!==void 0?p.list(ge):a.files.value.map(v=>R("div",{key:v.__key,class:"q-uploader__file relative-position"+(i.noThumbnails!==!0&&v.__img!==void 0?" q-uploader__file--img":"")+(v.__status==="failed"?" q-uploader__file--failed":v.__status==="uploaded"?" q-uploader__file--uploaded":""),style:i.noThumbnails!==!0&&v.__img!==void 0?{backgroundImage:'url("'+v.__img.src+'")',backgroundSize:i.thumbnailFit}:null},[R("div",{class:"q-uploader__file-header row flex-center no-wrap"},[v.__status==="failed"?R(oe,{class:"q-uploader__file-status",name:f.iconSet.type.negative,color:"negative"}):null,R("div",{class:"q-uploader__file-header-content col"},[R("div",{class:"q-uploader__title"},[v.name]),R("div",{class:"q-uploader__subtitle row items-center no-wrap"},[v.__sizeLabel+" / "+v.__progressLabel])]),v.__status==="uploading"?R(et,{value:v.__progress,min:0,max:1,indeterminate:v.__progress===0}):R(J,{round:!0,dense:!0,flat:!0,icon:f.iconSet.uploader[v.__status==="uploaded"?"done":"clear"],onClick:()=>{u(v)}})])]))}Ue(()=>{a.isUploading.value===!0&&a.abort(),a.files.value.length!==0&&c()});const ge={};for(const v in a)qa(a[v])===!0?Aa(ge,v,()=>a[v].value):ge[v]=a[v];return Object.assign(ge,{upload:ea,reset:ne,removeUploadedFiles:Z,removeQueuedFiles:pe,removeFile:u,pickFiles:b,addFiles:w}),Sa(ge,{canAddFiles:()=>ee.value,canUpload:()=>E.value,uploadSizeLabel:()=>T.value,uploadProgressLabel:()=>U.value}),s({...a,upload:ea,reset:ne,removeUploadedFiles:Z,removeQueuedFiles:pe,removeFile:u,pickFiles:b,addFiles:w,canAddFiles:ee,canUpload:E,uploadSizeLabel:T,uploadProgressLabel:U}),()=>{const v=[R("div",{class:se.value},xa()),R("div",{class:"q-uploader__list scroll"},_a()),V("uploader")];a.isBusy.value===!0&&v.push(R("div",{class:"q-uploader__overlay absolute-full flex flex-center"},[R(oa)]));const $={ref:C,class:ae.value};return ee.value===!0&&Object.assign($,{onDragover:t,onDragleave:o}),R("div",$,v)}}const nt=()=>!0;function rt(e){const s={};return e.forEach(r=>{s[r]=nt}),s}const it=rt(ha),ut=({name:e,props:s,emits:r,injectPlugin:i})=>We({name:e,props:{...ot,...s},emits:ja(r)===!0?{...it,...r}:[...ha,...r],setup(p,{expose:x}){return st(i,x)}});function le(e){return typeof e=="function"?e:()=>e}const dt="QUploader",ct={url:[Function,String],method:{type:[Function,String],default:"POST"},fieldName:{type:[Function,String],default:()=>e=>e.name},headers:[Function,Array],formFields:[Function,Array],withCredentials:[Function,Boolean],sendRaw:[Function,Boolean],batch:[Function,Boolean],factory:Function},mt=["factoryFailed","uploaded","failed","uploading"];function ft({props:e,emit:s,helpers:r}){const i=I([]),p=I([]),x=I(0),k=A(()=>({url:le(e.url),method:le(e.method),headers:le(e.headers),formFields:le(e.formFields),fieldName:le(e.fieldName),withCredentials:le(e.withCredentials),sendRaw:le(e.sendRaw),batch:le(e.batch)})),f=A(()=>x.value>0),S=A(()=>p.value.length!==0);let y;function l(){i.value.forEach(a=>{a.abort()}),p.value.length!==0&&(y=!0)}function D(){const a=r.queuedFiles.value.slice(0);r.queuedFiles.value=[],k.value.batch(a)?C(a):a.forEach(b=>{C([b])})}function C(a){if(x.value++,typeof e.factory!="function"){g(a,{});return}const b=e.factory(a);if(!b)s("factoryFailed",new Error("QUploader: factory() does not return properly"),a),x.value--;else if(typeof b.catch=="function"&&typeof b.then=="function"){p.value.push(b);const w=t=>{r.isAlive()===!0&&(p.value=p.value.filter(o=>o!==b),p.value.length===0&&(y=!1),r.queuedFiles.value=r.queuedFiles.value.concat(a),a.forEach(o=>{r.updateFileStatus(o,"failed")}),s("factoryFailed",t,a),x.value--)};b.then(t=>{y===!0?w(new Error("Aborted")):r.isAlive()===!0&&(p.value=p.value.filter(o=>o!==b),g(a,t))}).catch(w)}else g(a,b||{})}function g(a,b){const w=new FormData,t=new XMLHttpRequest,o=(E,ae)=>b[E]!==void 0?le(b[E])(ae):k.value[E](ae),q=o("url",a);if(!q){console.error("q-uploader: invalid or no URL specified"),x.value--;return}const V=o("formFields",a);V!==void 0&&V.forEach(E=>{w.append(E.name,E.value)});let N=0,z=0,M=0,L=0,U;t.upload.addEventListener("progress",E=>{if(U===!0)return;const ae=Math.min(L,E.loaded);r.uploadedSize.value+=ae-M,M=ae;let se=M-z;for(let ne=N;se>0&&ne<a.length;ne++){const Z=a[ne];if(se>Z.size)se-=Z.size,N++,z+=Z.size,r.updateFileStatus(Z,"uploading",Z.size);else{r.updateFileStatus(Z,"uploading",se);return}}},!1),t.onreadystatechange=()=>{t.readyState<4||(t.status&&t.status<400?(r.uploadedFiles.value=r.uploadedFiles.value.concat(a),a.forEach(E=>{r.updateFileStatus(E,"uploaded")}),s("uploaded",{files:a,xhr:t})):(U=!0,r.uploadedSize.value-=M,r.queuedFiles.value=r.queuedFiles.value.concat(a),a.forEach(E=>{r.updateFileStatus(E,"failed")}),s("failed",{files:a,xhr:t})),x.value--,i.value=i.value.filter(E=>E!==t))},t.open(o("method",a),q),o("withCredentials",a)===!0&&(t.withCredentials=!0);const T=o("headers",a);T!==void 0&&T.forEach(E=>{t.setRequestHeader(E.name,E.value)});const ee=o("sendRaw",a);a.forEach(E=>{r.updateFileStatus(E,"uploading",0),ee!==!0&&w.append(o("fieldName",E),E,E.name),E.xhr=t,E.__abort=()=>{t.abort()},L+=E.size}),s("uploading",{files:a,xhr:t}),i.value.push(t),ee===!0?t.send(new Blob(a)):t.send(w)}return{isUploading:f,isBusy:S,abort:l,upload:D}}const vt={name:dt,props:ct,emits:mt,injectPlugin:ft},pt=ut(vt);class qe{id;filename;filesize;start;end;uploading;done;error;errorHTTPCode;errorMessage;processed;constructor(s,r,i,p,x,k,f,S,y,l,D){this.id=s,this.filename=r,this.filesize=i,this.start=p,this.end=x,this.uploading=k,this.done=f,this.error=S,this.errorHTTPCode=y,this.errorMessage=l,this.processed=D}}const gt={class:"row q-col-gutter-x-sm"},bt={style:{"font-size":"14px"}},ht={key:1,class:"col-6"},xt={style:{"font-size":"14px"}},_t=ie({__name:"DocumentMetadataTopForm",props:{createdAt:{},updatedAt:{}},setup(e){const s=e,{t:r}=ve(),{screen:i}=$e(),p=A(()=>i.gt.xs),x=A(()=>s.createdAt?.timestamp!=s.updatedAt?.timestamp),k=A({get(){return s.createdAt?.dateTime},set(){}}),f=A({get(){return s.createdAt?.dateTime},set(){}});return(S,y)=>(h(),X("div",gt,[e.createdAt?(h(),X("div",{key:0,class:ce({"col-6":x.value,"col-12":!x.value})},[n(we,{dense:"",class:"q-mb-md",outlined:"",modelValue:k.value,"onUpdate:modelValue":y[0]||(y[0]=l=>k.value=l),label:d(r)("Created on"),readonly:""},la({_:2},[p.value?{name:"append",fn:m(()=>[O("span",bt,j(e.createdAt?.timeAgo),1)]),key:"0"}:void 0]),1032,["modelValue","label"])],2)):P("",!0),f.value?(h(),X("div",ht,[n(we,{dense:"",class:"q-mb-md",outlined:"",modelValue:f.value,"onUpdate:modelValue":y[1]||(y[1]=l=>f.value=l),label:d(r)("Last update"),readonly:""},la({_:2},[p.value?{name:"append",fn:m(()=>[O("span",xt,j(e.updatedAt?.timeAgo),1)]),key:"0"}:void 0]),1032,["modelValue","label"])])):P("",!0)]))}}),yt={key:1,class:"q-list-attachments-container scroll"},kt={key:0},qt=ie({__name:"DocumentDetailsAttachments",props:{attachments:{},disable:{type:Boolean,default:!1}},emits:["update:modelValue","addAttachment","previewAttachmentAtIndex","removeAttachmentAtIndex"],setup(e,{emit:s}){const{t:r}=ve(),i=s,p=e,{screen:x}=$e(),k=ye({...me}),f=A(()=>p.disable||k.ajaxRunning),S=ye([]),y=A(()=>p.attachments?.length>0),l=I(null),D=w=>{if(S.length=0,w){const t=pa(String(w));S.push(...p.attachments.filter(o=>!o.name?.match(t)).map(o=>o.id))}},C=()=>{i("addAttachment")},g=w=>{i("removeAttachmentAtIndex",w)},a=w=>{i("previewAttachmentAtIndex",w)},b=(w,t)=>{Oa(ra(w),t).then(()=>{}).catch(()=>{})};return Re(()=>{H.on("reAuthSucess",w=>{w.to?.includes("DocumentDetailsAttachments.onRemoveAttachmentAtIndex")})}),Ue(()=>{H.off("reAuthSucess")}),(w,t)=>(h(),F(va,{class:"bg-transparent q-pa-sm"},{default:m(()=>[n(Ie,{class:"transparent-background text-color-primary q-pa-none"},{default:m(()=>[Y(n(fe,null,{default:m(()=>[n(we,{type:"search",outlined:"",dense:"",clearable:"",disable:f.value||!y.value,modelValue:l.value,"onUpdate:modelValue":[t[0]||(t[0]=o=>l.value=o),D],modelModifiers:{trim:!0},label:d(r)("Filter by text on attachment filename"),placeholder:d(r)("type text search condition")},{prepend:m(()=>[n(oe,{name:"filter_alt"})]),_:1},8,["disable","modelValue","label","placeholder"])]),_:1},512),[[K,y.value]]),n(fe,{side:""},{default:m(()=>[n(J,{size:"md",label:d(r)("Add attachment"),icon:"add","no-caps":"",class:"bg-blue text-white full-width",disable:f.value,onClick:Q(C,["stop"])},null,8,["label","disable"])]),_:1})]),_:1}),n(Le,{class:"q-my-md"}),k.ajaxErrors&&k.ajaxErrorMessage?(h(),F(Ke,{key:0,text:k.ajaxErrorMessage,"api-error":k.ajaxAPIErrorDetails,class:"q-mt-lg"},null,8,["text","api-error"])):P("",!0),y.value?(h(),X("div",yt,[(h(!0),X(Pe,null,Je(e.attachments,(o,q)=>(h(),X("div",{key:o.id},[Y(n(Ie,{class:"q-pa-xs bg-transparent",clickable:"",href:d(ra)(o.id,!0),onClick:Q(V=>b(o.id,o.name),["stop","prevent"])},{default:m(()=>[n(fe,{class:"q-mx-sm"},{default:m(()=>[n(Oe,null,{default:m(()=>[B(j(o.name),1)]),_:2},1024),n(Oe,{caption:""},{default:m(()=>[B(j(d(r)("Size: "))+j(d(Na).humanStorageSize(o.size)),1)]),_:2},1024),n(Oe,{caption:""},{default:m(()=>[B(j(d(r)("Uploaded on: "))+j(o.createdAt.dateTime)+" ("+j(o.createdAt.timeAgo)+") ",1)]),_:2},1024),d(x).lt.xl?(h(),X("div",kt,[n(Ee,{size:"md",square:"",class:ce(["theme-default-q-chip shadow-1 full-width text-center",{"cursor-not-allowed":f.value}]),clickable:!f.value,onClick:Q(V=>g(q),["stop","prevent"])},{default:m(()=>[n(Ce,{class:"theme-default-q-avatar text-white bg-blue-6",icon:"delete"}),B(" "+j(d(r)("Remove")),1)]),_:1},8,["class","clickable","onClick"]),d(xe)(o.name)?(h(),F(Ee,{key:0,size:"md",square:"",class:ce(["theme-default-q-chip shadow-1 full-width",{"cursor-not-allowed":f.value||!d(xe)(o.name)}]),clickable:!f.value&&d(xe)(o.name),onClick:Q(V=>a(q),["stop","prevent"])},{default:m(()=>[n(Ce,{class:"theme-default-q-avatar text-white bg-blue-6",icon:"preview"}),B(" "+j(d(r)("Preview")),1)]),_:1},8,["class","clickable","onClick"])):P("",!0)])):P("",!0)]),_:2},1024),d(x).lt.xl?P("",!0):(h(),F(fe,{key:0,side:"",middle:"",class:"q-mr-sm q-item-section-attachment-actions"},{default:m(()=>[n(Ee,{size:"md",square:"",class:ce(["theme-default-q-chip shadow-1 full-width text-center",{"cursor-not-allowed":f.value}]),clickable:!f.value,onClick:Q(V=>g(q),["stop","prevent"])},{default:m(()=>[n(Ce,{class:"theme-default-q-avatar text-white bg-blue-6",icon:"delete"}),B(" "+j(d(r)("Remove")),1)]),_:1},8,["class","clickable","onClick"]),d(xe)(o.name)?(h(),F(Ee,{key:0,size:"md",square:"",class:ce(["theme-default-q-chip shadow-1 full-width",{"cursor-not-allowed":f.value||!d(xe)(o.name)}]),clickable:!f.value&&d(xe)(o.name),onClick:Q(V=>a(q),["stop","prevent"])},{default:m(()=>[n(Ce,{class:"theme-default-q-avatar text-white bg-blue-6",icon:"preview"}),B(" "+j(d(r)("Preview")),1)]),_:1},8,["class","clickable","onClick"])):P("",!0)]),_:2},1024)),n(Se,null,{default:m(()=>[B(j(d(r)("Click to download")),1)]),_:1})]),_:2},1032,["href","onClick"]),[[K,!S.includes(o.id)]]),q!==e.attachments?.length-1?Y((h(),F(Le,{key:0,class:"q-my-sm"},null,512)),[[K,!S.includes(o.id)]]):P("",!0)]))),128))])):f.value?P("",!0):(h(),F(Fe,{key:2,warning:"",text:"No document attachments found",class:"q-ma-none"}))]),_:1}))}}),At=Me(qt,[["__scopeId","data-v-cf742485"]]),St={key:0},wt={class:"readonly-label"},Ft={class:"absolute-top-right text-grey q-mt-sm"},jt={key:0,class:"text-red q-ml-sm error-message"},Dt=ie({__name:"InteractiveTextFieldCustomInput",props:{modelValue:{},label:{default:""},maxLines:{default:2},rules:{default:()=>[]},autofocus:{type:Boolean,default:!1},startModeEditable:{type:Boolean,default:!0},error:{type:Boolean,default:!1},errorMessage:{default:""}},emits:["update:modelValue"],setup(e,{expose:s,emit:r}){const i=e,p=Da(),{t:x}=ve(),k=$e(),f=A(()=>k.platform.is.desktop),S=r,y=I(null),l=I(!i.startModeEditable),D=A({get(){return i.modelValue},set(q){S("update:modelValue",q)}}),C=I(!f.value),g=I(!0),a=()=>{re().then(()=>{y.value?.focus()}).catch(q=>{console.error(q)})},b=()=>{f.value&&(C.value=!0)},w=()=>{f.value&&(C.value=!1)},t=()=>{l.value=!l.value,l.value||a()};return s({focus:a,unsetReadOnly:()=>{l.value=!1}}),Re(()=>{i.autofocus&&i.startModeEditable&&a()}),(q,V)=>l.value?(h(),X("div",St,[O("div",{class:ce(["cursor-pointer q-pa-sm q-mb-md relative-position white-space-pre-line read-only-input-container",{"border-error":e.error}]),onMouseenter:b,onMouseleave:w,onClick:t},[O("div",wt,j(i.label),1),O("span",Ft,[Te(q.$slots,"top-icon-prepend",{showTopHoverIcons:C.value},void 0,!0),Y(n(oe,{class:"icon-hover",name:g.value?"expand":"unfold_less",size:"sm",onClick:V[0]||(V[0]=Q(N=>g.value=!g.value,["stop"])),"aria-label":d(x)(g.value?"Click to expand":"Click to collapse")},{default:m(()=>[n(Se,null,{default:m(()=>[B(j(d(x)(g.value?"Click to expand":"Click to collapse")),1)]),_:1})]),_:1},8,["name","aria-label"]),[[K,C.value]]),Y(n(oe,{class:"icon-hover q-ml-sm",name:"edit",size:"sm","aria-label":d(x)("Click to toggle edit mode")},{default:m(()=>[n(Se,null,{default:m(()=>[B(j(d(x)("Click to toggle edit mode")),1)]),_:1})]),_:1},8,["aria-label"]),[[K,C.value]]),Te(q.$slots,"top-icon-append",{showTopHoverIcons:C.value},void 0,!0)]),O("div",{class:ce(["q-mt-sm",{collapsed:g.value}]),style:Ca(`--max-lines: ${e.maxLines}`)},j(D.value),7)],34),e.error?(h(),X("p",jt,j(e.errorMessage),1)):P("",!0)])):(h(),F(d(we),Ea({key:1},d(p),{ref_key:"qInputRef",ref:y,label:e.label,modelValue:D.value,"onUpdate:modelValue":V[1]||(V[1]=N=>D.value=N),modelModifiers:{trim:!0},rules:e.rules,error:e.error,"error-message":e.errorMessage}),{append:m(()=>[e.error?P("",!0):(h(),F(oe,{key:0,name:"done",class:"cursor-pointer",onClick:Q(t,["stop"])},{default:m(()=>[n(Se,null,{default:m(()=>[B(j(d(x)("Click to toggle edit mode")),1)]),_:1})]),_:1})),Te(q.$slots,"icon-append-on-edit",{},void 0,!0)]),_:3},16,["label","modelValue","rules","error","error-message"]))}}),Ge=Me(Dt,[["__scopeId","data-v-52922d18"]]),Ct={key:0,class:"q-list-notes-container scroll"},Et=ie({__name:"DocumentDetailsNotes",props:{notes:{},disable:{type:Boolean,default:!1}},emits:["update:modelValue","addNote","removeNoteAtIndex"],setup(e,{emit:s}){const{t:r}=ve(),{requiredFieldRule:i,fieldIsRequiredLabel:p}=fa(),x=s,k=e,f=ye([]),S=A(()=>k.notes?.length>0),y=I(null),l=g=>{if(f.length=0,g){const a=pa(String(g));f.push(...k.notes.filter(b=>!b.body?.match(a)).map(b=>b.id))}},D=()=>{x("addNote")},C=g=>{x("removeNoteAtIndex",g)};return(g,a)=>(h(),F(va,{class:"bg-transparent q-pa-sm"},{default:m(()=>[n(Ie,{class:"transparent-background text-color-primary q-pa-none"},{default:m(()=>[Y(n(fe,null,{default:m(()=>[n(we,{type:"search",outlined:"",dense:"",clearable:"",disable:e.disable||!S.value,modelValue:y.value,"onUpdate:modelValue":[a[0]||(a[0]=b=>y.value=b),l],modelModifiers:{trim:!0},label:d(r)("Filter by text on note body"),placeholder:d(r)("type text search condition")},{prepend:m(()=>[n(oe,{name:"filter_alt"})]),_:1},8,["disable","modelValue","label","placeholder"])]),_:1},512),[[K,S.value]]),n(fe,{side:""},{default:m(()=>[n(J,{size:"md",label:d(r)("Add note"),icon:"add","no-caps":"",class:"bg-blue text-white full-width",disable:e.disable,onClick:Q(D,["stop","prevent"])},null,8,["label","disable"])]),_:1})]),_:1}),n(Le,{class:"q-my-md"}),S.value?(h(),X("div",Ct,[(h(!0),X(Pe,null,Je(e.notes,(b,w)=>Y((h(),F(Ie,{class:"q-pa-none bg-transparent",key:b.id},{default:m(()=>[n(fe,null,{default:m(()=>[n(Ge,{modelValue:b.body,"onUpdate:modelValue":t=>b.body=t,modelModifiers:{trim:!0},dense:"",outlined:"",type:"textarea",maxlength:"4096",autogrow:"",name:"description",label:`${b.createdAt.dateTime} (${b.createdAt.timeAgo})`,"start-mode-editable":!!b.startOnEditMode,disable:e.disable,clearable:"","max-lines":6,rules:[d(i)],error:!b.body,"error-message":d(p),autofocus:b.startOnEditMode,placeholder:d(r)("type note body")},{"top-icon-append":m(({showTopHoverIcons:t})=>[Y(n(oe,{name:"delete",size:"sm",class:"q-ml-sm q-mr-sm icon-hover",clickable:"",onClick:Q(o=>C(w),["stop","prevent"])},{default:m(()=>[n(Se,null,{default:m(()=>[B(j(d(r)("Click to remove note")),1)]),_:1})]),_:1},8,["onClick"]),[[K,t]])]),"icon-append-on-edit":m(()=>[n(oe,{name:"delete",size:"sm",class:"cursor-pointer",clickable:"",onClick:Q(t=>C(w),["stop","prevent"])},null,8,["onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue","label","start-mode-editable","disable","rules","error","error-message","autofocus","placeholder"])]),_:2},1024)]),_:2},1024)),[[K,!f.includes(b.id)]])),128))])):e.disable?P("",!0):(h(),F(Fe,{key:1,warning:"",text:"No document notes found",class:"q-ma-none"}))]),_:1}))}}),zt=Me(Et,[["__scopeId","data-v-9b0b7013"]]),It={class:"text-left"},Ut={class:"text-left"},Rt=ie({__name:"DocumentDetailsHistory",props:{modelValue:{},disable:{type:Boolean,default:!1}},setup(e){const{t:s}=ve(),r=e,i=A({get(){return r.modelValue},set(){}}),p=A(()=>i.value?.length>0);return(x,k)=>p.value?(h(),F(Ja,{key:0,class:"bg-transparent q-pa-sm q-list-history-container scroll"},{default:m(()=>[O("thead",null,[O("tr",null,[O("th",It,j(d(s)("Date")),1),O("th",Ut,j(d(s)("Operation")),1)])]),O("tbody",null,[(h(!0),X(Pe,null,Je(i.value,f=>(h(),X("tr",{key:f.id},[O("td",null,j(f.createdAt.dateTime)+" ("+j(f.createdAt.timeAgo)+")",1),O("td",null,[n(oe,{size:"md",name:f.icon,class:"q-mr-sm"},null,8,["name"]),B(j(d(s)(f.label)),1)])]))),128))])]),_:1})):e.disable?P("",!0):(h(),F(Fe,{key:1,warning:"",text:"No document history found",class:"q-ma-none"}))}}),Pt=Me(Rt,[["__scopeId","data-v-6a05af7e"]]),Mt={class:"q-ma-md"},$t=ie({__name:"DeleteDocumentConfirmationDialog",props:{documentId:{}},emits:["close"],setup(e,{emit:s}){const{t:r}=ve(),i=s,p=Ye(),x=e,k=I(!0),f=ye({...me}),S=I(!1),y=()=>{Object.assign(f,me),f.ajaxRunning=!0,Ae.document.remove(x.documentId).then(()=>{S.value=!0}).catch(D=>{if(f.ajaxErrors=!0,D.isAPIError)switch(f.ajaxAPIErrorDetails=D.customAPIErrorDetails,D.response.status){case 401:f.ajaxErrors=!1,H.emit("reAuthRequired",{emitter:"DeleteDocumentConfirmationDialog.onDelete"});break;case 403:f.ajaxErrorMessage="Error removing (non existent) document";break;case 404:f.ajaxErrorMessage="Error removing document: access denied";break;default:f.ajaxErrorMessage="API Error: fatal error";break}else f.ajaxErrorMessage=`Uncaught exception: ${D}`,console.error(D)}).finally(()=>{f.ajaxRunning=!1})},l=()=>{k.value=!1,S.value?p.push({name:"index"}).catch(D=>{console.error(D)}):i("close")};return Re(()=>{H.on("reAuthSucess",D=>{D.to?.includes("DeleteDocumentConfirmationDialog.onDelete")&&y()})}),Ue(()=>{H.off("reAuthSucess")}),(D,C)=>(h(),F(Qa,{modelValue:k.value,"onUpdate:modelValue":C[0]||(C[0]=g=>k.value=g),onClose:l,width:"1280px","max-width":"80vw"},{"header-left":m(()=>[B(j(d(r)("Delete document")),1)]),body:m(()=>[O("div",Mt,[O("p",null,j(d(r)("You are about to delete the current document. Are you sure? (this action cannot be undone).")),1),S.value?(h(),F(Fe,{key:0,class:"q-mt-lg",success:"",text:"The document has been deleted. Upon closing this dialog, you will be redirected to the home screen."})):f.ajaxErrors&&f.ajaxErrorMessage?(h(),F(Ke,{key:1,text:f.ajaxErrorMessage,"api-error":f.ajaxAPIErrorDetails,class:"q-mt-lg"},null,8,["text","api-error"])):P("",!0)])]),actions:m(()=>[S.value?P("",!0):(h(),F(J,{key:0,class:"action-secondary",onClick:Q(l,["stop"]),icon:"close",label:d(r)("Cancel"),disable:f.ajaxRunning},null,8,["label","disable"])),S.value?P("",!0):(h(),F(J,{key:1,color:"primary",onClick:Q(y,["stop"]),icon:"done",label:d(r)("Ok"),disable:f.ajaxRunning},null,8,["label","disable"])),S.value?(h(),F(J,{key:2,color:"primary",onClick:Q(l,["stop"]),icon:"done",label:d(r)("Close")},null,8,["label"])):P("",!0)]),_:1},8,["modelValue"]))}}),Tt={class:"col-12 col-lg-6 col-xl-6 q-px-sm flex"},Vt={class:"col-12 col-lg-6 col-xl-6 q-px-sm flex"},Bt=ie({__name:"DocumentForm",props:{documentId:{}},setup(e){const{t:s}=ve(),r=Ye(),{screen:i}=$e(),p=Wa(),{requiredFieldRule:x,fieldIsRequiredLabel:k}=fa(),f=e;ma(()=>f.documentId,u=>{u?(l.id=u,M()):(l.reset(),g.value?.unsetReadOnly(),re().then(()=>{g.value?.focus()}).catch(c=>{console.error(c)}))});const S=A(()=>i.gt.md),y=A(()=>!f.documentId),l=ye(new La),D=A(()=>p.maxUploadFileSize),C=I(null),g=I(null),a=I(!0),b=I(!1),w=I(!1),t=ye({...me}),o=I(!1),q=I("metadata"),V=I("metadata"),N=I("attachments"),z=u=>{u.preventDefault();const c=u.dataTransfer?.files||[];c.length&&C.value?.addFiles(c)},M=()=>{l.id&&(t.ajaxRunning||(a.value=!0,Object.assign(t,me),t.ajaxRunning=!0,q.value="metadata",Ae.document.get(l.id).then(u=>{l.parseJSONResponse(s,u)}).catch(u=>{if(t.ajaxErrors=!0,u.isAPIError)switch(t.ajaxAPIErrorDetails=u.customAPIErrorDetails,u.response.status){case 401:t.ajaxErrors=!1,H.emit("reAuthRequired",{emitter:"DocumentPage.onRefresh"});break;case 404:t.ajaxErrorMessage="Document not found",a.value=!1;break;default:t.ajaxErrorMessage="API Error: fatal error";break}else t.ajaxErrorMessage=`Uncaught exception: ${u}`,console.error(u)}).finally(()=>{t.ajaxRunning=!1,t.ajaxErrors||q.value=="metadata"&&re().then(()=>{g.value?.focus()}).catch(u=>{console.error(u)})})))},L=()=>{t.ajaxRunning||(b.value=!1,Object.assign(t,me),t.ajaxRunning=!0,y.value?(l.id||(l.id=ue()),Ae.document.add(l).then(()=>{r.push({name:"document",params:{id:l.id}}).catch(u=>{console.error(u)})}).catch(u=>{if(t.ajaxErrors=!0,u.isAPIError)switch(t.ajaxAPIErrorDetails=u.customAPIErrorDetails,u.response.status){case 400:u.response.data.invalidOrMissingParams.find(function(c){return c==="title"})?(t.ajaxErrorMessage=s("API Error: missing document title param"),q.value="metadata",re().then(()=>{g.value?.focus()}).catch(c=>{console.error(c)})):u.response.data.invalidOrMissingParams.find(function(c){return c==="noteBody"})?(t.ajaxErrorMessage=s("API Error: missing document note body"),q.value="details",N.value="notes"):t.ajaxErrorMessage="API Error: fatal error";break;case 401:t.ajaxErrors=!1,H.emit("reAuthRequired",{emitter:"AdvancedSearchPage.onSubmitForm"});break;default:t.ajaxErrorMessage="API Error: fatal error";break}else t.ajaxErrorMessage=`Uncaught exception: ${u}`,console.error(u)}).finally(()=>{t.ajaxRunning=!1,t.ajaxErrors||(b.value=!0,q.value=="metadata"&&re().then(()=>{g.value?.focus()}).catch(u=>{console.error(u)}))})):Ae.document.update(l).then(u=>{l.parseJSONResponse(s,u)}).catch(u=>{if(t.ajaxErrors=!0,u.isAPIError)switch(t.ajaxAPIErrorDetails=u.customAPIErrorDetails,u.response.status){case 400:u.response.data.invalidOrMissingParams.find(function(c){return c==="title"})?(t.ajaxErrorMessage=s("API Error: missing document title param"),q.value="metadata",re().then(()=>{g.value?.focus()}).catch(c=>{console.error(c)})):u.response.data.invalidOrMissingParams.find(function(c){return c==="noteBody"})?(t.ajaxErrorMessage=s("API Error: missing document note body"),q.value="details",N.value="notes"):t.ajaxErrorMessage="API Error: fatal error";break;case 401:t.ajaxErrors=!1,H.emit("reAuthRequired",{emitter:"AdvancedSearchPage.onSubmitForm"});break;default:t.ajaxErrorMessage="API Error: fatal error";break}else t.ajaxErrorMessage=`Uncaught exception: ${u}`,console.error(u)}).finally(()=>{t.ajaxRunning=!1,t.ajaxErrors||(b.value=!0,q.value=="metadata"&&re().then(()=>{g.value?.focus()}).catch(u=>{console.error(u)}))}))},U=()=>{l.id&&(o.value=!0)},T=u=>{N.value="attachments",re().then(()=>{C.value?.pickFiles(u)}).catch(c=>{console.error(c)})},ee=u=>{l.attachments[u].orphaned?(Object.assign(t,me),t.ajaxRunning=!0,Ae.document.removeFile(l.attachments[u].id).then(()=>{l.attachments=l.attachments.filter((c,_)=>_!==u)}).catch(c=>{if(t.ajaxErrors=!0,c.isAPIError)switch(t.ajaxAPIErrorDetails=c.customAPIErrorDetails,c.response.status){case 401:t.ajaxErrors=!1,H.emit("reAuthRequired",{emitter:"DocumentDetailsAttachments.onRemoveAttachmentAtIndex"});break;default:t.ajaxErrorMessage="API Error: fatal error";break}else t.ajaxErrorMessage=`Uncaught exception: ${c}`,console.error(c)}).finally(()=>{t.ajaxRunning=!1})):l.attachments=l.attachments.filter((c,_)=>_!==u)},E=()=>{l.notes.unshift(new Ha(ue(),"",new ia(s,de()),!1,!0))},ae=u=>{l.notes=l.notes.filter((c,_)=>_!==u)},se=()=>{w.value=!0,H.emit("showUploadingDialog",{transfers:C.value?.files.map(u=>new qe(ue(),u.name,u.size,de(),null,!1,!1,!1,null,null,!1))})},ne=u=>{let c=null;try{u.xhr instanceof XMLHttpRequest?c=JSON.parse(u.xhr.response):u.xhr.data&&(c=u.xhr.data)}catch(_){console.error(_)}c!=null?(l.attachments.unshift(new Ga(c.data.id,u.files[0].name,"",u.files[0].size,new ia(s,de()),!0)),H.emit("refreshUploadingDialog.fileUploaded",{transfers:u.files.map(_=>new qe(ue(),_.name,_.size,0,null,!1,!1,!1,null,null,!1))})):H.emit("refreshUploadingDialog.fileUploadRejected",{transfers:u.files.map(_=>new qe(ue(),_.name,_.size,de(),de(),!1,!1,!0,500,"Transfer rejected",!0))})},Z=u=>{console.log("rejected");const c=u.map(_=>new qe(ue(),_.file.name,_.file.size,0,null,!1,!1,!0,_.failedPropValidation=="max-file-size"?413:500,_.failedPropValidation=="max-file-size"?"Content Too Large":"Internal Server Error",!1));H.emit("refreshUploadingDialog.fileUploadRejected",{transfers:c})},pe=u=>{H.emit("refreshUploadingDialog.fileUploadFailed",{transfers:u.files.map(c=>new qe(ue(),c.name,c.size,de(),de(),!1,!1,!0,u.xhr.status,"Transfer failed",!0))})},je=()=>{w.value=!1,C.value?.reset()};return Re(()=>{y.value||f.documentId&&(l.id=f.documentId,M()),H.on("reAuthSucess",u=>{u.to?.includes("DocumentPage.onRefresh")&&M(),u.to?.includes("DocumentPage.onSubmitForm")&&L()})}),Ue(()=>{H.off("reAuthSucess")}),(u,c)=>(h(),X(Pe,null,[O("div",{onDragover:c[11]||(c[11]=Q(()=>{},["prevent"])),onDragenter:c[12]||(c[12]=Q(()=>{},["prevent"])),onDrop:z},[n(d(pt),{ref_key:"uploaderRef",ref:C,class:"hidden","hide-upload-btn":"","no-thumbnails":"","auto-upload":"","field-name":"file",method:"POST",url:"api3/attachment","max-file-size":D.value,multiple:"",onUploaded:ne,onRejected:Z,onFailed:pe,onStart:se,onFinish:je},null,8,["max-file-size"]),n(Ve,{flat:"",class:"bg-transparent"},{default:m(()=>[O("form",{onSubmit:Q(L,["prevent","stop"]),autocorrect:"off",autocapitalize:"off",autocomplete:"off",spellcheck:"false"},[a.value?(h(),F(sa,{key:0,class:"q-ma-sm",spread:""},{default:m(()=>[n(J,{type:"submit",icon:"save",size:"md",color:"primary",title:d(s)("Save"),label:d(s)("Save"),"no-caps":"",onClick:L,disable:t.ajaxRunning||w.value||!l.title,loading:t.ajaxRunning},{loading:m(()=>[n(De,{class:"on-left"}),B(" "+j(d(s)("Saving...")),1)]),_:1},8,["title","label","disable","loading"]),y.value?P("",!0):(h(),F(J,{key:0,type:"button",icon:"autorenew",size:"md",color:"secondary",title:d(s)("Reload"),label:d(s)("Reload"),"no-caps":"",onClick:M,loading:t.ajaxRunning},{loading:m(()=>[n(De,{class:"on-left"}),B(" "+j(d(s)("Loading...")),1)]),_:1},8,["title","label","loading"])),y.value?P("",!0):(h(),F(J,{key:1,type:"button",icon:"delete",size:"md",color:"red",title:d(s)("Delete"),label:d(s)("Delete"),"no-caps":"",onClick:U},null,8,["title","label"]))]),_:1})):P("",!0),n(Be,{class:"lt-lg q-mb-sm",modelValue:q.value,"onUpdate:modelValue":c[0]||(c[0]=_=>q.value=_)},{default:m(()=>[n(be,{name:"metadata",icon:"description",label:d(s)("Document metadata"),class:"cursor-default full-width","no-caps":""},null,8,["label"]),n(be,{name:"details",icon:"list_alt",label:d(s)("Document details"),class:"cursor-default full-width","no-caps":""},null,8,["label"])]),_:1},8,["modelValue"]),a.value?(h(),F(he,{key:1,class:"row q-pa-none"},{default:m(()=>[Y(O("div",Tt,[n(Ve,{class:"q-ma-xs q-mt-sm full-width"},{default:m(()=>[n(he,{class:"q-pa-none q-mb-sm gt-md"},{default:m(()=>[n(Be,{modelValue:V.value,"onUpdate:modelValue":c[1]||(c[1]=_=>V.value=_)},{default:m(()=>[n(be,{name:"metadata",icon:"description",label:d(s)("Document metadata"),"no-caps":"",class:"cursor-default full-width"},null,8,["label"])]),_:1},8,["modelValue"])]),_:1}),n(he,{class:"q-pa-md"},{default:m(()=>[y.value?P("",!0):(h(),F(_t,{key:0,"created-at":l.createdAt,"updated-at":l.updatedAt},null,8,["created-at","updated-at"])),n(Ge,{ref_key:"documentTitleFieldRef",ref:g,dense:"",class:"q-mb-md",maxlength:"128",outlined:"",modelValue:l.title,"onUpdate:modelValue":c[2]||(c[2]=_=>l.title=_),modelModifiers:{trim:!0},type:"textarea",autogrow:"",name:"title",label:d(s)("Document title"),disable:t.ajaxRunning,autofocus:!0,clearable:"","start-mode-editable":y.value,rules:[d(x)],error:!l.title,"error-message":d(k),"max-lines":1},null,8,["modelValue","label","disable","start-mode-editable","rules","error","error-message"]),n(Ge,{dense:"",class:"q-mb-md",outlined:"",modelValue:l.description,"onUpdate:modelValue":c[3]||(c[3]=_=>l.description=_),modelModifiers:{trim:!0},type:"textarea",maxlength:"4096",autogrow:"",name:"description",label:d(s)("Document description"),disable:t.ajaxRunning,clearable:"","start-mode-editable":y.value,"max-lines":6},null,8,["modelValue","label","disable","start-mode-editable"]),n(Xa,{dense:"",modelValue:l.tags,"onUpdate:modelValue":c[4]||(c[4]=_=>l.tags=_),disabled:t.ajaxRunning,"start-mode-editable":y.value,"deny-change-editable-mode":y.value,clearable:""},null,8,["modelValue","disabled","start-mode-editable","deny-change-editable-mode"])]),_:1})]),_:1})],512),[[K,S.value||q.value=="metadata"]]),Y(O("div",Vt,[n(Ve,{class:"q-ma-xs q-mt-sm full-width"},{default:m(()=>[n(he,{class:"q-pa-none q-mb-sm",style:{"border-bottom":"2px solid rgba(0, 0, 0, 0.12)"}},{default:m(()=>[n(Be,{modelValue:N.value,"onUpdate:modelValue":c[5]||(c[5]=_=>N.value=_),align:"left"},{default:m(()=>[n(be,{name:"attachments",icon:"attach_file",disable:t.ajaxRunning,label:d(s)("Attachments")},{default:m(()=>[Y(n(Qe,{floating:""},{default:m(()=>[B(j(l.attachments.length),1)]),_:1},512),[[K,l.hasAttachments]])]),_:1},8,["disable","label"]),n(be,{name:"notes",icon:"forum",disable:t.ajaxRunning,label:d(s)("Notes")},{default:m(()=>[Y(n(Qe,{floating:""},{default:m(()=>[B(j(l.notes.length),1)]),_:1},512),[[K,l.hasNotes]])]),_:1},8,["disable","label"]),l.id?(h(),F(be,{key:0,name:"history",icon:"view_timeline",disable:t.ajaxRunning,label:d(s)("History")},{default:m(()=>[Y(n(Qe,{floating:""},{default:m(()=>[B(j(l.historyOperations.length),1)]),_:1},512),[[K,l.hasHistoryOperations]])]),_:1},8,["disable","label"])):P("",!0)]),_:1},8,["modelValue"])]),_:1}),n(he,{class:"q-pa-none"},{default:m(()=>[n(Ia,{modelValue:N.value,"onUpdate:modelValue":c[10]||(c[10]=_=>N.value=_),animated:"",class:"bg-transparent"},{default:m(()=>[n(Ne,{name:"attachments",class:"q-pa-none"},{default:m(()=>[n(At,{attachments:l.attachments,disable:t.ajaxRunning,onAddAttachment:T,onPreviewAttachmentAtIndex:c[6]||(c[6]=_=>l.previewAttachment(_)),onRemoveAttachmentAtIndex:c[7]||(c[7]=_=>ee(_))},null,8,["attachments","disable"])]),_:1}),n(Ne,{name:"notes",class:"q-pa-none"},{default:m(()=>[n(zt,{notes:l.notes,disable:t.ajaxRunning,onAddNote:E,onRemoveNoteAtIndex:c[8]||(c[8]=_=>ae(_))},null,8,["notes","disable"])]),_:1}),l.id?(h(),F(Ne,{key:0,name:"history",class:"q-pa-none"},{default:m(()=>[n(Pt,{modelValue:l.historyOperations,"onUpdate:modelValue":c[9]||(c[9]=_=>l.historyOperations=_),disable:t.ajaxRunning},null,8,["modelValue","disable"])]),_:1})):P("",!0)]),_:1},8,["modelValue"])]),_:1})]),_:1})],512),[[K,S.value||q.value=="details"]])]),_:1})):P("",!0),n(he,{class:"q-ma-xs q-mt-sm q-px-xs"},{default:m(()=>[b.value?(h(),F(Fe,{key:0,class:"q-mt-md",text:"Document saved",success:""})):t.ajaxErrors&&t.ajaxErrorMessage?(h(),F(Ke,{key:1,class:"q-mt-md","api-error":t.ajaxAPIErrorDetails,text:t.ajaxErrorMessage},null,8,["api-error","text"])):P("",!0)]),_:1}),a.value?(h(),F(sa,{key:2,class:"q-ma-sm",spread:""},{default:m(()=>[n(J,{type:"submit",icon:"save",size:"md",color:"primary",title:d(s)("Save"),label:d(s)("Save"),"no-caps":"",onClick:L,disable:t.ajaxRunning||w.value||!l.title,loading:t.ajaxRunning},{loading:m(()=>[n(De,{class:"on-left"}),B(" "+j(d(s)("Saving...")),1)]),_:1},8,["title","label","disable","loading"]),y.value?P("",!0):(h(),F(J,{key:0,type:"button",icon:"autorenew",size:"md",color:"secondary",title:d(s)("Reload"),label:d(s)("Reload"),"no-caps":"",onClick:M,loading:t.ajaxRunning},{loading:m(()=>[n(De,{class:"on-left"}),B(" "+j(d(s)("Loading...")),1)]),_:1},8,["title","label","loading"])),y.value?P("",!0):(h(),F(J,{key:1,type:"button",icon:"delete",size:"md",color:"red",title:d(s)("Delete"),label:d(s)("Delete"),"no-caps":"",onClick:U},null,8,["title","label"]))]),_:1})):P("",!0)],32)]),_:1})],32),o.value&&l.id?(h(),F($t,{key:0,"document-id":l.id,onClose:c[13]||(c[13]=_=>o.value=!1)},null,8,["document-id"])):P("",!0)],64))}}),il=ie({__name:"DocumentPage",setup(e){const s=Ye(),r=za(),i=I(r.name=="document"&&String(r.params?.id)||null);return s.beforeEach(p=>{p.name=="newDocument"?i.value=null:p.name=="document"&&p.params.id&&(i.value=String(p.params.id))}),(p,x)=>(h(),F(ya,null,{default:m(()=>[n(Bt,{"document-id":i.value},null,8,["document-id"])]),_:1}))}});export{il as default};
