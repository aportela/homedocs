import{Q as y}from"./use-timeout-Dk6CO65c.js";import{a as z}from"./dateTime-BFTmAOKA.js";import{a as _,b as H,l as g,j as B,k,R as G,D as J,n as C,e as v,f as K,S as W,p as X,t as E,g as r,w as l,h as p,q as V,a3 as Y,U as F,T as R,a1 as Z,ac as ee,v as ae,o as n}from"./index-B4QQtCX7.js";import{Q as te}from"./QSelect-Dvj2_7Nw.js";import{a as j}from"./bus-CVwhliaE.js";import{a as oe}from"./api-CoAF7EnE.js";import{d as $}from"./CustomErrorBanner.vue_vue_type_script_setup_true_lang-DBTLD8xq.js";import{_ as q}from"./QItem-BX9y_1c8.js";import{_ as se}from"./BrowseByTagButton.vue_vue_type_script_setup_true_lang-BqhrY0lq.js";import{_ as le}from"./_plugin-vue_export-helper-BlOQ7VLK.js";const ne={class:"readonly-label"},re=_({__name:"InteractiveTagsFieldCustomSelect",props:{startModeEditable:{type:Boolean,default:!1},denyChangeEditableMode:{type:Boolean,default:!1},modelValue:{},disabled:{type:Boolean,default:!1},dense:{type:Boolean},label:{default:"Document tags"}},emits:["update:modelValue","error"],setup(s,{expose:D,emit:N}){const{t:i}=H(),w=s,I=N,h=g(!1),d=g(!w.startModeEditable),u=g(null),c=B({get(){return w.modelValue||[]},set(e){I("update:modelValue",e||[])}}),a=k({...$}),f=k([]),b=k([]),m=g(!1),P=B(()=>m.value?"Only lowercase letters, numbers and hyphens are allowed in tags":"Error loading available tags"),Q=(e,o)=>{const t=/^[0-9a-z-]*$/;m.value=e.length>0&&!t.test(e);const x=e===""?f:f.filter(M=>M.toLowerCase().includes(e.toLowerCase()));o(()=>{b.length=0,e.length>0&&!m.value&&b.push(...x)})},U=(e,o)=>{m.value||o(e)},T=()=>{a.ajaxRunning||(Object.assign(a,$),a.ajaxRunning=!0,oe.tag.search().then(e=>{f.length=0,f.push(...e.data.tags)}).catch(e=>{if(a.ajaxErrors=!0,e.isAPIError)switch(a.ajaxAPIErrorDetails=e.customAPIErrorDetails,e.response.status){case 401:a.ajaxErrors=!1,j.emit("reAuthRequired",{emitter:"InteractiveTagsFieldCustomSelect"});break;default:a.ajaxErrorMessage="API Error: fatal error";break}else a.ajaxErrorMessage=`Uncaught exception: ${e}`,console.error(e);I("error",e.response)}).finally(()=>{a.ajaxRunning=!1}))},O=()=>{u.value?.hidePopup(),u.value?.reset(),u.value?.updateInputValue("")},L=e=>{c.value?.splice(e,1)},S=()=>{ae().then(()=>{u.value?.focus()}).catch(e=>{console.error(e)})};D({focus:S});const A=()=>{d.value=!d.value,d.value||S()};return G(()=>{T(),j.on("reAuthSucess",e=>{e.to?.includes("InteractiveTagsFieldCustomSelect")&&T()})}),J(()=>{j.off("reAuthSucess")}),(e,o)=>d.value?(n(),C("div",{key:0,class:"cursor-pointer q-pa-sm relative-position white-space-pre-line read-only-input-container",onMouseenter:o[0]||(o[0]=t=>h.value=!0),onMouseleave:o[1]||(o[1]=t=>h.value=!1),onClick:A},[K("div",ne,E(r(i)(s.label)),1),s.denyChangeEditableMode?X("",!0):W((n(),v(y,{key:0,name:"edit",size:"sm",class:"absolute-top-right text-grey cursor-pointer q-mr-sm q-mt-sm"},{default:l(()=>[p(q,null,{default:l(()=>[V(E(r(i)("Click to toggle edit mode")),1)]),_:1})]),_:1},512)),[[Y,h.value]]),(n(!0),C(F,null,R(c.value,t=>(n(),v(se,{key:t,tag:t,icon:"tag"},null,8,["tag"]))),128))],32)):(n(),v(r(te),{key:1,ref_key:"selectRef",ref:u,label:r(i)(s.label),modelValue:c.value,"onUpdate:modelValue":o[2]||(o[2]=t=>c.value=t),dense:s.dense,"options-dense":s.dense,outlined:"","use-input":"","use-chips":"",multiple:"","hide-dropdown-icon":"",options:b,"input-debounce":"0","new-value-mode":"add-unique",disable:s.disabled||a.ajaxRunning||a.ajaxErrors,loading:a.ajaxRunning,error:a.ajaxErrors||m.value,"error-message":r(i)(P.value),onFilter:Q,onAdd:O,onNewValue:U},Z({prepend:l(()=>[ee(e.$slots,"prepend",{},()=>[p(y,{name:"tag"})],!0)]),selected:l(()=>[(n(!0),C(F,null,R(c.value,(t,x)=>(n(),v(z,{square:"",removable:!d.value,dense:s.dense,key:t,onRemove:M=>L(x),color:"primary","text-color":"white",icon:"tag",label:t},null,8,["removable","dense","onRemove","label"]))),128))]),_:2},[s.denyChangeEditableMode?void 0:{name:"append",fn:l(()=>[p(y,{name:"done",class:"cursor-pointer",onClick:A},{default:l(()=>[p(q,null,{default:l(()=>[V(E(r(i)("Click to toggle edit mode")),1)]),_:1})]),_:1})]),key:"0"}]),1032,["label","modelValue","dense","options-dense","options","disable","loading","error","error-message"]))}}),be=le(re,[["__scopeId","data-v-7108a7c5"]]);export{be as I};
