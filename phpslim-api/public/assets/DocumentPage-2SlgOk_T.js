import{Q as ya}from"./QPage-JA5HT188.js";import{p as Le,g as q,q as P,s as He,i as z,J as da,L as ca,D as ka,x as ma,z as Ce,a9 as qa,aa as Aa,ab as Sa,a2 as wa,ac as Fa,ad as ja,a as ie,j as K,k as T,Y as Ae,e as r,u as c,X as aa,w as d,b as B,t as w,o as x,h as xe,M as ze,c as E,N as J,Z as Y,m as X,P as Ie,O as Xe,l as N,a7 as Da,a4 as Pe,a1 as Ea,a8 as Ca,n as re,f as Ge,Q as za}from"./index-BSZHI2pT.js";import{Q as Se,a as je}from"./QInput-CMfaQJRq.js";import{a as ta,Q as W}from"./QBtn-BcnWqC13.js";import{Q as la}from"./ClosePopup-CzXLbngJ.js";import{d as ce,c as We,_ as we,a as oa,Q as Re,e as Me,f as ge,b as be,h as Ia,i as Te,u as ue}from"./CustomErrorBanner.vue_vue_type_script_setup_true_lang-a2ZcyAYi.js";import{c as Ua,d as Pa,_ as Ue}from"./_plugin-vue_export-helper-BidlGddk.js";import{k as Ra,l as Ma,b as Ta,e as Va,v as $a,Q as oe,j as Je,h as Ee,i as me,a as Ne,_ as qe}from"./QItem-D4EQvWHO.js";import{b as Ba,h as sa,a as L,Q as Ve,f as Na}from"./QItemLabel-D2xHNXGJ.js";import{a as ke}from"./api-DiLYfQz-.js";import{u as fa}from"./useFormUtils-BHIP2RWg.js";import{d as na,c as $e,_ as Oa,D as Qa,N as La,A as Ha}from"./document-Ly_XOlWt.js";import{b as Xa,u as Ga}from"./axios-RI6aZEej.js";import{I as Wa}from"./InteractiveTagsFieldCustomSelect-CXhgXvXH.js";import{u as fe}from"./vue-i18n.runtime-C1BpSJts.js";import{Q as va,a as ra,D as ia,c as de}from"./date-time-BzOgC_OT.js";import{g as pa}from"./common-CaK3FoAb.js";import{Q as Ja}from"./QMarkupTable-o0JdIHH4.js";import"./localStorage-dsyGJO5t.js";import"./session-bV_Kq9am.js";import"./BrowseByTagButton.vue_vue_type_script_setup_true_lang-DVpKc6yV.js";const Ya=["top","middle","bottom"],Be=Le({name:"QBadge",props:{color:String,textColor:String,floating:Boolean,transparent:Boolean,multiLine:Boolean,outline:Boolean,rounded:Boolean,label:[Number,String],align:{type:String,validator:e=>Ya.includes(e)}},setup(e,{slots:o}){const i=q(()=>e.align!==void 0?{verticalAlign:e.align}:null),s=q(()=>{const v=e.outline===!0&&e.color||e.textColor;return`q-badge flex inline items-center no-wrap q-badge--${e.multiLine===!0?"multi":"single"}-line`+(e.outline===!0?" q-badge--outline":e.color!==void 0?` bg-${e.color}`:"")+(v!==void 0?` text-${v}`:"")+(e.floating===!0?" q-badge--floating":"")+(e.rounded===!0?" q-badge--rounded":"")+(e.transparent===!0?" q-badge--transparent":"")});return()=>P("div",{class:s.value,style:i.value,role:"status","aria-label":e.label},Ua(o.default,e.label!==void 0?[e.label]:[]))}}),Ka={...Ra,min:{type:Number,default:0},max:{type:Number,default:100},color:String,centerColor:String,trackColor:String,fontSize:String,rounded:Boolean,thickness:{type:Number,default:.2,validator:e=>e>=0&&e<=1},angle:{type:Number,default:0},showValue:Boolean,reverse:Boolean,instantFeedback:Boolean},Oe=50,ga=2*Oe,ba=ga*Math.PI,Za=Math.round(ba*1e3)/1e3,et=Le({name:"QCircularProgress",props:{...Ka,value:{type:Number,default:0},animationSpeed:{type:[String,Number],default:600},indeterminate:Boolean},setup(e,{slots:o}){const{proxy:{$q:i}}=He(),s=Ma(e),v=q(()=>{const h=(i.lang.rtl===!0?-1:1)*e.angle;return{transform:e.reverse!==(i.lang.rtl===!0)?`scale3d(-1, 1, 1) rotate3d(0, 0, 1, ${-90-h}deg)`:`rotate3d(0, 0, 1, ${h-90}deg)`}}),b=q(()=>e.instantFeedback!==!0&&e.indeterminate!==!0?{transition:`stroke-dashoffset ${e.animationSpeed}ms ease 0s, stroke ${e.animationSpeed}ms ease`}:""),y=q(()=>ga/(1-e.thickness/2)),p=q(()=>`${y.value/2} ${y.value/2} ${y.value} ${y.value}`),S=q(()=>Ba(e.value,e.min,e.max)),k=q(()=>e.max-e.min),l=q(()=>e.thickness/2*y.value),F=q(()=>{const h=(e.max-S.value)/k.value,t=e.rounded===!0&&S.value<e.max&&h<.25?l.value/2*(1-h/.25):0;return ba*h+t});function j({thickness:h,offset:t,color:g,cls:I,rounded:a}){return P("circle",{class:"q-circular-progress__"+I+(g!==void 0?` text-${g}`:""),style:b.value,fill:"transparent",stroke:"currentColor","stroke-width":h,"stroke-dasharray":Za,"stroke-dashoffset":t,"stroke-linecap":a,cx:y.value,cy:y.value,r:Oe})}return()=>{const h=[];e.centerColor!==void 0&&e.centerColor!=="transparent"&&h.push(P("circle",{class:`q-circular-progress__center text-${e.centerColor}`,fill:"currentColor",r:Oe-l.value/2,cx:y.value,cy:y.value})),e.trackColor!==void 0&&e.trackColor!=="transparent"&&h.push(j({cls:"track",thickness:l.value,offset:0,color:e.trackColor})),h.push(j({cls:"circle",thickness:l.value,offset:F.value,color:e.color,rounded:e.rounded===!0?"round":void 0}));const t=[P("svg",{class:"q-circular-progress__svg",style:v.value,viewBox:p.value,"aria-hidden":"true"},h)];return e.showValue===!0&&t.push(P("div",{class:"q-circular-progress__text absolute-full row flex-center content-center",style:{fontSize:e.fontSize}},o.default!==void 0?o.default():[P("div",S.value)])),P("div",{class:`q-circular-progress q-circular-progress--${e.indeterminate===!0?"in":""}determinate`,style:s.value,role:"progressbar","aria-valuemin":e.min,"aria-valuemax":e.max,"aria-valuenow":e.indeterminate===!0?void 0:S.value},Pa(o.internal,t))}}});function he(e,o,i,s){const v=[];return e.forEach(b=>{s(b)===!0?v.push(b):o.push({failedPropValidation:i,file:b})}),v}function De(e){e?.dataTransfer&&(e.dataTransfer.dropEffect="copy"),ca(e)}const at={multiple:Boolean,accept:String,capture:String,maxFileSize:[Number,String],maxTotalSize:[Number,String],maxFiles:[Number,String],filter:Function},tt=["rejected"];function lt({editable:e,dnd:o,getFileInput:i,addFilesToQueue:s}){const{props:v,emit:b,proxy:y}=He(),p=z(null),S=q(()=>v.accept!==void 0?v.accept.split(",").map(f=>(f=f.trim(),f==="*"?"*/":(f.endsWith("/*")&&(f=f.slice(0,f.length-1)),f.toUpperCase()))):null),k=q(()=>parseInt(v.maxFiles,10)),l=q(()=>parseInt(v.maxTotalSize,10));function F(f){if(e.value)if(f!==Object(f)&&(f={target:null}),f.target?.matches('input[type="file"]')===!0)f.clientX===0&&f.clientY===0&&da(f);else{const A=i();A!==f.target&&A?.click(f)}}function j(f){e.value&&f&&s(null,f)}function h(f,A,O,$){let C=Array.from(A||f.target.files);const R=[],Q=()=>{R.length!==0&&b("rejected",R)};if(v.accept!==void 0&&S.value.indexOf("*/")===-1&&(C=he(C,R,"accept",U=>S.value.some(V=>U.type.toUpperCase().startsWith(V)||U.name.toUpperCase().endsWith(V))),C.length===0))return Q();if(v.maxFileSize!==void 0){const U=parseInt(v.maxFileSize,10);if(C=he(C,R,"max-file-size",V=>V.size<=U),C.length===0)return Q()}if(v.multiple!==!0&&C.length!==0&&(C=[C[0]]),C.forEach(U=>{U.__key=U.webkitRelativePath+U.lastModified+U.name+U.size}),$===!0){const U=O.map(V=>V.__key);C=he(C,R,"duplicate",V=>U.includes(V.__key)===!1)}if(C.length===0)return Q();if(v.maxTotalSize!==void 0){let U=$===!0?O.reduce((V,ee)=>V+ee.size,0):0;if(C=he(C,R,"max-total-size",V=>(U+=V.size,U<=l.value)),C.length===0)return Q()}if(typeof v.filter=="function"){const U=v.filter(C);C=he(C,R,"filter",V=>U.includes(V))}if(v.maxFiles!==void 0){let U=$===!0?O.length:0;if(C=he(C,R,"max-files",()=>(U++,U<=k.value)),C.length===0)return Q()}if(Q(),C.length!==0)return C}function t(f){De(f),o.value!==!0&&(o.value=!0)}function g(f){ca(f),(f.relatedTarget!==null||ka.is.safari!==!0?f.relatedTarget!==p.value:document.elementsFromPoint(f.clientX,f.clientY).includes(p.value)===!1)===!0&&(o.value=!1)}function I(f){De(f);const A=f.dataTransfer.files;A.length!==0&&s(null,A),o.value=!1}function a(f){if(o.value===!0)return P("div",{ref:p,class:`q-${f}__dnd absolute-full`,onDragenter:De,onDragover:De,onDragleave:g,onDrop:I})}return Object.assign(y,{pickFiles:F,addFiles:j}),{pickFiles:F,addFiles:j,onDragover:t,onDragleave:g,processFiles:h,getDndNode:a,maxFilesNumber:k,maxTotalSizeNumber:l}}function ua(e){return(e*100).toFixed(2)+"%"}const ot={...Ta,...at,label:String,color:String,textColor:String,square:Boolean,flat:Boolean,bordered:Boolean,noThumbnails:Boolean,thumbnailFit:{type:String,default:"cover"},autoUpload:Boolean,hideUploadBtn:Boolean,disable:Boolean,readonly:Boolean},ha=[...tt,"start","finish","added","removed"];function st(e,o){const i=He(),{props:s,slots:v,emit:b,proxy:y}=i,{$q:p}=y,S=Va(s,p);function k(m,M,H){if(m.__status=M,M==="idle"){m.__uploaded=0,m.__progress=0,m.__sizeLabel=sa(m.size),m.__progressLabel="0.00%";return}if(M==="failed"){y.$forceUpdate();return}m.__uploaded=M==="uploaded"?m.size:H,m.__progress=M==="uploaded"?1:Math.min(.9999,m.__uploaded/m.size),m.__progressLabel=ua(m.__progress),y.$forceUpdate()}const l=q(()=>s.disable!==!0&&s.readonly!==!0),F=z(!1),j=z(null),h=z(null),t={files:z([]),queuedFiles:z([]),uploadedFiles:z([]),uploadedSize:z(0),updateFileStatus:k,isAlive:()=>$a(i)===!1},{pickFiles:g,addFiles:I,onDragover:a,onDragleave:f,processFiles:A,getDndNode:O,maxFilesNumber:$,maxTotalSizeNumber:C}=lt({editable:l,dnd:F,getFileInput:_,addFilesToQueue:Ye});Object.assign(t,e({props:s,slots:v,emit:b,helpers:t,exposeApi:m=>{Object.assign(t,m)}})),t.isBusy===void 0&&(t.isBusy=z(!1));const R=z(0),Q=q(()=>R.value===0?0:t.uploadedSize.value/R.value),U=q(()=>ua(Q.value)),V=q(()=>sa(R.value)),ee=q(()=>l.value===!0&&t.isUploading.value!==!0&&(s.multiple===!0||t.queuedFiles.value.length===0)&&(s.maxFiles===void 0||t.files.value.length<$.value)&&(s.maxTotalSize===void 0||R.value<C.value)),D=q(()=>l.value===!0&&t.isBusy.value!==!0&&t.isUploading.value!==!0&&t.queuedFiles.value.length!==0);wa(Fa,Ze);const ae=q(()=>"q-uploader column no-wrap"+(S.value===!0?" q-uploader--dark q-dark":"")+(s.bordered===!0?" q-uploader--bordered":"")+(s.square===!0?" q-uploader--square no-border-radius":"")+(s.flat===!0?" q-uploader--flat no-shadow":"")+(s.disable===!0?" disabled q-uploader--disable":"")+(F.value===!0?" q-uploader--dnd":"")),se=q(()=>"q-uploader__header"+(s.color!==void 0?` bg-${s.color}`:"")+(s.textColor!==void 0?` text-${s.textColor}`:""));ma(t.isUploading,(m,M)=>{M===!1&&m===!0?b("start"):M===!0&&m===!1&&b("finish")});function ne(){s.disable===!1&&(t.abort(),t.uploadedSize.value=0,R.value=0,u(),t.files.value=[],t.queuedFiles.value=[],t.uploadedFiles.value=[])}function Z(){s.disable===!1&&Fe(["uploaded"],()=>{t.uploadedFiles.value=[]})}function ve(){Fe(["idle","failed"],({size:m})=>{R.value-=m,t.queuedFiles.value=[]})}function Fe(m,M){if(s.disable===!0)return;const H={files:[],size:0},te=t.files.value.filter(G=>m.indexOf(G.__status)===-1?!0:(H.size+=G.size,H.files.push(G),G.__img!==void 0&&window.URL.revokeObjectURL(G.__img.src),!1));H.files.length!==0&&(t.files.value=te,M(H),b("removed",H.files))}function n(m){s.disable||(m.__status==="uploaded"?t.uploadedFiles.value=t.uploadedFiles.value.filter(M=>M.__key!==m.__key):m.__status==="uploading"?m.__abort():R.value-=m.size,t.files.value=t.files.value.filter(M=>M.__key!==m.__key?!0:(M.__img!==void 0&&window.URL.revokeObjectURL(M.__img.src),!1)),t.queuedFiles.value=t.queuedFiles.value.filter(M=>M.__key!==m.__key),b("removed",[m]))}function u(){t.files.value.forEach(m=>{m.__img!==void 0&&window.URL.revokeObjectURL(m.__img.src)})}function _(){return h.value||j.value.getElementsByClassName("q-uploader__input")[0]}function Ye(m,M){const H=A(m,M,t.files.value,!0),te=_();te!=null&&(te.value=""),H!==void 0&&(H.forEach(G=>{if(t.updateFileStatus(G,"idle"),R.value+=G.size,s.noThumbnails!==!0&&G.type.toUpperCase().startsWith("IMAGE")){const ea=new Image;ea.src=window.URL.createObjectURL(G),G.__img=ea}}),t.files.value=t.files.value.concat(H),t.queuedFiles.value=t.queuedFiles.value.concat(H),b("added",H),s.autoUpload===!0&&t.upload())}function Ke(){D.value===!0&&t.upload()}function _e(m,M,H){if(m===!0){const te={type:"a",key:M,icon:p.iconSet.uploader[M],flat:!0,dense:!0};let G;return M==="add"?(te.onClick=g,G=Ze):te.onClick=H,P(W,te,G)}}function Ze(){return P("input",{ref:h,class:"q-uploader__input overflow-hidden absolute-full",tabindex:-1,type:"file",title:"",accept:s.accept,multiple:s.multiple===!0?"multiple":void 0,capture:s.capture,onMousedown:da,onClick:g,onChange:Ye})}function xa(){return v.header!==void 0?v.header(pe):[P("div",{class:"q-uploader__header-content column"},[P("div",{class:"flex flex-center no-wrap q-gutter-xs"},[_e(t.queuedFiles.value.length!==0,"removeQueue",ve),_e(t.uploadedFiles.value.length!==0,"removeUploaded",Z),t.isUploading.value===!0?P(ta,{class:"q-uploader__spinner"}):null,P("div",{class:"col column justify-center"},[s.label!==void 0?P("div",{class:"q-uploader__title"},[s.label]):null,P("div",{class:"q-uploader__subtitle"},[V.value+" / "+U.value])]),_e(ee.value,"add"),_e(s.hideUploadBtn===!1&&D.value===!0,"upload",t.upload),_e(t.isUploading.value,"clear",t.abort)])])]}function _a(){return v.list!==void 0?v.list(pe):t.files.value.map(m=>P("div",{key:m.__key,class:"q-uploader__file relative-position"+(s.noThumbnails!==!0&&m.__img!==void 0?" q-uploader__file--img":"")+(m.__status==="failed"?" q-uploader__file--failed":m.__status==="uploaded"?" q-uploader__file--uploaded":""),style:s.noThumbnails!==!0&&m.__img!==void 0?{backgroundImage:'url("'+m.__img.src+'")',backgroundSize:s.thumbnailFit}:null},[P("div",{class:"q-uploader__file-header row flex-center no-wrap"},[m.__status==="failed"?P(oe,{class:"q-uploader__file-status",name:p.iconSet.type.negative,color:"negative"}):null,P("div",{class:"q-uploader__file-header-content col"},[P("div",{class:"q-uploader__title"},[m.name]),P("div",{class:"q-uploader__subtitle row items-center no-wrap"},[m.__sizeLabel+" / "+m.__progressLabel])]),m.__status==="uploading"?P(et,{value:m.__progress,min:0,max:1,indeterminate:m.__progress===0}):P(W,{round:!0,dense:!0,flat:!0,icon:p.iconSet.uploader[m.__status==="uploaded"?"done":"clear"],onClick:()=>{n(m)}})])]))}Ce(()=>{t.isUploading.value===!0&&t.abort(),t.files.value.length!==0&&u()});const pe={};for(const m in t)qa(t[m])===!0?Aa(pe,m,()=>t[m].value):pe[m]=t[m];return Object.assign(pe,{upload:Ke,reset:ne,removeUploadedFiles:Z,removeQueuedFiles:ve,removeFile:n,pickFiles:g,addFiles:I}),Sa(pe,{canAddFiles:()=>ee.value,canUpload:()=>D.value,uploadSizeLabel:()=>V.value,uploadProgressLabel:()=>U.value}),o({...t,upload:Ke,reset:ne,removeUploadedFiles:Z,removeQueuedFiles:ve,removeFile:n,pickFiles:g,addFiles:I,canAddFiles:ee,canUpload:D,uploadSizeLabel:V,uploadProgressLabel:U}),()=>{const m=[P("div",{class:se.value},xa()),P("div",{class:"q-uploader__list scroll"},_a()),O("uploader")];t.isBusy.value===!0&&m.push(P("div",{class:"q-uploader__overlay absolute-full flex flex-center"},[P(ta)]));const M={ref:j,class:ae.value};return ee.value===!0&&Object.assign(M,{onDragover:a,onDragleave:f}),P("div",M,m)}}const nt=()=>!0;function rt(e){const o={};return e.forEach(i=>{o[i]=nt}),o}const it=rt(ha),ut=({name:e,props:o,emits:i,injectPlugin:s})=>Le({name:e,props:{...ot,...o},emits:ja(i)===!0?{...it,...i}:[...ha,...i],setup(v,{expose:b}){return st(s,b)}});function le(e){return typeof e=="function"?e:()=>e}const dt="QUploader",ct={url:[Function,String],method:{type:[Function,String],default:"POST"},fieldName:{type:[Function,String],default:()=>e=>e.name},headers:[Function,Array],formFields:[Function,Array],withCredentials:[Function,Boolean],sendRaw:[Function,Boolean],batch:[Function,Boolean],factory:Function},mt=["factoryFailed","uploaded","failed","uploading"];function ft({props:e,emit:o,helpers:i}){const s=z([]),v=z([]),b=z(0),y=q(()=>({url:le(e.url),method:le(e.method),headers:le(e.headers),formFields:le(e.formFields),fieldName:le(e.fieldName),withCredentials:le(e.withCredentials),sendRaw:le(e.sendRaw),batch:le(e.batch)})),p=q(()=>b.value>0),S=q(()=>v.value.length!==0);let k;function l(){s.value.forEach(t=>{t.abort()}),v.value.length!==0&&(k=!0)}function F(){const t=i.queuedFiles.value.slice(0);i.queuedFiles.value=[],y.value.batch(t)?j(t):t.forEach(g=>{j([g])})}function j(t){if(b.value++,typeof e.factory!="function"){h(t,{});return}const g=e.factory(t);if(!g)o("factoryFailed",new Error("QUploader: factory() does not return properly"),t),b.value--;else if(typeof g.catch=="function"&&typeof g.then=="function"){v.value.push(g);const I=a=>{i.isAlive()===!0&&(v.value=v.value.filter(f=>f!==g),v.value.length===0&&(k=!1),i.queuedFiles.value=i.queuedFiles.value.concat(t),t.forEach(f=>{i.updateFileStatus(f,"failed")}),o("factoryFailed",a,t),b.value--)};g.then(a=>{k===!0?I(new Error("Aborted")):i.isAlive()===!0&&(v.value=v.value.filter(f=>f!==g),h(t,a))}).catch(I)}else h(t,g||{})}function h(t,g){const I=new FormData,a=new XMLHttpRequest,f=(D,ae)=>g[D]!==void 0?le(g[D])(ae):y.value[D](ae),A=f("url",t);if(!A){console.error("q-uploader: invalid or no URL specified"),b.value--;return}const O=f("formFields",t);O!==void 0&&O.forEach(D=>{I.append(D.name,D.value)});let $=0,C=0,R=0,Q=0,U;a.upload.addEventListener("progress",D=>{if(U===!0)return;const ae=Math.min(Q,D.loaded);i.uploadedSize.value+=ae-R,R=ae;let se=R-C;for(let ne=$;se>0&&ne<t.length;ne++){const Z=t[ne];if(se>Z.size)se-=Z.size,$++,C+=Z.size,i.updateFileStatus(Z,"uploading",Z.size);else{i.updateFileStatus(Z,"uploading",se);return}}},!1),a.onreadystatechange=()=>{a.readyState<4||(a.status&&a.status<400?(i.uploadedFiles.value=i.uploadedFiles.value.concat(t),t.forEach(D=>{i.updateFileStatus(D,"uploaded")}),o("uploaded",{files:t,xhr:a})):(U=!0,i.uploadedSize.value-=R,i.queuedFiles.value=i.queuedFiles.value.concat(t),t.forEach(D=>{i.updateFileStatus(D,"failed")}),o("failed",{files:t,xhr:a})),b.value--,s.value=s.value.filter(D=>D!==a))},a.open(f("method",t),A),f("withCredentials",t)===!0&&(a.withCredentials=!0);const V=f("headers",t);V!==void 0&&V.forEach(D=>{a.setRequestHeader(D.name,D.value)});const ee=f("sendRaw",t);t.forEach(D=>{i.updateFileStatus(D,"uploading",0),ee!==!0&&I.append(f("fieldName",D),D,D.name),D.xhr=a,D.__abort=()=>{a.abort()},Q+=D.size}),o("uploading",{files:t,xhr:a}),s.value.push(a),ee===!0?a.send(new Blob(t)):a.send(I)}return{isUploading:p,isBusy:S,abort:l,upload:F}}const vt={name:dt,props:ct,emits:mt,injectPlugin:ft},pt=ut(vt);class ye{id;filename;filesize;start;end;uploading;done;error;errorHTTPCode;errorMessage;processed;constructor(o,i,s,v,b,y,p,S,k,l,F){this.id=o,this.filename=i,this.filesize=s,this.start=v,this.end=b,this.uploading=y,this.done=p,this.error=S,this.errorHTTPCode=k,this.errorMessage=l,this.processed=F}}const gt={class:"row q-col-gutter-x-sm"},bt={style:{"font-size":"14px"}},ht={key:1,class:"col-6"},xt={style:{"font-size":"14px"}},_t=ie({__name:"DocumentMetadataTopForm",props:{createdAt:{},updatedAt:{}},setup(e){const o=e,{t:i}=fe(),{screen:s}=Je(),v=q(()=>s.gt.xs),b=q(()=>o.createdAt?.timestamp!=o.updatedAt?.timestamp),y=q({get(){return o.createdAt?.dateTime},set(){}}),p=q({get(){return o.createdAt?.dateTime},set(){}});return(S,k)=>(x(),K("div",gt,[e.createdAt?(x(),K("div",{key:0,class:Ae({"col-6":b.value,"col-12":!b.value})},[r(Se,{dense:"",class:"q-mb-md",outlined:"",modelValue:y.value,"onUpdate:modelValue":k[0]||(k[0]=l=>y.value=l),label:c(i)("Created on"),readonly:""},aa({_:2},[v.value?{name:"append",fn:d(()=>[B("span",bt,w(e.createdAt?.timeAgo),1)]),key:"0"}:void 0]),1032,["modelValue","label"])],2)):T("",!0),p.value?(x(),K("div",ht,[r(Se,{dense:"",class:"q-mb-md",outlined:"",modelValue:p.value,"onUpdate:modelValue":k[1]||(k[1]=l=>p.value=l),label:c(i)("Last update"),readonly:""},aa({_:2},[v.value?{name:"append",fn:d(()=>[B("span",xt,w(e.updatedAt?.timeAgo),1)]),key:"0"}:void 0]),1032,["modelValue","label"])])):T("",!0)]))}}),yt={key:1,class:"q-list-attachments-container scroll"},kt=ie({__name:"DocumentDetailsAttachments",props:{attachments:{},disable:{type:Boolean,default:!1}},emits:["update:modelValue","addAttachment","previewAttachmentAtIndex","removeAttachmentAtIndex"],setup(e,{emit:o}){const{t:i}=fe(),s=o,v=e,b=xe({...ce}),y=q(()=>v.disable||b.ajaxRunning),p=xe([]),S=q(()=>v.attachments?.length>0),k=z(null),l=g=>{if(p.length=0,g){const I=pa(String(g));p.push(...v.attachments.filter(a=>!a.name?.match(I)).map(a=>a.id))}},F=()=>{s("addAttachment")},j=g=>{s("removeAttachmentAtIndex",g)},h=g=>{s("previewAttachmentAtIndex",g)},t=(g,I)=>{Xa(na(g),I).then(()=>{}).catch(()=>{})};return ze(()=>{L.on("reAuthSucess",g=>{g.to?.includes("DocumentDetailsAttachments.onRemoveAttachmentAtIndex")})}),Ce(()=>{L.off("reAuthSucess")}),(g,I)=>(x(),E(va,{class:"bg-transparent q-pa-sm"},{default:d(()=>[r(Ee,{class:"transparent-background text-color-primary q-pa-none"},{default:d(()=>[J(r(me,null,{default:d(()=>[r(Se,{type:"search",outlined:"",dense:"",clearable:"",disable:y.value||!S.value,modelValue:k.value,"onUpdate:modelValue":[I[0]||(I[0]=a=>k.value=a),l],modelModifiers:{trim:!0},label:c(i)("Filter by text on file name"),placeholder:c(i)("type text search condition")},{prepend:d(()=>[r(oe,{name:"filter_alt"})]),_:1},8,["disable","modelValue","label","placeholder"])]),_:1},512),[[Y,S.value]]),r(me,{side:""},{default:d(()=>[r(W,{size:"md",label:c(i)("Add attachment"),icon:"add",class:"bg-blue text-white full-width",disable:y.value,onClick:X(F,["stop"])},null,8,["label","disable"])]),_:1})]),_:1}),r(Ne,{class:"q-my-md"}),b.ajaxErrors&&b.ajaxErrorMessage?(x(),E(We,{key:0,text:b.ajaxErrorMessage,"api-error":b.ajaxAPIErrorDetails,class:"q-mt-lg"},null,8,["text","api-error"])):T("",!0),S.value?(x(),K("div",yt,[(x(!0),K(Ie,null,Xe(e.attachments,(a,f)=>(x(),K("div",{key:a.id},[J(r(Ee,{class:"q-pa-xs bg-transparent",clickable:"",href:c(na)(a.id,!0),onClick:X(A=>t(a.id,a.name),["stop","prevent"])},{default:d(()=>[r(me,{class:"q-mx-sm"},{default:d(()=>[r(Ve,null,{default:d(()=>[N(w(c(i)("Filename: "))+" "+w(a.name),1)]),_:2},1024),r(Ve,{caption:""},{default:d(()=>[N(w(c(i)("Size: "))+w(c(Na).humanStorageSize(a.size)),1)]),_:2},1024),r(Ve,{caption:""},{default:d(()=>[N(w(c(i)("Uploaded on: "))+w(a.createdAt.dateTime)+" ("+w(a.createdAt.timeAgo)+") ",1)]),_:2},1024)]),_:2},1024),r(me,{side:"",middle:"",class:"q-mr-sm q-item-section-attachment-actions"},{default:d(()=>[r(ra,{size:"md",square:"",class:Ae(["theme-default-q-chip shadow-1 full-width text-center",{"cursor-not-allowed":y.value}]),clickable:!y.value,onClick:X(A=>j(f),["stop","prevent"])},{default:d(()=>[r(oa,{class:"theme-default-q-avatar text-white bg-blue-6",icon:"delete"}),N(" "+w(c(i)("Remove")),1)]),_:1},8,["class","clickable","onClick"]),c($e)(a.name)?(x(),E(ra,{key:0,size:"md",square:"",class:Ae(["theme-default-q-chip shadow-1 full-width",{"cursor-not-allowed":y.value||!c($e)(a.name)}]),clickable:!y.value&&c($e)(a.name),onClick:X(A=>h(f),["stop","prevent"])},{default:d(()=>[r(oa,{class:"theme-default-q-avatar text-white bg-blue-6",icon:"preview"}),N(" "+w(c(i)("Preview")),1)]),_:1},8,["class","clickable","onClick"])):T("",!0)]),_:2},1024),r(qe,null,{default:d(()=>[N(w(c(i)("Click to download")),1)]),_:1})]),_:2},1032,["href","onClick"]),[[Y,!p.includes(a.id)]]),f!==e.attachments?.length-1?J((x(),E(Ne,{key:0,class:"q-my-sm"},null,512)),[[Y,!p.includes(a.id)]]):T("",!0)]))),128))])):y.value?T("",!0):(x(),E(we,{key:2,warning:"",text:"No document attachments found",class:"q-ma-none"}))]),_:1}))}}),qt=Ue(kt,[["__scopeId","data-v-75598885"]]),At={key:0},St={class:"readonly-label"},wt={class:"absolute-top-right text-grey q-mt-sm"},Ft={key:0,class:"text-red q-ml-sm error-message"},jt=ie({__name:"InteractiveTextFieldCustomInput",props:{modelValue:{},label:{default:""},maxLines:{default:2},rules:{default:()=>[]},autofocus:{type:Boolean,default:!1},startModeEditable:{type:Boolean,default:!0},error:{type:Boolean,default:!1},errorMessage:{default:""}},emits:["update:modelValue"],setup(e,{expose:o,emit:i}){const s=e,v=Da(),{t:b}=fe(),y=Je(),p=q(()=>y.platform.is.desktop),S=i,k=z(null),l=z(!s.startModeEditable),F=q({get(){return s.modelValue},set(A){S("update:modelValue",A)}}),j=z(!p.value),h=z(!0),t=()=>{re().then(()=>{k.value?.focus()}).catch(A=>{console.error(A)})},g=()=>{p.value&&(j.value=!0)},I=()=>{p.value&&(j.value=!1)},a=()=>{l.value=!l.value,l.value||t()};return o({focus:t,unsetReadOnly:()=>{l.value=!1}}),ze(()=>{s.autofocus&&s.startModeEditable&&t()}),(A,O)=>l.value?(x(),K("div",At,[B("div",{class:Ae(["cursor-pointer q-pa-sm q-mb-md relative-position white-space-pre-line read-only-input-container",{"border-error":e.error}]),onMouseenter:g,onMouseleave:I,onClick:a},[B("div",St,w(s.label),1),B("span",wt,[Pe(A.$slots,"top-icon-prepend",{showTopHoverIcons:j.value},void 0,!0),J(r(oe,{class:"icon-hover",name:h.value?"expand":"unfold_less",size:"sm",onClick:O[0]||(O[0]=X($=>h.value=!h.value,["stop"])),"aria-label":c(b)(h.value?"Click to expand":"Click to collapse")},{default:d(()=>[r(qe,null,{default:d(()=>[N(w(c(b)(h.value?"Click to expand":"Click to collapse")),1)]),_:1})]),_:1},8,["name","aria-label"]),[[Y,j.value]]),J(r(oe,{class:"icon-hover q-ml-sm",name:"edit",size:"sm","aria-label":c(b)("Click to toggle edit mode")},{default:d(()=>[r(qe,null,{default:d(()=>[N(w(c(b)("Click to toggle edit mode")),1)]),_:1})]),_:1},8,["aria-label"]),[[Y,j.value]]),Pe(A.$slots,"top-icon-append",{showTopHoverIcons:j.value},void 0,!0)]),B("div",{class:Ae(["q-mt-sm",{collapsed:h.value}]),style:Ea(`--max-lines: ${e.maxLines}`)},w(F.value),7)],34),e.error?(x(),K("p",Ft,w(e.errorMessage),1)):T("",!0)])):(x(),E(c(Se),Ca({key:1},c(v),{ref_key:"qInputRef",ref:k,label:e.label,modelValue:F.value,"onUpdate:modelValue":O[1]||(O[1]=$=>F.value=$),modelModifiers:{trim:!0},rules:e.rules,error:e.error,"error-message":e.errorMessage}),{append:d(()=>[e.error?T("",!0):(x(),E(oe,{key:0,name:"done",class:"cursor-pointer",onClick:X(a,["stop"])},{default:d(()=>[r(qe,null,{default:d(()=>[N(w(c(b)("Click to toggle edit mode")),1)]),_:1})]),_:1})),Pe(A.$slots,"icon-append-on-edit",{},void 0,!0)]),_:3},16,["label","modelValue","rules","error","error-message"]))}}),Qe=Ue(jt,[["__scopeId","data-v-52922d18"]]),Dt={key:0,class:"q-list-notes-container scroll"},Et=ie({__name:"DocumentDetailsNotes",props:{notes:{},disable:{type:Boolean,default:!1}},emits:["update:modelValue","addNote","removeNoteAtIndex"],setup(e,{emit:o}){const{t:i}=fe(),{requiredFieldRule:s,fieldIsRequiredLabel:v}=fa(),b=o,y=e,p=xe([]),S=q(()=>y.notes?.length>0),k=z(null),l=h=>{if(p.length=0,h){const t=pa(String(h));p.push(...y.notes.filter(g=>!g.body?.match(t)).map(g=>g.id))}},F=()=>{b("addNote")},j=h=>{b("removeNoteAtIndex",h)};return(h,t)=>(x(),E(va,{class:"bg-transparent q-pa-sm"},{default:d(()=>[r(Ee,{class:"transparent-background text-color-primary q-pa-none"},{default:d(()=>[J(r(me,null,{default:d(()=>[r(Se,{type:"search",outlined:"",dense:"",clearable:"",disable:e.disable||!S.value,modelValue:k.value,"onUpdate:modelValue":[t[0]||(t[0]=g=>k.value=g),l],modelModifiers:{trim:!0},label:c(i)("Filter by text on note body"),placeholder:c(i)("type text search condition")},{prepend:d(()=>[r(oe,{name:"filter_alt"})]),_:1},8,["disable","modelValue","label","placeholder"])]),_:1},512),[[Y,S.value]]),r(me,{side:""},{default:d(()=>[r(W,{size:"md",label:c(i)("Add note"),icon:"add",class:"bg-blue text-white full-width",disable:e.disable,onClick:X(F,["stop","prevent"])},null,8,["label","disable"])]),_:1})]),_:1}),r(Ne,{class:"q-my-md"}),S.value?(x(),K("div",Dt,[(x(!0),K(Ie,null,Xe(e.notes,(g,I)=>J((x(),E(Ee,{class:"q-pa-none bg-transparent",key:g.id},{default:d(()=>[r(me,null,{default:d(()=>[r(Qe,{modelValue:g.body,"onUpdate:modelValue":a=>g.body=a,modelModifiers:{trim:!0},dense:"",outlined:"",type:"textarea",maxlength:"4096",autogrow:"",name:"description",label:`${g.createdAt.dateTime} (${g.createdAt.timeAgo})`,"start-mode-editable":!!g.startOnEditMode,disable:e.disable,clearable:"","max-lines":6,rules:[c(s)],error:!g.body,"error-message":c(v),autofocus:g.startOnEditMode,placeholder:c(i)("type note body")},{"top-icon-append":d(({showTopHoverIcons:a})=>[J(r(oe,{name:"delete",size:"sm",class:"q-ml-sm q-mr-sm icon-hover",clickable:"",onClick:X(f=>j(I),["stop","prevent"])},{default:d(()=>[r(qe,null,{default:d(()=>[N(w(c(i)("Click to remove note")),1)]),_:1})]),_:1},8,["onClick"]),[[Y,a]])]),"icon-append-on-edit":d(()=>[r(oe,{name:"delete",size:"sm",class:"cursor-pointer",clickable:"",onClick:X(a=>j(I),["stop","prevent"])},null,8,["onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue","label","start-mode-editable","disable","rules","error","error-message","autofocus","placeholder"])]),_:2},1024)]),_:2},1024)),[[Y,!p.includes(g.id)]])),128))])):e.disable?T("",!0):(x(),E(we,{key:1,warning:"",text:"No document notes found",class:"q-ma-none"}))]),_:1}))}}),Ct=Ue(Et,[["__scopeId","data-v-4520d6dd"]]),zt={class:"text-left"},It={class:"text-left"},Ut=ie({__name:"DocumentDetailsHistory",props:{modelValue:{},disable:{type:Boolean,default:!1}},setup(e){const{t:o}=fe(),i=e,s=q({get(){return i.modelValue},set(){}}),v=q(()=>s.value?.length>0);return(b,y)=>v.value?(x(),E(Ja,{key:0,class:"bg-transparent q-pa-sm q-list-history-container scroll"},{default:d(()=>[B("thead",null,[B("tr",null,[B("th",zt,w(c(o)("Date")),1),B("th",It,w(c(o)("Operation")),1)])]),B("tbody",null,[(x(!0),K(Ie,null,Xe(s.value,p=>(x(),K("tr",{key:p.id},[B("td",null,w(p.createdAt.dateTime)+" ("+w(p.createdAt.timeAgo)+")",1),B("td",null,[r(oe,{size:"md",name:p.icon,class:"q-mr-sm"},null,8,["name"]),N(w(c(o)(p.label)),1)])]))),128))])]),_:1})):e.disable?T("",!0):(x(),E(we,{key:1,warning:"",text:"No document history found",class:"q-ma-none"}))}}),Pt=Ue(Ut,[["__scopeId","data-v-e87102d0"]]),Rt={class:"q-ma-md"},Mt=ie({__name:"DeleteDocumentConfirmationDialog",props:{documentId:{}},emits:["close"],setup(e,{emit:o}){const{t:i}=fe(),s=o,v=Ge(),b=e,y=z(!0),p=xe({...ce}),S=z(!1),k=()=>{Object.assign(p,ce),p.ajaxRunning=!0,ke.document.remove(b.documentId).then(()=>{S.value=!0}).catch(F=>{if(p.ajaxErrors=!0,F.isAPIError)switch(p.ajaxAPIErrorDetails=F.customAPIErrorDetails,F.response.status){case 401:p.ajaxErrorMessage="Auth session expired, requesting new...",L.emit("reAuthRequired",{emitter:"DeleteDocumentConfirmationDialog.onDelete"});break;case 403:p.ajaxErrorMessage="Error removing (non existent) document";break;case 404:p.ajaxErrorMessage="Error removing document: access denied";break;default:p.ajaxErrorMessage="API Error: fatal error";break}else p.ajaxErrorMessage=`Uncaught exception: ${F}`,console.error(F)}).finally(()=>{p.ajaxRunning=!1})},l=()=>{y.value=!1,S.value?v.push({name:"index"}).catch(F=>{console.error(F)}):s("close")};return ze(()=>{L.on("reAuthSucess",F=>{F.to?.includes("DeleteDocumentConfirmationDialog.onDelete")&&k()})}),Ce(()=>{L.off("reAuthSucess")}),(F,j)=>(x(),E(Oa,{modelValue:y.value,"onUpdate:modelValue":j[0]||(j[0]=h=>y.value=h),onClose:l,width:"1280px","max-width":"80vw"},{"header-left":d(()=>[N(w(c(i)("Delete document")),1)]),body:d(()=>[B("div",Rt,[B("p",null,w(c(i)("You are about to delete the current document. Are you sure? (this action cannot be undone).")),1),S.value?(x(),E(we,{key:0,class:"q-mt-lg",success:"",text:"The document has been deleted. Upon closing this dialog, you will be redirected to the home screen."})):p.ajaxErrors&&p.ajaxErrorMessage?(x(),E(We,{key:1,text:p.ajaxErrorMessage,"api-error":p.ajaxAPIErrorDetails,class:"q-mt-lg"},null,8,["text","api-error"])):T("",!0)])]),actions:d(()=>[S.value?T("",!0):(x(),E(W,{key:0,class:"action-secondary",onClick:X(l,["stop"]),icon:"close",label:c(i)("Cancel"),disable:p.ajaxRunning},null,8,["label","disable"])),S.value?T("",!0):(x(),E(W,{key:1,color:"primary",onClick:X(k,["stop"]),icon:"done",label:c(i)("Ok"),disable:p.ajaxRunning},null,8,["label","disable"])),S.value?(x(),E(W,{key:2,color:"primary",onClick:X(l,["stop"]),icon:"done",label:c(i)("Close")},null,8,["label"])):T("",!0)]),_:1},8,["modelValue"]))}}),Tt={class:"col-12 col-lg-6 col-xl-6 q-px-sm flex"},Vt={class:"col-12 col-lg-6 col-xl-6 q-px-sm flex"},$t=ie({__name:"DocumentForm",props:{documentId:{}},setup(e){const{t:o}=fe(),i=Ge(),{screen:s}=Je(),v=Ga(),{requiredFieldRule:b,fieldIsRequiredLabel:y}=fa(),p=e;ma(()=>p.documentId,n=>{n?(l.id=n,R()):(l.reset(),h.value?.unsetReadOnly(),re().then(()=>{h.value?.focus()}).catch(u=>{console.error(u)}))});const S=q(()=>s.gt.md),k=q(()=>!p.documentId),l=xe(new Qa),F=q(()=>v.maxUploadFileSize),j=z(null),h=z(null),t=z(!0),g=z(!1),I=z(!1),a=xe({...ce}),f=z(!1),A=z("metadata"),O=z("metadata"),$=z("attachments"),C=n=>{n.preventDefault();const u=n.dataTransfer?.files||[];u.length&&j.value?.addFiles(u)},R=()=>{l.id&&(a.ajaxRunning||(t.value=!0,Object.assign(a,ce),a.ajaxRunning=!0,A.value="metadata",ke.document.get(l.id).then(n=>{l.parseJSONResponse(o,n)}).catch(n=>{if(a.ajaxErrors=!0,n.isAPIError)switch(a.ajaxAPIErrorDetails=n.customAPIErrorDetails,n.response.status){case 401:a.ajaxErrorMessage="Auth session expired, requesting new...",L.emit("reAuthRequired",{emitter:"DocumentPage.onRefresh"});break;case 404:a.ajaxErrorMessage="Document not found",t.value=!1;break;default:a.ajaxErrorMessage="API Error: fatal error";break}else a.ajaxErrorMessage=`Uncaught exception: ${n}`,console.error(n)}).finally(()=>{a.ajaxRunning=!1,a.ajaxErrors||A.value=="metadata"&&re().then(()=>{h.value?.focus()}).catch(n=>{console.error(n)})})))},Q=()=>{a.ajaxRunning||(g.value=!1,Object.assign(a,ce),a.ajaxRunning=!0,k.value?(l.id||(l.id=ue()),ke.document.add(l).then(()=>{i.push({name:"document",params:{id:l.id}}).catch(n=>{console.error(n)})}).catch(n=>{if(a.ajaxErrors=!0,n.isAPIError)switch(a.ajaxAPIErrorDetails=n.customAPIErrorDetails,n.response.status){case 400:n.response.data.invalidOrMissingParams.find(function(u){return u==="title"})?(a.ajaxErrorMessage=o("API Error: missing document title param"),A.value="metadata",re().then(()=>{h.value?.focus()}).catch(u=>{console.error(u)})):n.response.data.invalidOrMissingParams.find(function(u){return u==="noteBody"})?(a.ajaxErrorMessage=o("API Error: missing document note body"),A.value="details",$.value="notes"):a.ajaxErrorMessage="API Error: fatal error";break;case 401:a.ajaxErrorMessage="Auth session expired, requesting new...",L.emit("reAuthRequired",{emitter:"AdvancedSearchPage.onSubmitForm"});break;default:a.ajaxErrorMessage="API Error: fatal error";break}else a.ajaxErrorMessage=`Uncaught exception: ${n}`,console.error(n)}).finally(()=>{a.ajaxRunning=!1,a.ajaxErrors||(g.value=!0,A.value=="metadata"&&re().then(()=>{h.value?.focus()}).catch(n=>{console.error(n)}))})):ke.document.update(l).then(n=>{l.parseJSONResponse(o,n)}).catch(n=>{if(a.ajaxErrors=!0,n.isAPIError)switch(a.ajaxAPIErrorDetails=n.customAPIErrorDetails,n.response.status){case 400:n.response.data.invalidOrMissingParams.find(function(u){return u==="title"})?(a.ajaxErrorMessage=o("API Error: missing document title param"),A.value="metadata",re().then(()=>{h.value?.focus()}).catch(u=>{console.error(u)})):n.response.data.invalidOrMissingParams.find(function(u){return u==="noteBody"})?(a.ajaxErrorMessage=o("API Error: missing document note body"),A.value="details",$.value="notes"):a.ajaxErrorMessage="API Error: fatal error";break;case 401:a.ajaxErrorMessage="Auth session expired, requesting new...",L.emit("reAuthRequired",{emitter:"AdvancedSearchPage.onSubmitForm"});break;default:a.ajaxErrorMessage="API Error: fatal error";break}else a.ajaxErrorMessage=`Uncaught exception: ${n}`,console.error(n)}).finally(()=>{a.ajaxRunning=!1,a.ajaxErrors||(g.value=!0,A.value=="metadata"&&re().then(()=>{h.value?.focus()}).catch(n=>{console.error(n)}))}))},U=()=>{l.id&&(f.value=!0)},V=n=>{$.value="attachments",re().then(()=>{j.value?.pickFiles(n)}).catch(u=>{console.error(u)})},ee=n=>{l.attachments[n].orphaned?(Object.assign(a,ce),a.ajaxRunning=!0,ke.document.removeFile(l.attachments[n].id).then(()=>{l.attachments=l.attachments.filter((u,_)=>_!==n)}).catch(u=>{if(a.ajaxErrors=!0,u.isAPIError)switch(a.ajaxAPIErrorDetails=u.customAPIErrorDetails,u.response.status){case 401:a.ajaxErrorMessage="Auth session expired, requesting new...",L.emit("reAuthRequired",{emitter:"DocumentDetailsAttachments.onRemoveAttachmentAtIndex"});break;default:a.ajaxErrorMessage="API Error: fatal error";break}else a.ajaxErrorMessage=`Uncaught exception: ${u}`,console.error(u)}).finally(()=>{a.ajaxRunning=!1})):l.attachments=l.attachments.filter((u,_)=>_!==n)},D=()=>{l.notes.unshift(new La(ue(),"",new ia(o,de()),!1,!0))},ae=n=>{l.notes=l.notes.filter((u,_)=>_!==n)},se=()=>{I.value=!0,L.emit("showUploadingDialog",{transfers:j.value?.files.map(n=>new ye(ue(),n.name,n.size,de(),null,!1,!1,!1,null,null,!1))})},ne=n=>{let u=null;try{n.xhr instanceof XMLHttpRequest?u=JSON.parse(n.xhr.response):n.xhr.data&&(u=n.xhr.data)}catch(_){console.error(_)}u!=null?(l.attachments.unshift(new Ha(u.data.id,n.files[0].name,"",n.files[0].size,new ia(o,de()),!0)),L.emit("refreshUploadingDialog.fileUploaded",{transfers:n.files.map(_=>new ye(ue(),_.name,_.size,0,null,!1,!1,!1,null,null,!1))})):L.emit("refreshUploadingDialog.fileUploadRejected",{transfers:n.files.map(_=>new ye(ue(),_.name,_.size,de(),de(),!1,!1,!0,500,"Transfer rejected",!0))})},Z=n=>{console.log("rejected");const u=n.map(_=>new ye(ue(),_.file.name,_.file.size,0,null,!1,!1,!0,_.failedPropValidation=="max-file-size"?413:500,_.failedPropValidation=="max-file-size"?"Content Too Large":"Internal Server Error",!1));L.emit("refreshUploadingDialog.fileUploadRejected",{transfers:u})},ve=n=>{L.emit("refreshUploadingDialog.fileUploadFailed",{transfers:n.files.map(u=>new ye(ue(),u.name,u.size,de(),de(),!1,!1,!0,n.xhr.status,"Transfer failed",!0))})},Fe=()=>{I.value=!1,j.value?.reset()};return ze(()=>{k.value||p.documentId&&(l.id=p.documentId,R()),L.on("reAuthSucess",n=>{n.to?.includes("DocumentPage.onRefresh")&&R(),n.to?.includes("DocumentPage.onSubmitForm")&&Q()})}),Ce(()=>{L.off("reAuthSucess")}),(n,u)=>(x(),K(Ie,null,[B("div",{onDragover:u[11]||(u[11]=X(()=>{},["prevent"])),onDragenter:u[12]||(u[12]=X(()=>{},["prevent"])),onDrop:C},[r(c(pt),{ref_key:"uploaderRef",ref:j,class:"hidden","hide-upload-btn":"","no-thumbnails":"","auto-upload":"","field-name":"file",method:"POST",url:"api3/attachment","max-file-size":F.value,multiple:"",onUploaded:ne,onRejected:Z,onFailed:ve,onStart:se,onFinish:Fe},null,8,["max-file-size"]),r(Re,{flat:"",class:"bg-transparent"},{default:d(()=>[B("form",{onSubmit:X(Q,["prevent","stop"]),autocorrect:"off",autocapitalize:"off",autocomplete:"off",spellcheck:"false"},[t.value?(x(),E(la,{key:0,class:"q-ma-sm",spread:""},{default:d(()=>[r(W,{type:"submit",icon:"save",size:"md",color:"primary",title:c(o)("Save"),label:c(o)("Save"),"no-caps":"",onClick:Q,disable:a.ajaxRunning||I.value||!l.title,loading:a.ajaxRunning},{loading:d(()=>[r(je,{class:"on-left"}),N(" "+w(c(o)("Saving...")),1)]),_:1},8,["title","label","disable","loading"]),k.value?T("",!0):(x(),E(W,{key:0,type:"button",icon:"autorenew",size:"md",color:"secondary",title:c(o)("Reload"),label:c(o)("Reload"),"no-caps":"",onClick:R,loading:a.ajaxRunning},{loading:d(()=>[r(je,{class:"on-left"}),N(" "+w(c(o)("Loading...")),1)]),_:1},8,["title","label","loading"])),k.value?T("",!0):(x(),E(W,{key:1,type:"button",icon:"delete",size:"md",color:"red",title:c(o)("Delete"),label:c(o)("Delete"),"no-caps":"",onClick:U},null,8,["title","label"]))]),_:1})):T("",!0),r(Me,{class:"lt-lg q-mb-sm",modelValue:A.value,"onUpdate:modelValue":u[0]||(u[0]=_=>A.value=_)},{default:d(()=>[r(ge,{name:"metadata",icon:"description",label:c(o)("Document metadata"),class:"cursor-default full-width"},null,8,["label"]),r(ge,{name:"details",icon:"list_alt",label:c(o)("Document details"),class:"cursor-default full-width"},null,8,["label"])]),_:1},8,["modelValue"]),t.value?(x(),E(be,{key:1,class:"row q-pa-none"},{default:d(()=>[J(B("div",Tt,[r(Re,{class:"q-ma-xs q-mt-sm full-width"},{default:d(()=>[r(be,{class:"q-pa-none q-mb-sm gt-md"},{default:d(()=>[r(Me,{modelValue:O.value,"onUpdate:modelValue":u[1]||(u[1]=_=>O.value=_)},{default:d(()=>[r(ge,{name:"metadata",icon:"description",label:c(o)("Document metadata"),class:"cursor-default full-width"},null,8,["label"])]),_:1},8,["modelValue"])]),_:1}),r(be,{class:"q-pa-md"},{default:d(()=>[k.value?T("",!0):(x(),E(_t,{key:0,"created-at":l.createdAt,"updated-at":l.updatedAt},null,8,["created-at","updated-at"])),r(Qe,{ref_key:"documentTitleFieldRef",ref:h,dense:"",class:"q-mb-md",maxlength:"128",outlined:"",modelValue:l.title,"onUpdate:modelValue":u[2]||(u[2]=_=>l.title=_),modelModifiers:{trim:!0},type:"textarea",autogrow:"",name:"title",label:c(o)("Document title"),disable:a.ajaxRunning,autofocus:!0,clearable:"","start-mode-editable":k.value,rules:[c(b)],error:!l.title,"error-message":c(y),"max-lines":1},null,8,["modelValue","label","disable","start-mode-editable","rules","error","error-message"]),r(Qe,{dense:"",class:"q-mb-md",outlined:"",modelValue:l.description,"onUpdate:modelValue":u[3]||(u[3]=_=>l.description=_),modelModifiers:{trim:!0},type:"textarea",maxlength:"4096",autogrow:"",name:"description",label:c(o)("Document description"),disable:a.ajaxRunning,clearable:"","start-mode-editable":k.value,"max-lines":6},null,8,["modelValue","label","disable","start-mode-editable"]),r(Wa,{dense:"",modelValue:l.tags,"onUpdate:modelValue":u[4]||(u[4]=_=>l.tags=_),disabled:a.ajaxRunning,"start-mode-editable":k.value,"deny-change-editable-mode":k.value,clearable:""},null,8,["modelValue","disabled","start-mode-editable","deny-change-editable-mode"])]),_:1})]),_:1})],512),[[Y,S.value||A.value=="metadata"]]),J(B("div",Vt,[r(Re,{class:"q-ma-xs q-mt-sm full-width"},{default:d(()=>[r(be,{class:"q-pa-none q-mb-sm",style:{"border-bottom":"2px solid rgba(0, 0, 0, 0.12)"}},{default:d(()=>[r(Me,{modelValue:$.value,"onUpdate:modelValue":u[5]||(u[5]=_=>$.value=_),align:"left"},{default:d(()=>[r(ge,{name:"attachments",icon:"attach_file",disable:a.ajaxRunning,label:c(o)("Attachments")},{default:d(()=>[J(r(Be,{floating:""},{default:d(()=>[N(w(l.attachments.length),1)]),_:1},512),[[Y,l.hasAttachments]])]),_:1},8,["disable","label"]),r(ge,{name:"notes",icon:"forum",disable:a.ajaxRunning,label:c(o)("Notes")},{default:d(()=>[J(r(Be,{floating:""},{default:d(()=>[N(w(l.notes.length),1)]),_:1},512),[[Y,l.hasNotes]])]),_:1},8,["disable","label"]),l.id?(x(),E(ge,{key:0,name:"history",icon:"view_timeline",disable:a.ajaxRunning,label:c(o)("History")},{default:d(()=>[J(r(Be,{floating:""},{default:d(()=>[N(w(l.historyOperations.length),1)]),_:1},512),[[Y,l.hasHistoryOperations]])]),_:1},8,["disable","label"])):T("",!0)]),_:1},8,["modelValue"])]),_:1}),r(be,{class:"q-pa-none"},{default:d(()=>[r(Ia,{modelValue:$.value,"onUpdate:modelValue":u[10]||(u[10]=_=>$.value=_),animated:"",class:"bg-transparent"},{default:d(()=>[r(Te,{name:"attachments",class:"q-pa-none"},{default:d(()=>[r(qt,{attachments:l.attachments,disable:a.ajaxRunning,onAddAttachment:V,onPreviewAttachmentAtIndex:u[6]||(u[6]=_=>l.previewAttachment(_)),onRemoveAttachmentAtIndex:u[7]||(u[7]=_=>ee(_))},null,8,["attachments","disable"])]),_:1}),r(Te,{name:"notes",class:"q-pa-none"},{default:d(()=>[r(Ct,{notes:l.notes,disable:a.ajaxRunning,onAddNote:D,onRemoveNoteAtIndex:u[8]||(u[8]=_=>ae(_))},null,8,["notes","disable"])]),_:1}),l.id?(x(),E(Te,{key:0,name:"history",class:"q-pa-none"},{default:d(()=>[r(Pt,{modelValue:l.historyOperations,"onUpdate:modelValue":u[9]||(u[9]=_=>l.historyOperations=_),disable:a.ajaxRunning},null,8,["modelValue","disable"])]),_:1})):T("",!0)]),_:1},8,["modelValue"])]),_:1})]),_:1})],512),[[Y,S.value||A.value=="details"]])]),_:1})):T("",!0),r(be,{class:"q-ma-xs q-mt-sm q-px-xs"},{default:d(()=>[g.value?(x(),E(we,{key:0,class:"q-mt-md",text:"Document saved",success:""})):a.ajaxErrors&&a.ajaxErrorMessage?(x(),E(We,{key:1,class:"q-mt-md","api-error":a.ajaxAPIErrorDetails,text:a.ajaxErrorMessage},null,8,["api-error","text"])):T("",!0)]),_:1}),t.value?(x(),E(la,{key:2,class:"q-ma-sm",spread:""},{default:d(()=>[r(W,{type:"submit",icon:"save",size:"md",color:"primary",title:c(o)("Save"),label:c(o)("Save"),"no-caps":"",onClick:Q,disable:a.ajaxRunning||I.value||!l.title,loading:a.ajaxRunning},{loading:d(()=>[r(je,{class:"on-left"}),N(" "+w(c(o)("Saving...")),1)]),_:1},8,["title","label","disable","loading"]),k.value?T("",!0):(x(),E(W,{key:0,type:"button",icon:"autorenew",size:"md",color:"secondary",title:c(o)("Reload"),label:c(o)("Reload"),"no-caps":"",onClick:R,loading:a.ajaxRunning},{loading:d(()=>[r(je,{class:"on-left"}),N(" "+w(c(o)("Loading...")),1)]),_:1},8,["title","label","loading"])),k.value?T("",!0):(x(),E(W,{key:1,type:"button",icon:"delete",size:"md",color:"red",title:c(o)("Delete"),label:c(o)("Delete"),"no-caps":"",onClick:U},null,8,["title","label"]))]),_:1})):T("",!0)],32)]),_:1})],32),f.value&&l.id?(x(),E(Mt,{key:0,"document-id":l.id,onClose:u[13]||(u[13]=_=>f.value=!1)},null,8,["document-id"])):T("",!0)],64))}}),il=ie({__name:"DocumentPage",setup(e){const o=Ge(),i=za(),s=z(i.name=="document"&&String(i.params?.id)||null);return o.beforeEach(v=>{v.name=="newDocument"?s.value=null:v.name=="document"&&v.params.id&&(s.value=String(v.params.id))}),(v,b)=>(x(),E(ya,null,{default:d(()=>[r($t,{"document-id":s.value},null,8,["document-id"])]),_:1}))}});export{il as default};
