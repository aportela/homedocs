import{d as Q,a as $,b as c,_ as S,c as U,u as z,Q as B}from"./CustomErrorBanner.vue_vue_type_script_setup_true_lang-BwzH5vCg.js";import{Q as D}from"./QPage-BLWONRqG.js";import{Q as F,a as N}from"./QItem-D3SSeFk8.js";import{Q as T,a as O}from"./QInput-DCOUNvfM.js";import{Q as V}from"./QBtn-DctWh9_T.js";import{Q as G}from"./ClosePopup-CNyqlWth.js";import{a as q,b as H,j as J,k as w,l as E,r as L,n as Y,o as f,h as e,w as l,f as g,t as d,g as r,e as v,p as K,q as b,G as W,s as X,v as _}from"./index-Ct92d8Em.js";import{a as Z}from"./api-ByO76S85.js";import{u as ee}from"./useFormUtils-B_DmTkpa.js";import{u as ae}from"./serverEnvironment-T24gP8gM.js";import{d as se,_ as re}from"./PasswordFieldCustomInput.vue_vue_type_script_setup_true_lang-CgCAhJU6.js";import{_ as oe,a as le,b as te}from"./GitHubButton.vue_vue_type_script_setup_true_lang-D7axCefZ.js";import"./_plugin-vue_export-helper-oRIn74M6.js";import"./session-XhBIPT0q.js";import"./index-CG2WSiiR.js";import"./darkMode-DTGZ6KEA.js";const ne={class:"q-mt-sm q-mb-md text-h4 text-weight-bolder"},ie={class:"text-color-secondary"},ue=q({__name:"RegisterForm",emits:["success"],setup(P,{emit:y}){const j=y,{t:n}=H(),{requiredFieldRule:k}=ee(),A=ae(),p=J(()=>A.isSignUpAllowed===!1),a=w({...Q}),t=w({...se}),i=w({email:"",password:""}),u=E(null),m=E(null),h=E(!1),I=()=>{t.email.hasErrors=!1,t.email.message=null,t.password.hasErrors=!1,t.password.message=null,u.value?.resetValidation(),m.value?.resetValidation()},M=async()=>{I();try{await u.value?.validate(),await m.value?.validate(),u.value?.hasError?u.value?.focus():m.value?.hasError?m.value?.focus():R()}catch(o){console.error("Validation error",o)}},R=()=>{i.email&&i.password?(h.value=!1,Object.assign(a,Q),a.ajaxRunning=!0,Z.auth.register(z(),i.email,i.password).then(o=>{h.value=!0,j("success",o.data)}).catch(o=>{if(a.ajaxErrors=!0,o.isAPIError)switch(a.ajaxAPIErrorDetails=o.customAPIErrorDetails,o.response.status){case 400:o.response.data.invalidOrMissingParams.find(function(s){return s==="email"})?(a.ajaxErrorMessage="API Error: missing email param",_().then(()=>{u.value?.focus()}).catch(s=>{console.error(s)})):o.response.data.invalidOrMissingParams.find(function(s){return s==="password"})?(a.ajaxErrorMessage="API Error: missing password param",_().then(()=>{m.value?.focus()}).catch(s=>{console.error(s)})):(a.ajaxErrorMessage="API Error: invalid/missing param",_().then(()=>{u.value?.focus()}).catch(s=>{console.error(s)}));break;case 409:t.email.hasErrors=!0,t.email.message="Email already used",_().then(()=>{u.value?.focus()}).catch(s=>{console.error(s)});break;default:a.ajaxErrorMessage="API Error: fatal error";break}else a.ajaxErrorMessage=`Uncaught exception: ${o}`,console.error(o)}).finally(()=>{a.ajaxRunning=!1})):console.error("Missing email|password values")};return(o,s)=>{const C=L("router-link");return f(),Y("form",{onSubmit:X(M,["prevent","stop"]),autocorrect:"off",autocapitalize:"off",autocomplete:"off",spellcheck:"false"},[e(c,{class:"text-center"},{default:l(()=>[e($,{square:"",size:"128px"},{default:l(()=>[...s[2]||(s[2]=[g("img",{src:"icons/favicon-128x128.png"},null,-1)])]),_:1}),g("h4",ne,d(r(n)("Sign up now and take control.")),1),g("div",ie,d(r(n)("The first step to a more organized you starts here!")),1)]),_:1}),e(c,null,{default:l(()=>[e(r(T),{autofocus:"",dense:"",outlined:"",ref_key:"emailRef",ref:u,modelValue:i.email,"onUpdate:modelValue":s[0]||(s[0]=x=>i.email=x),type:"email",name:"email",label:r(n)("Email"),disable:a.ajaxRunning||p.value,rules:[r(k)],"lazy-rules":"",error:t.email.hasErrors,"error-message":t.email.message?r(n)(t.email.message):""},{prepend:l(()=>[e(F,{name:"alternate_email"})]),_:1},8,["modelValue","label","disable","rules","error","error-message"]),e(re,{dense:"",outlined:"",ref_key:"passwordRef",ref:m,class:"q-mt-md",modelValue:i.password,"onUpdate:modelValue":s[1]||(s[1]=x=>i.password=x),name:"password",label:r(n)("Password"),disable:a.ajaxRunning||p.value,rules:[r(k)],"lazy-rules":"",error:t.password.hasErrors,"error-message":t.password.message?r(n)(t.password.message):""},null,8,["modelValue","label","disable","rules","error","error-message"])]),_:1}),e(c,null,{default:l(()=>[e(V,{color:"primary",size:"md",label:o.$t("Sign up"),"no-caps":"",class:"full-width",icon:"account_circle",disable:a.ajaxRunning||!(i.email&&i.password)||p.value,loading:a.ajaxRunning,type:"submit"},{loading:l(()=>[e(O,{class:"on-left"}),b(" "+d(r(n)("Sign up")),1)]),_:1},8,["label","disable","loading"]),p.value?(f(),v(S,{key:0,text:"New sign ups are not allowed on this system",error:"",class:"q-mt-lg"})):h.value?(f(),v(S,{key:1,text:"Your account has been created",success:"",class:"q-mt-lg"},{details:l(()=>[e(V,{size:"sm",color:"primary",class:"float-right",label:r(n)("Sign in"),to:"{ name: 'login'}"},null,8,["label"])]),_:1})):a.ajaxErrors&&a.ajaxErrorMessage?(f(),v(U,{key:2,text:a.ajaxErrorMessage,"api-error":a.ajaxAPIErrorDetails,class:"q-mt-lg"},null,8,["text","api-error"])):K("",!0)]),_:1}),e(c,{class:"text-center q-pt-none"},{default:l(()=>[g("div",null,[b(d(r(n)("Already have an account ?"))+" ",1),e(C,{to:{name:"login"},class:"main-app-text-link-hover"},{default:l(()=>[b(d(r(n)("Click here to sign in")),1)]),_:1})])]),_:1}),e(N,{class:"q-mb-sm"}),e(c,{class:"text-center q-py-none"},{default:l(()=>[e(G,{flat:"",square:""},{default:l(()=>[e(oe),e(le),e(te,{label:"@2025 HomeDocs",href:r(W)},null,8,["href"])]),_:1})]),_:1})],32)}}}),Qe=q({__name:"RegisterPage",setup(P){return(y,j)=>(f(),v(D,null,{default:l(()=>[e(B,{class:"q-pa-xl",flat:""},{default:l(()=>[e(ue)]),_:1})]),_:1}))}});export{Qe as default};
