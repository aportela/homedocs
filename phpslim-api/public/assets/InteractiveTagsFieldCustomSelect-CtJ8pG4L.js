import{Q as y}from"./use-timeout-DkasoO3K.js";import{a as z}from"./dateTime-DKBR-zRU.js";import{a as _,b as H,l as g,j as B,k,R as G,D as J,n as C,e as v,f as K,S as W,p as X,t as E,g as i,w as l,h as p,q as V,a3 as Y,U as F,T as R,a1 as Z,ac as ee,v as ae,o as n}from"./index-DMsogX6U.js";import{Q as te}from"./QSelect-B_fMtB_N.js";import{a as w}from"./bus-DAajsxXE.js";import{a as oe}from"./api-qyRpSTvW.js";import{d as $}from"./CustomErrorBanner.vue_vue_type_script_setup_true_lang-Djury_rv.js";import{_ as q}from"./QItem-DTkRWWSA.js";import{_ as se}from"./BrowseByTagButton.vue_vue_type_script_setup_true_lang-epdxlY6o.js";import{_ as le}from"./_plugin-vue_export-helper-Kd_RiLXS.js";const ne={class:"readonly-label"},re=_({__name:"InteractiveTagsFieldCustomSelect",props:{startModeEditable:{type:Boolean,default:!1},denyChangeEditableMode:{type:Boolean,default:!1},modelValue:{},disabled:{type:Boolean,default:!1},dense:{type:Boolean},label:{default:"Document tags"}},emits:["update:modelValue","error"],setup(s,{expose:D,emit:N}){const{t:d}=H(),j=s,I=N,b=g(!1),u=g(!j.startModeEditable),c=g(null),r=B({get(){return j.modelValue||[]},set(e){I("update:modelValue",e||[])}}),a=k({...$}),f=k([]),h=k([]),m=g(!1),P=B(()=>m.value?"Only lowercase letters, numbers and hyphens are allowed in tags":"Error loading available tags"),Q=(e,t)=>{const o=/^[0-9a-z-]*$/;m.value=e.length>0&&!o.test(e);const x=e===""?f:f.filter(M=>M.toLowerCase().includes(e.toLowerCase()));t(()=>{h.length=0,e.length>0&&!m.value&&h.push(...x)})},U=(e,t)=>{m.value||t(e)},T=()=>{a.ajaxRunning||(Object.assign(a,$),a.ajaxRunning=!0,oe.tag.search().then(e=>{f.length=0,f.push(...e.data.tags)}).catch(e=>{if(a.ajaxErrors=!0,e.isAPIError)switch(a.ajaxAPIErrorDetails=e.customAPIErrorDetails,e.response.status){case 401:a.ajaxErrors=!1,w.emit("reAuthRequired",{emitter:"InteractiveTagsFieldCustomSelect"});break;default:a.ajaxErrorMessage="API Error: fatal error";break}else a.ajaxErrorMessage=`Uncaught exception: ${e}`,console.error(e);I("error",e.response)}).finally(()=>{a.ajaxRunning=!1}))},O=()=>{c.value?.hidePopup(),c.value?.reset(),c.value?.updateInputValue("")},L=e=>{const t=[...r.value];t.splice(e,1),r.value=t},S=()=>{ae().then(()=>{c.value?.focus()}).catch(e=>{console.error(e)})};D({focus:S});const A=()=>{u.value=!u.value,u.value||S()};return G(()=>{T(),w.on("reAuthSucess",e=>{e.to?.includes("InteractiveTagsFieldCustomSelect")&&T()})}),J(()=>{w.off("reAuthSucess")}),(e,t)=>u.value?(n(),C("div",{key:0,class:"cursor-pointer q-pa-sm relative-position white-space-pre-line read-only-input-container",onMouseenter:t[0]||(t[0]=o=>b.value=!0),onMouseleave:t[1]||(t[1]=o=>b.value=!1),onClick:A},[K("div",ne,E(i(d)(s.label)),1),s.denyChangeEditableMode?X("",!0):W((n(),v(y,{key:0,name:"edit",size:"sm",class:"absolute-top-right text-grey cursor-pointer q-mr-sm q-mt-sm"},{default:l(()=>[p(q,null,{default:l(()=>[V(E(i(d)("Click to toggle edit mode")),1)]),_:1})]),_:1},512)),[[Y,b.value]]),(n(!0),C(F,null,R(r.value,o=>(n(),v(se,{key:o,tag:o,icon:"tag"},null,8,["tag"]))),128))],32)):(n(),v(i(te),{key:1,ref_key:"selectRef",ref:c,label:i(d)(s.label),modelValue:r.value,"onUpdate:modelValue":t[2]||(t[2]=o=>r.value=o),dense:s.dense,"options-dense":s.dense,outlined:"","use-input":"","use-chips":"",multiple:"","hide-dropdown-icon":"",options:h,"input-debounce":"0","new-value-mode":"add-unique",disable:s.disabled||a.ajaxRunning||a.ajaxErrors,loading:a.ajaxRunning,error:a.ajaxErrors||m.value,"error-message":i(d)(P.value),onFilter:Q,onAdd:O,onNewValue:U},Z({prepend:l(()=>[ee(e.$slots,"prepend",{},()=>[p(y,{name:"tag"})],!0)]),selected:l(()=>[(n(!0),C(F,null,R(r.value,(o,x)=>(n(),v(z,{square:"",removable:!u.value,dense:s.dense,key:o,onRemove:M=>L(x),color:"primary","text-color":"white",icon:"tag",label:o},null,8,["removable","dense","onRemove","label"]))),128))]),_:2},[s.denyChangeEditableMode?void 0:{name:"append",fn:l(()=>[p(y,{name:"done",class:"cursor-pointer",onClick:A},{default:l(()=>[p(q,null,{default:l(()=>[V(E(i(d)("Click to toggle edit mode")),1)]),_:1})]),_:1})]),key:"0"}]),1032,["label","modelValue","dense","options-dense","options","disable","loading","error","error-message"]))}}),he=le(re,[["__scopeId","data-v-221b3f58"]]);export{he as I};
