import{Q as v}from"./QPagination-DwiqSCFo.js";import{Q as x}from"./use-timeout-f6zK2_pC.js";import{Q as N}from"./QMarkupTable-qO_HfeaX.js";import{Q as $}from"./QPage-DEClcuiE.js";import{a as d,f as L}from"./bus-7f8GRI0F.js";import{d as q,a as S,_ as F}from"./CustomErrorBanner.vue_vue_type_script_setup_true_lang-Cj3i-oR3.js";import{f as y,t as h,c as O,a as E}from"./dateUtils-BWiXzgsP.js";import{a as H}from"./api-CM3iwbFc.js";import{S as Y,P as G}from"./pager-B5QX6AQA.js";import{a as J,b as K,k as b,j as k,_ as W,l as X,R as Z,D as ee,e as P,w,n as i,p as g,h as c,f as s,U as I,T as D,o as r,a2 as te,q as A,t as n,g as o}from"./index-B-UYWWpq.js";import"./QBtn-DS5wVTGT.js";import"./_plugin-vue_export-helper-B9cH7pQ5.js";import"./QInput-pN4J6sFa.js";import"./serverEnvironment-DKulyRMn.js";import"./index-CG2WSiiR.js";const ae={key:2},se={key:0,class:"q-ma-md flex flex-center"},oe=["onClick"],le=["onClick"],re={class:"text-left"},ne={class:"q-my-sm"},ie={class:"q-my-sm"},de={class:"text-left"},me={class:"text-left"},ce={class:"q-my-sm"},ue={class:"q-my-sm"},fe={class:"text-left"},pe={key:0},ge={class:"q-my-sm"},_e={key:0,class:"q-my-sm"},xe={key:1,class:"q-my-sm"},he={class:"text-right"},ke={key:0},Ae={class:"text-left"},ye={key:0},be={class:"q-my-sm"},Pe={class:"q-my-sm"},Ce={key:1,class:"q-ma-md flex flex-center"},Le=J({__name:"AttachmentsSharesPage",setup(Te){const{t:f}=K(),V=[{field:"createdAtTimestamp",title:"Created on",defaultClass:""},{field:"enabled",title:"Enabled",defaultClass:""},{field:"documentTitle",title:"Shared element",defaultClass:""},{field:"expiresAtTimestamp",title:"Expires on",defaultClass:""},{field:"accessCount",title:"Access count",defaultClass:"text-right"},{field:"lastAccessTimestamp",title:"Most recent access",defaultClass:""}],p=b(new Y("createdAtTimestamp","createdAtTimestamp","DESC")),Q=k(()=>p.order==="ASC"?"keyboard_double_arrow_up":"keyboard_double_arrow_down"),t=b({...q}),_=W([]),C=X(!1),B=k(()=>_.value.length>0),M=k(()=>!t.ajaxRunning&&t.ajaxErrors),R=k(()=>!t.ajaxRunning&&C.value&&!B.value),l=b(new G(1,16,0,0)),T=m=>{l.currentPageIndex=m,u(!1)},U=(m,a)=>{t.ajaxRunning||(p.toggle(m,a),u(!1))},u=m=>{m&&(l.currentPageIndex=1),Object.assign(t,q),t.ajaxRunning=!0,H.attachmentShare.search(l,p).then(a=>{a.data.results&&(_.value=[],_.value=a.data.results.sharedAttachments.map(e=>e),l.currentPageIndex=a.data.results.pagination.currentPage,l.resultsPage=a.data.results.pagination.resultsPage,l.totalResults=a.data.results.pagination.totalResults,l.totalPages=a.data.results.pagination.totalPages,C.value=!0)}).catch(a=>{if(t.ajaxErrors=!0,a.isAPIError)switch(t.ajaxAPIErrorDetails=a.customAPIErrorDetails,a.response.status){case 400:t.ajaxErrorMessage="API Error: invalid/missing param";break;case 401:t.ajaxErrors=!1,d.emit("reAuthRequired",{emitter:"AdvancedSearchPage.onSubmitForm"});break;default:t.ajaxErrorMessage="API Error: fatal error";break}else t.ajaxErrorMessage=`Uncaught exception: ${a}`,console.error(a)}).finally(()=>{t.ajaxRunning=!1})},z=m=>{d.emit("showAttachmentShareDialog",{attachmentId:m,create:!1})};return Z(()=>{d.on("attachmentShareAdded",()=>{u(!0)}),d.on("attachmentShareChanged",()=>{u(!1)}),d.on("attachmentShareDeleted",()=>{u(!1)}),u(!0)}),ee(()=>{d.off("reAuthSucess"),d.off("attachmentShareAdded"),d.off("attachmentShareChanged"),d.off("attachmentShareDeleted")}),(m,a)=>(r(),P($,null,{default:w(()=>[M.value?(r(),P(S,{key:0,text:t.ajaxErrorMessage||"Error loading data","api-error":t.ajaxAPIErrorDetails,class:"q-ma-md"},null,8,["text","api-error"])):R.value?(r(),P(F,{key:1,warning:"",text:"You haven't created any share yet",class:"q-ma-md"})):(r(),i("div",ae,[l.totalPages>1?(r(),i("div",se,[c(v,{modelValue:l.currentPageIndex,"onUpdate:modelValue":[a[0]||(a[0]=e=>l.currentPageIndex=e),T],color:"dark",max:l.totalPages,"max-pages":5,"boundary-numbers":"","direction-links":"","boundary-links":"",disable:t.ajaxRunning,class:"theme-default-q-pagination"},null,8,["modelValue","max","disable"])])):g("",!0),c(N,null,{default:w(()=>[s("thead",null,[s("tr",null,[(r(),i(I,null,D(V,(e,j)=>s("th",{key:j,class:te(["text-left",e.defaultClass,{"cursor-not-allowed":t.ajaxRunning,"cursor-pointer":!t.ajaxRunning,"action-primary":p.field===e.field}]),onClick:je=>U(e.field)},[c(x,{name:p.field===e.field?Q.value:"sort",size:"sm"},null,8,["name"]),A(" "+n(o(f)(e.title)),1)],10,oe)),64))])]),s("tbody",null,[(r(!0),i(I,null,D(_.value,e=>(r(),i("tr",{key:e.id,class:"cursor-pointer",onClick:j=>z(e.attachment.id)},[s("td",re,[s("p",ne,n(o(y)(e.createdAtTimestamp)),1),s("p",ie,"("+n(o(f)(o(h)(e.createdAtTimestamp).label,{count:o(h)(e.createdAtTimestamp).count}))+") ",1)]),s("td",de,[c(x,{class:"text-weight-bold",size:"sm",name:e.enabled?"done":"block"},null,8,["name"])]),s("td",me,[s("p",ce,[c(x,{name:"file_download",class:"q-mr-sm"}),A(n(e.attachment.name)+" ("+n(o(L).humanStorageSize(e.attachment.size))+")",1)]),s("p",ue,[c(x,{name:"work",class:"q-mr-sm"}),A(n(e.document.title),1)])]),s("td",fe,[e.expiresAtTimestamp?(r(),i("div",pe,[s("p",ge,n(o(y)(e.expiresAtTimestamp)),1),e.expiresAtTimestamp>o(O)()?(r(),i("p",_e,"("+n(o(f)(o(E)(e.expiresAtTimestamp).label,{count:o(E)(e.expiresAtTimestamp).count}))+") ",1)):(r(),i("p",xe,n(o(f)("(expired)")),1))])):g("",!0)]),s("td",he,[A(n(e.accessCount||0),1),e.accessLimit?(r(),i("span",ke,"/"+n(e.accessLimit),1)):g("",!0)]),s("td",Ae,[e.lastAccessTimestamp?(r(),i("div",ye,[s("p",be,n(o(y)(e.lastAccessTimestamp)),1),s("p",Pe,"("+n(o(f)(o(h)(e.lastAccessTimestamp).label,{count:o(h)(e.lastAccessTimestamp).count}))+")",1)])):g("",!0)])],8,le))),128))])]),_:1}),l.totalPages>1?(r(),i("div",Ce,[c(v,{modelValue:l.currentPageIndex,"onUpdate:modelValue":[a[1]||(a[1]=e=>l.currentPageIndex=e),T],color:"dark",max:l.totalPages,"max-pages":5,"boundary-numbers":"","direction-links":"","boundary-links":"",disable:t.ajaxRunning,class:"theme-default-q-pagination"},null,8,["modelValue","max","disable"])])):g("",!0)]))]),_:1}))}});export{Le as default};
