import{Q as v}from"./QPagination-Blwttbop.js";import{Q as x}from"./use-timeout-Dk6CO65c.js";import{Q as N}from"./QMarkupTable-DelunEBn.js";import{Q as $}from"./QPage-DqAH0F3p.js";import{a as m,f as L}from"./bus-CVwhliaE.js";import{d as q,a as F,_ as O}from"./CustomErrorBanner.vue_vue_type_script_setup_true_lang-DBTLD8xq.js";import{f as b,t as k,c as S,a as E}from"./dateUtils-tkffsgZl.js";import{a as H}from"./api-CoAF7EnE.js";import{S as Y,P as G}from"./pager-B5QX6AQA.js";import{a as J,b as K,k as h,j as y,_ as W,l as X,R as Z,D as ee,e as P,w,n as i,p as g,h as c,f as s,U as I,T as D,o as r,a2 as te,q as A,t as n,g as o}from"./index-B4QQtCX7.js";import"./QBtn-C-aNyInZ.js";import"./_plugin-vue_export-helper-BlOQ7VLK.js";import"./QInput-CjvEs_If.js";import"./serverEnvironment-AswETgyQ.js";import"./index-CG2WSiiR.js";import"./session-BvJG7K2f.js";const ae={key:2},se={key:0,class:"q-ma-md flex flex-center"},oe=["onClick"],le=["onClick"],re={class:"text-left"},ne={class:"q-my-sm"},ie={class:"q-my-sm"},de={class:"text-left"},me={class:"text-left"},ce={class:"q-my-sm"},ue={class:"q-my-sm"},fe={class:"text-left"},pe={key:0},ge={class:"q-my-sm"},_e={key:0,class:"q-my-sm"},xe={key:1,class:"q-my-sm"},ke={class:"text-right"},ye={key:0},Ae={class:"text-left"},be={key:0},he={class:"q-my-sm"},Pe={class:"q-my-sm"},Ce={key:1,class:"q-ma-md flex flex-center"},Fe=J({__name:"AttachmentsSharesPage",setup(Te){const{t:u}=K(),V=[{field:"createdAtTimestamp",title:"Created on",defaultClass:""},{field:"enabled",title:"Enabled",defaultClass:""},{field:"documentTitle",title:"Shared element",defaultClass:""},{field:"expiresAtTimestamp",title:"Expires on",defaultClass:""},{field:"accessCount",title:"Access count",defaultClass:"text-right"},{field:"lastAccessTimestamp",title:"Most recent access",defaultClass:""}],f=h(new Y("createdAtTimestamp","createdAtTimestamp","DESC")),Q=y(()=>f.order==="ASC"?"keyboard_double_arrow_up":"keyboard_double_arrow_down"),t=h({...q}),_=W([]),C=X(!1),B=y(()=>_.value.length>0),M=y(()=>!t.ajaxRunning&&t.ajaxErrors),R=y(()=>!t.ajaxRunning&&C.value&&!B.value),l=h(new G(1,16,0,0)),T=d=>{l.currentPageIndex=d,p(!1)},U=(d,a)=>{t.ajaxRunning||(f.toggle(d,a),p(!1))},p=d=>{d&&(l.currentPageIndex=1),Object.assign(t,q),t.ajaxRunning=!0,H.attachmentShare.search(l,f).then(a=>{a.data.results&&(_.value=[],_.value=a.data.results.sharedAttachments.map(e=>e),l.currentPageIndex=a.data.results.pagination.currentPage,l.resultsPage=a.data.results.pagination.resultsPage,l.totalResults=a.data.results.pagination.totalResults,l.totalPages=a.data.results.pagination.totalPages,C.value=!0)}).catch(a=>{if(t.ajaxErrors=!0,a.isAPIError)switch(t.ajaxAPIErrorDetails=a.customAPIErrorDetails,a.response.status){case 400:t.ajaxErrorMessage="API Error: invalid/missing param";break;case 401:t.ajaxErrors=!1,m.emit("reAuthRequired",{emitter:"AdvancedSearchPage.onSubmitForm"});break;default:t.ajaxErrorMessage="API Error: fatal error";break}else t.ajaxErrorMessage=`Uncaught exception: ${a}`,console.error(a)}).finally(()=>{t.ajaxRunning=!1})},z=d=>{m.emit("showAttachmentShareDialog",{attachmentId:d,create:!1})};return Z(()=>{m.on("attachmentShareChanged",()=>{p(!1)}),m.on("attachmentShareDeleted",()=>{p(!1)}),p(!0)}),ee(()=>{m.off("reAuthSucess"),m.off("attachmentShareChanged"),m.off("attachmentShareDeleted")}),(d,a)=>(r(),P($,null,{default:w(()=>[M.value?(r(),P(F,{key:0,text:t.ajaxErrorMessage||"Error loading data","api-error":t.ajaxAPIErrorDetails,class:"q-ma-md"},null,8,["text","api-error"])):R.value?(r(),P(O,{key:1,warning:"",text:"You haven't created any share yet",class:"q-ma-md"})):(r(),i("div",ae,[l.totalPages>1?(r(),i("div",se,[c(v,{modelValue:l.currentPageIndex,"onUpdate:modelValue":[a[0]||(a[0]=e=>l.currentPageIndex=e),T],color:"dark",max:l.totalPages,"max-pages":5,"boundary-numbers":"","direction-links":"","boundary-links":"",disable:t.ajaxRunning,class:"theme-default-q-pagination"},null,8,["modelValue","max","disable"])])):g("",!0),c(N,null,{default:w(()=>[s("thead",null,[s("tr",null,[(r(),i(I,null,D(V,(e,j)=>s("th",{key:j,class:te(["text-left",e.defaultClass,{"cursor-not-allowed":t.ajaxRunning,"cursor-pointer":!t.ajaxRunning,"action-primary":f.field===e.field}]),onClick:je=>U(e.field)},[c(x,{name:f.field===e.field?Q.value:"sort",size:"sm"},null,8,["name"]),A(" "+n(o(u)(e.title)),1)],10,oe)),64))])]),s("tbody",null,[(r(!0),i(I,null,D(_.value,e=>(r(),i("tr",{key:e.id,class:"cursor-pointer",onClick:j=>z(e.attachment.id)},[s("td",re,[s("p",ne,n(o(b)(e.createdAtTimestamp)),1),s("p",ie,"("+n(o(u)(o(k)(e.createdAtTimestamp).label,{count:o(k)(e.createdAtTimestamp).count}))+") ",1)]),s("td",de,[c(x,{class:"text-weight-bold",size:"sm",name:e.enabled?"done":"block"},null,8,["name"])]),s("td",me,[s("p",ce,[c(x,{name:"file_download",class:"q-mr-sm"}),A(n(e.attachment.name)+" ("+n(o(L).humanStorageSize(e.attachment.size))+")",1)]),s("p",ue,[c(x,{name:"work",class:"q-mr-sm"}),A(n(e.document.title),1)])]),s("td",fe,[e.expiresAtTimestamp?(r(),i("div",pe,[s("p",ge,n(o(b)(e.expiresAtTimestamp)),1),e.expiresAtTimestamp>o(S)()?(r(),i("p",_e,"("+n(o(u)(o(E)(e.expiresAtTimestamp).label,{count:o(E)(e.expiresAtTimestamp).count}))+") ",1)):(r(),i("p",xe,n(o(u)("(expired)")),1))])):g("",!0)]),s("td",ke,[A(n(e.accessCount||0),1),e.accessLimit?(r(),i("span",ye,"/"+n(e.accessLimit),1)):g("",!0)]),s("td",Ae,[e.lastAccessTimestamp?(r(),i("div",be,[s("p",he,n(o(b)(e.lastAccessTimestamp)),1),s("p",Pe,"("+n(o(u)(o(k)(e.lastAccessTimestamp).label,{count:o(k)(e.lastAccessTimestamp).count}))+")",1)])):g("",!0)])],8,le))),128))])]),_:1}),l.totalPages>1?(r(),i("div",Ce,[c(v,{modelValue:l.currentPageIndex,"onUpdate:modelValue":[a[1]||(a[1]=e=>l.currentPageIndex=e),T],color:"dark",max:l.totalPages,"max-pages":5,"boundary-numbers":"","direction-links":"","boundary-links":"",disable:t.ajaxRunning,class:"theme-default-q-pagination"},null,8,["modelValue","max","disable"])])):g("",!0)]))]),_:1}))}});export{Fe as default};
