import{d as Q,a as $,b as c,_ as S,c as U,u as z,Q as B}from"./CustomErrorBanner.vue_vue_type_script_setup_true_lang-DAGmktG4.js";import{Q as D}from"./QPage-BfXacF6V.js";import{Q as F,a as N}from"./QItem-COEiYpOr.js";import{Q as T,a as O}from"./QInput-DfsDjK3U.js";import{Q as V}from"./QBtn-DYGdk6J_.js";import{Q as G}from"./ClosePopup-IZA4X7XD.js";import{a as P,g as H,h as w,i as E,r as J,j as L,o as f,e,w as t,b as g,t as d,u as r,c as v,k as Y,l as b,m as K,n as _}from"./index-DWyQQ7Hn.js";import{a as W}from"./api-BbjIOG7d.js";import{u as X}from"./useFormUtils-CW5fdy9P.js";import{u as Z}from"./serverEnvironment-D3pJtLW6.js";import{d as ee,_ as ae}from"./PasswordFieldCustomInput.vue_vue_type_script_setup_true_lang-OMNcIr_y.js";import{_ as se,a as re,b as oe}from"./GitHubButton.vue_vue_type_script_setup_true_lang-sr7gsxAi.js";import{G as te}from"./localStorage-BRK9taKx.js";import{u as le}from"./vue-i18n.runtime-CD4rYiPD.js";import"./_plugin-vue_export-helper-CbIelGhP.js";import"./session-DarTIjXU.js";import"./index-B9ygI19o.js";import"./darkMode-rqx3H0rA.js";import"./i18n-BUGIyG54.js";import"./i18n-EdFKgzfA.js";const ie={class:"q-mt-sm q-mb-md text-h4 text-weight-bolder"},ne={class:"text-color-secondary"},me=P({__name:"RegisterForm",emits:["success"],setup(q,{emit:y}){const j=y,{t:i}=le(),{requiredFieldRule:k}=X(),A=Z(),p=H(()=>A.isSignUpAllowed===!1),a=w({...Q}),l=w({...ee}),n=w({email:"",password:""}),m=E(null),u=E(null),h=E(!1),I=()=>{l.email.hasErrors=!1,l.email.message=null,l.password.hasErrors=!1,l.password.message=null,m.value?.resetValidation(),u.value?.resetValidation()},M=async()=>{I();try{await m.value?.validate(),await u.value?.validate(),m.value?.hasError?m.value?.focus():u.value?.hasError?u.value?.focus():R()}catch(o){console.error("Validation error",o)}},R=()=>{n.email&&n.password?(h.value=!1,Object.assign(a,Q),a.ajaxRunning=!0,W.auth.register(z(),n.email,n.password).then(o=>{h.value=!0,j("success",o.data)}).catch(o=>{if(a.ajaxErrors=!0,o.isAPIError)switch(a.ajaxAPIErrorDetails=o.customAPIErrorDetails,o.response.status){case 400:o.response.data.invalidOrMissingParams.find(function(s){return s==="email"})?(a.ajaxErrorMessage="API Error: missing email param",_().then(()=>{m.value?.focus()}).catch(s=>{console.error(s)})):o.response.data.invalidOrMissingParams.find(function(s){return s==="password"})?(a.ajaxErrorMessage="API Error: missing password param",_().then(()=>{u.value?.focus()}).catch(s=>{console.error(s)})):(a.ajaxErrorMessage="API Error: invalid/missing param",_().then(()=>{m.value?.focus()}).catch(s=>{console.error(s)}));break;case 409:l.email.hasErrors=!0,l.email.message="Email already used",_().then(()=>{m.value?.focus()}).catch(s=>{console.error(s)});break;default:a.ajaxErrorMessage="API Error: fatal error";break}else a.ajaxErrorMessage=`Uncaught exception: ${o}`,console.error(o)}).finally(()=>{a.ajaxRunning=!1})):console.error("Missing email|password values")};return(o,s)=>{const C=J("router-link");return f(),L("form",{onSubmit:K(M,["prevent","stop"]),autocorrect:"off",autocapitalize:"off",autocomplete:"off",spellcheck:"false"},[e(c,{class:"text-center"},{default:t(()=>[e($,{square:"",size:"128px"},{default:t(()=>[...s[2]||(s[2]=[g("img",{src:"icons/favicon-128x128.png"},null,-1)])]),_:1}),g("h4",ie,d(r(i)("Sign up now and take control.")),1),g("div",ne,d(r(i)("The first step to a more organized you starts here!")),1)]),_:1}),e(c,null,{default:t(()=>[e(r(T),{dense:"",outlined:"",ref_key:"emailRef",ref:m,modelValue:n.email,"onUpdate:modelValue":s[0]||(s[0]=x=>n.email=x),type:"email",name:"email",label:r(i)("Email"),disable:a.ajaxRunning||p.value,autofocus:!0,rules:[r(k)],"lazy-rules":"",error:l.email.hasErrors,"error-message":l.email.message?r(i)(l.email.message):""},{prepend:t(()=>[e(F,{name:"alternate_email"})]),_:1},8,["modelValue","label","disable","rules","error","error-message"]),e(ae,{dense:"",outlined:"",ref_key:"passwordRef",ref:u,class:"q-mt-md",modelValue:n.password,"onUpdate:modelValue":s[1]||(s[1]=x=>n.password=x),name:"password",label:r(i)("Password"),disable:a.ajaxRunning||p.value,rules:[r(k)],"lazy-rules":"",error:l.password.hasErrors,"error-message":l.password.message?r(i)(l.password.message):""},null,8,["modelValue","label","disable","rules","error","error-message"])]),_:1}),e(c,null,{default:t(()=>[e(V,{color:"primary",size:"md",label:o.$t("Sign up"),"no-caps":"",class:"full-width",icon:"account_circle",disable:a.ajaxRunning||!(n.email&&n.password)||p.value,loading:a.ajaxRunning,type:"submit"},{loading:t(()=>[e(O,{class:"on-left"}),b(" "+d(r(i)("Sign up")),1)]),_:1},8,["label","disable","loading"]),p.value?(f(),v(S,{key:0,text:"New sign ups are not allowed on this system",error:"",class:"q-mt-lg"})):h.value?(f(),v(S,{key:1,text:"Your account has been created",success:"",class:"q-mt-lg"},{details:t(()=>[e(V,{size:"sm",color:"primary",class:"float-right",label:r(i)("Sign in"),to:"{ name: 'login'}"},null,8,["label"])]),_:1})):a.ajaxErrors&&a.ajaxErrorMessage?(f(),v(U,{key:2,text:a.ajaxErrorMessage,"api-error":a.ajaxAPIErrorDetails,class:"q-mt-lg"},null,8,["text","api-error"])):Y("",!0)]),_:1}),e(c,{class:"text-center q-pt-none"},{default:t(()=>[g("div",null,[b(d(r(i)("Already have an account ?"))+" ",1),e(C,{to:{name:"login"},class:"main-app-text-link-hover"},{default:t(()=>[b(d(r(i)("Click here to sign in")),1)]),_:1})])]),_:1}),e(N,{class:"q-mb-sm"}),e(c,{class:"text-center q-py-none"},{default:t(()=>[e(G,{flat:"",square:""},{default:t(()=>[e(se),e(re),e(oe,{label:"@2025 HomeDocs",href:r(te)},null,8,["href"])]),_:1})]),_:1})],32)}}}),qe=P({__name:"RegisterPage",setup(q){return(y,j)=>(f(),v(D,null,{default:t(()=>[e(B,{class:"q-pa-xl",flat:""},{default:t(()=>[e(me)]),_:1})]),_:1}))}});export{qe as default};
