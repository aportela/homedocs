import{d as b,b as d,a as R,c as $}from"./CustomErrorBanner.vue_vue_type_script_setup_true_lang-a2ZcyAYi.js";import{Q as z,a as C}from"./QItem-D4EQvWHO.js";import{Q as U,a as D}from"./QInput-CMfaQJRq.js";import{Q as F}from"./QBtn-BcnWqC13.js";import{Q as G}from"./ClosePopup-CzXLbngJ.js";import{a as L,h as _,i as j,j as k,e as r,k as x,w as n,a4 as N,b as g,u as s,c as y,l as E,t as f,r as O,m as T,o as h,n as p}from"./index-BSZHI2pT.js";import{a as H}from"./api-DiLYfQz-.js";import{u as J}from"./useFormUtils-BHIP2RWg.js";import{u as W}from"./axios-RI6aZEej.js";import{e as V,G as K}from"./localStorage-dsyGJO5t.js";import{d as X,_ as Y}from"./PasswordFieldCustomInput.vue_vue_type_script_setup_true_lang-DbxBbCd5.js";import{_ as Z,a as aa,b as ea}from"./GitHubButton.vue_vue_type_script_setup_true_lang-BcximOKn.js";import{u as sa}from"./vue-i18n.runtime-C1BpSJts.js";const ra={class:"q-mt-sm q-mb-md text-h4 text-weight-bolder"},oa={class:"text-color-secondary"},ta={key:0},xa=L({__name:"LoginForm",props:{showExtraBottom:{type:Boolean,default:!0}},emits:["success"],setup(I,{emit:S}){const A=S,{t:i}=sa(),{requiredFieldRule:w}=J(),P=W(),e=_({...b}),o=_({...X}),c=V.get(),l=_({email:c||"",password:""}),m=j(null),u=j(null),Q=()=>{o.email.hasErrors=!1,o.email.message=null,o.password.hasErrors=!1,o.password.message=null,m.value?.resetValidation(),u.value?.resetValidation()},M=async()=>{Q();try{await m.value?.validate(),await u.value?.validate(),m.value?.hasError?m.value?.focus():u.value?.hasError?u.value?.focus():q()}catch(t){console.error("Validation error",t)}},q=()=>{l.email&&l.password?(Object.assign(e,b),e.ajaxRunning=!0,H.auth.login(l.email,l.password).then(t=>{V.set(l.email),A("success",t.data)}).catch(t=>{if(e.ajaxErrors=!0,t.isAPIError)switch(e.ajaxAPIErrorDetails=t.customAPIErrorDetails,t.response.status){case 400:t.response.data.invalidOrMissingParams.find(function(a){return a==="email"})?(e.ajaxErrorMessage="API Error: missing email param",p().then(()=>{m.value?.focus()}).catch(a=>{console.error(a)})):t.response.data.invalidOrMissingParams.find(function(a){return a==="password"})?(e.ajaxErrorMessage="API Error: missing password param",p().then(()=>{u.value?.focus()}).catch(a=>{console.error(a)})):(e.ajaxErrorMessage="API Error: invalid/missing param",p().then(()=>{m.value?.focus()}).catch(a=>{console.error(a)}));break;case 404:o.email.hasErrors=!0,o.email.message="Email not registered",p().then(()=>{m.value?.focus()}).catch(a=>{console.error(a)});break;case 401:o.password.hasErrors=!0,o.password.message="Invalid password",p().then(()=>{u.value?.focus()}).catch(a=>{console.error(a)});break;default:e.ajaxErrorMessage="API Error: fatal error";break}else e.ajaxErrorMessage=`Uncaught exception: ${t}`,console.error(t)}).finally(()=>{e.ajaxRunning=!1})):console.error("Missing email|password values")};return(t,a)=>{const B=O("router-link");return h(),k("form",{onSubmit:T(M,["prevent","stop"]),autocorrect:"off",autocapitalize:"off",autocomplete:"off",spellcheck:"false"},[r(d,{class:"text-center"},{default:n(()=>[r(R,{square:"",size:"128px"},{default:n(()=>[...a[2]||(a[2]=[g("img",{src:"icons/favicon-128x128.png"},null,-1)])]),_:1}),N(t.$slots,"slogan",{},()=>[g("h4",ra,f(s(i)(s(c)?"Glad to see you again!":"Welcome aboard!")),1),g("div",oa,f(s(i)(s(c)?"Let's get back to organizing.":"Let's start organizing.")),1)])]),_:3}),r(d,null,{default:n(()=>[r(s(U),{dense:"",outlined:"",ref_key:"emailRef",ref:m,modelValue:l.email,"onUpdate:modelValue":a[0]||(a[0]=v=>l.email=v),type:"email",name:"email",label:s(i)("Email"),disable:e.ajaxRunning,autofocus:!s(c),rules:[s(w)],"lazy-rules":"",error:o.email.hasErrors,"error-message":o.email.message?s(i)(o.email.message):""},{prepend:n(()=>[r(z,{name:"alternate_email"})]),_:1},8,["modelValue","label","disable","autofocus","rules","error","error-message"]),r(Y,{dense:"",outlined:"",ref_key:"passwordRef",ref:u,class:"q-mt-md",modelValue:l.password,"onUpdate:modelValue":a[1]||(a[1]=v=>l.password=v),name:"password",label:s(i)("Password"),disable:e.ajaxRunning,autofocus:!!s(c),rules:[s(w)],"lazy-rules":"",error:o.password.hasErrors,"error-message":o.password.message?s(i)(o.password.message):""},null,8,["modelValue","label","disable","autofocus","rules","error","error-message"])]),_:1}),r(d,null,{default:n(()=>[r(F,{color:"primary",size:"md",label:t.$t("Sign in"),"no-caps":"",class:"full-width",icon:"account_circle",disable:e.ajaxRunning||!(l.email&&l.password),loading:e.ajaxRunning,type:"submit"},{loading:n(()=>[r(D,{class:"on-left"}),E(" "+f(s(i)("Sign in")),1)]),_:1},8,["label","disable","loading"]),e.ajaxErrors&&e.ajaxErrorMessage?(h(),y($,{key:0,text:e.ajaxErrorMessage,"api-error":e.ajaxAPIErrorDetails,class:"q-mt-lg"},null,8,["text","api-error"])):x("",!0)]),_:1}),I.showExtraBottom?(h(),k("div",ta,[s(P).isSignUpAllowed?(h(),y(d,{key:0,class:"text-center q-pt-none"},{default:n(()=>[g("div",null,[E(f(s(i)("Don't have an account yet ?"))+" ",1),r(B,{to:{name:"register"},class:"main-app-text-link-hover"},{default:n(()=>[E(f(s(i)("Click here to sign up")),1)]),_:1})])]),_:1})):x("",!0),r(C,{class:"q-mb-sm"}),r(d,{class:"text-center q-py-none"},{default:n(()=>[r(G,{flat:"",square:""},{default:n(()=>[r(Z),r(aa),r(ea,{label:"@2025 HomeDocs",href:s(K)},null,8,["href"])]),_:1})]),_:1})])):x("",!0)],32)}}});export{xa as _};
