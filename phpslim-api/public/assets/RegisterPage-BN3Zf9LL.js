import{a as $,b as c,Q as U}from"./QCardSection-D9IAel0T.js";import{Q as z}from"./QPage-DEClcuiE.js";import{Q as B,a as D}from"./use-timeout-f6zK2_pC.js";import{Q as F}from"./QSpinnerHourglass-BgEsDQI1.js";import{Q}from"./QBtn-DS5wVTGT.js";import{Q as N}from"./ClosePopup-luNe27os.js";import{a as q,b as T,j as O,k as w,l as E,r as G,n as H,o as f,h as e,w as t,f as g,t as d,g as r,e as v,p as J,q as b,G as L,s as Y,v as _}from"./index-B-UYWWpq.js";import{d as S,_ as V,a as K,u as W}from"./CustomErrorBanner.vue_vue_type_script_setup_true_lang-Cj3i-oR3.js";import{Q as X}from"./QInput-pN4J6sFa.js";import{a as Z}from"./api-CM3iwbFc.js";import{u as ee}from"./useFormUtils-Dvne9-JV.js";import{u as ae}from"./serverEnvironment-DKulyRMn.js";import{d as se,_ as re}from"./PasswordFieldCustomInput.vue_vue_type_script_setup_true_lang-q2uWuT6K.js";import{_ as oe,a as te,b as le}from"./GitHubButton.vue_vue_type_script_setup_true_lang-B2e99P-n.js";import"./_plugin-vue_export-helper-B9cH7pQ5.js";import"./QItem-bsDUXGQF.js";import"./scroll-D_X1SM_z.js";import"./index-CG2WSiiR.js";import"./darkMode-DJpuHzA4.js";const ne={class:"q-mt-sm q-mb-md text-h4 text-weight-bolder"},ie={class:"text-color-secondary"},me=q({__name:"RegisterForm",emits:["success"],setup(P,{emit:y}){const j=y,{t:n}=T(),{requiredFieldRule:k}=ee(),A=ae(),p=O(()=>A.isSignUpAllowed===!1),a=w({...S}),l=w({...se}),i=w({email:"",password:""}),m=E(null),u=E(null),h=E(!1),I=()=>{l.email.hasErrors=!1,l.email.message=null,l.password.hasErrors=!1,l.password.message=null,m.value?.resetValidation(),u.value?.resetValidation()},M=async()=>{I();try{await m.value?.validate(),await u.value?.validate(),m.value?.hasError?m.value?.focus():u.value?.hasError?u.value?.focus():R()}catch(o){console.error("Validation error",o)}},R=()=>{i.email&&i.password?(h.value=!1,Object.assign(a,S),a.ajaxRunning=!0,Z.auth.register(W(),i.email,i.password).then(o=>{h.value=!0,j("success",o.data)}).catch(o=>{if(a.ajaxErrors=!0,o.isAPIError)switch(a.ajaxAPIErrorDetails=o.customAPIErrorDetails,o.response.status){case 400:o.response.data.invalidOrMissingParams.find(function(s){return s==="email"})?(a.ajaxErrorMessage="API Error: missing email param",_().then(()=>{m.value?.focus()}).catch(s=>{console.error(s)})):o.response.data.invalidOrMissingParams.find(function(s){return s==="password"})?(a.ajaxErrorMessage="API Error: missing password param",_().then(()=>{u.value?.focus()}).catch(s=>{console.error(s)})):(a.ajaxErrorMessage="API Error: invalid/missing param",_().then(()=>{m.value?.focus()}).catch(s=>{console.error(s)}));break;case 409:l.email.hasErrors=!0,l.email.message="Email already used",_().then(()=>{m.value?.focus()}).catch(s=>{console.error(s)});break;default:a.ajaxErrorMessage="API Error: fatal error";break}else a.ajaxErrorMessage=`Uncaught exception: ${o}`,console.error(o)}).finally(()=>{a.ajaxRunning=!1})):console.error("Missing email|password values")};return(o,s)=>{const C=G("router-link");return f(),H("form",{onSubmit:Y(M,["prevent","stop"]),autocorrect:"off",autocapitalize:"off",autocomplete:"off",spellcheck:"false"},[e(c,{class:"text-center"},{default:t(()=>[e($,{square:"",size:"128px"},{default:t(()=>[...s[2]||(s[2]=[g("img",{src:"icons/favicon-128x128.png"},null,-1)])]),_:1}),g("h4",ne,d(r(n)("Sign up now and take control.")),1),g("div",ie,d(r(n)("The first step to a more organized you starts here!")),1)]),_:1}),e(c,null,{default:t(()=>[e(r(X),{autofocus:"",dense:"",outlined:"",ref_key:"emailRef",ref:m,modelValue:i.email,"onUpdate:modelValue":s[0]||(s[0]=x=>i.email=x),type:"email",name:"email",label:r(n)("Email"),disable:a.ajaxRunning||p.value,rules:[r(k)],"lazy-rules":"",error:l.email.hasErrors,"error-message":l.email.message?r(n)(l.email.message):""},{prepend:t(()=>[e(B,{name:"alternate_email"})]),_:1},8,["modelValue","label","disable","rules","error","error-message"]),e(re,{dense:"",outlined:"",ref_key:"passwordRef",ref:u,class:"q-mt-md",modelValue:i.password,"onUpdate:modelValue":s[1]||(s[1]=x=>i.password=x),name:"password",label:r(n)("Password"),disable:a.ajaxRunning||p.value,rules:[r(k)],"lazy-rules":"",error:l.password.hasErrors,"error-message":l.password.message?r(n)(l.password.message):""},null,8,["modelValue","label","disable","rules","error","error-message"])]),_:1}),e(c,null,{default:t(()=>[e(Q,{color:"primary",size:"md",label:o.$t("Sign up"),"no-caps":"",class:"full-width",icon:"account_circle",disable:a.ajaxRunning||!(i.email&&i.password)||p.value,loading:a.ajaxRunning,type:"submit"},{loading:t(()=>[e(F,{class:"on-left"}),b(" "+d(r(n)("Sign up")),1)]),_:1},8,["label","disable","loading"]),p.value?(f(),v(V,{key:0,text:"New sign ups are not allowed on this system",error:"",class:"q-mt-lg"})):h.value?(f(),v(V,{key:1,text:"Your account has been created",success:"",class:"q-mt-lg"},{details:t(()=>[e(Q,{size:"sm",color:"primary",class:"float-right",label:r(n)("Sign in"),to:"{ name: 'login'}"},null,8,["label"])]),_:1})):a.ajaxErrors&&a.ajaxErrorMessage?(f(),v(K,{key:2,text:a.ajaxErrorMessage,"api-error":a.ajaxAPIErrorDetails,class:"q-mt-lg"},null,8,["text","api-error"])):J("",!0)]),_:1}),e(c,{class:"text-center q-pt-none"},{default:t(()=>[g("div",null,[b(d(r(n)("Already have an account ?"))+" ",1),e(C,{to:{name:"login"},class:"main-app-text-link-hover"},{default:t(()=>[b(d(r(n)("Click here to sign in")),1)]),_:1})])]),_:1}),e(D,{class:"q-mb-sm"}),e(c,{class:"text-center q-py-none"},{default:t(()=>[e(N,{flat:"",square:""},{default:t(()=>[e(oe),e(te),e(le,{label:"@2025 HomeDocs",href:r(L)},null,8,["href"])]),_:1})]),_:1})],32)}}}),qe=q({__name:"RegisterPage",setup(P){return(y,j)=>(f(),v(z,null,{default:t(()=>[e(U,{class:"q-pa-xl",flat:""},{default:t(()=>[e(me)]),_:1})]),_:1}))}});export{qe as default};
