import{Q as h,_ as S}from"./QItem-D4EQvWHO.js";import{a as N}from"./date-time-BzOgC_OT.js";import{a as O,i as x,g as Q,h as y,M as U,z as L,j as k,c as f,b as z,N as _,k as H,t as C,u as r,w as s,e as g,l as T,Z as X,P as V,O as B,X as Z,a4 as G,n as J,o as l}from"./index-BSZHI2pT.js";import{d as K}from"./QMarkupTable-o0JdIHH4.js";import{a as E}from"./QItemLabel-D2xHNXGJ.js";import{a as W}from"./api-DiLYfQz-.js";import{d as q}from"./CustomErrorBanner.vue_vue_type_script_setup_true_lang-a2ZcyAYi.js";import{_ as Y}from"./BrowseByTagButton.vue_vue_type_script_setup_true_lang-DVpKc6yV.js";import{u as ee}from"./vue-i18n.runtime-C1BpSJts.js";import{_ as ae}from"./_plugin-vue_export-helper-BidlGddk.js";const te={class:"readonly-label"},oe=O({__name:"InteractiveTagsFieldCustomSelect",props:{startModeEditable:{type:Boolean,default:!1},denyChangeEditableMode:{type:Boolean,default:!1},modelValue:{},disabled:{type:Boolean,default:!1},dense:{type:Boolean},label:{default:"Document tags"}},emits:["update:modelValue","error"],setup(o,{expose:F,emit:R}){const{t:i}=ee(),j=o,I=R,p=x(!1),u=x(!j.startModeEditable),d=x(null),c=Q({get(){return j.modelValue||[]},set(e){I("update:modelValue",e||[])}}),a=y({...q}),m=y([]),v=y([]);function $(e,n){const t=e===""?m:m.filter(b=>b.toLowerCase().includes(e.toLowerCase()));n(()=>{v.length=0,v.push(...t)})}function w(){a.ajaxRunning||(Object.assign(a,q),a.ajaxRunning=!0,W.tag.search().then(e=>{m.length=0,m.push(...e.data.tags)}).catch(e=>{if(a.ajaxErrors=!0,e.isAPIError)switch(a.ajaxAPIErrorDetails=e.customAPIErrorDetails,e.response.status){case 401:a.ajaxErrorMessage="Auth session expired, requesting new...",E.emit("reAuthRequired",{emitter:"InteractiveTagsFieldCustomSelect"});break;default:a.ajaxErrorMessage="API Error: fatal error";break}else a.ajaxErrorMessage=`Uncaught exception: ${e}`,console.error(e);I("error",e.response)}).finally(()=>{a.ajaxRunning=!1}))}function P(){d.value?.hidePopup(),d.value?.reset(),d.value?.updateInputValue("")}function D(e){c.value?.splice(e,1)}function A(){J().then(()=>{d.value?.focus()}).catch(e=>{console.error(e)})}F({focus:A});function M(){u.value=!u.value,u.value||A()}return U(()=>{w(),E.on("reAuthSucess",e=>{e.to?.includes("InteractiveTagsFieldCustomSelect")&&w()})}),L(()=>{E.off("reAuthSucess")}),(e,n)=>u.value?(l(),k("div",{key:0,class:"cursor-pointer q-pa-sm relative-position white-space-pre-line read-only-input-container",onMouseenter:n[0]||(n[0]=t=>p.value=!0),onMouseleave:n[1]||(n[1]=t=>p.value=!1),onClick:M},[z("div",te,C(r(i)(o.label)),1),o.denyChangeEditableMode?H("",!0):_((l(),f(h,{key:0,name:"edit",size:"sm",class:"absolute-top-right text-grey cursor-pointer q-mr-sm q-mt-sm"},{default:s(()=>[g(S,null,{default:s(()=>[T(C(r(i)("Click to toggle edit mode")),1)]),_:1})]),_:1},512)),[[X,p.value]]),(l(!0),k(V,null,B(c.value,t=>(l(),f(Y,{key:t,tag:t,icon:"tag"},null,8,["tag"]))),128))],32)):(l(),f(r(K),{key:1,ref_key:"selectRef",ref:d,label:r(i)(o.label),modelValue:c.value,"onUpdate:modelValue":n[2]||(n[2]=t=>c.value=t),dense:o.dense,"options-dense":o.dense,outlined:"","use-input":"","use-chips":"",multiple:"","hide-dropdown-icon":"",options:v,"input-debounce":"0","new-value-mode":"add-unique",disable:o.disabled||a.ajaxRunning||a.ajaxErrors,loading:a.ajaxRunning,error:a.ajaxErrors,"error-message":r(i)("Error loading available tags"),onFilter:$,onAdd:P},Z({prepend:s(()=>[G(e.$slots,"prepend",{},()=>[g(h,{name:"tag"})],!0)]),selected:s(()=>[(l(!0),k(V,null,B(c.value,(t,b)=>(l(),f(N,{square:"",removable:!u.value,dense:o.dense,key:t,onRemove:ne=>D(b),color:"primary","text-color":"white",icon:"tag",label:t},null,8,["removable","dense","onRemove","label"]))),128))]),_:2},[o.denyChangeEditableMode?void 0:{name:"append",fn:s(()=>[g(h,{name:"done",class:"cursor-pointer",onClick:M},{default:s(()=>[g(S,null,{default:s(()=>[T(C(r(i)("Click to toggle edit mode")),1)]),_:1})]),_:1})]),key:"0"}]),1032,["label","modelValue","dense","options-dense","options","disable","loading","error","error-message"]))}}),pe=ae(oe,[["__scopeId","data-v-4e812150"]]);export{pe as I};
