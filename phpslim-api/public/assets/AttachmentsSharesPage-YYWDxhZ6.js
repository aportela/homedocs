import{Q as q}from"./QPagination-C7wUspy7.js";import{Q as x}from"./use-timeout-DkasoO3K.js";import{Q as L}from"./QMarkupTable-dLO-rbtN.js";import{Q as S}from"./QPage-D7l9ccLP.js";import{a as d,f as F}from"./bus-DAajsxXE.js";import{d as E,a as O,_ as H}from"./CustomErrorBanner.vue_vue_type_script_setup_true_lang-Djury_rv.js";import{f as y,t as h,c as Y,a as w}from"./dateUtils-ByXmAri9.js";import{a as G}from"./api-qyRpSTvW.js";import{S as J,P as K}from"./pager-B5QX6AQA.js";import{a as W,b as X,k as b,j as k,_ as Z,l as I,R as ee,D as ae,e as P,w as D,n as i,p as g,h as c,f as s,U as V,T as Q,o as r,a2 as te,q as A,t as n,g as o}from"./index-DMsogX6U.js";import"./QBtn-DDXB9RTL.js";import"./_plugin-vue_export-helper-Kd_RiLXS.js";import"./QInput-B3L3nXvc.js";import"./serverEnvironment-BTbd5MTw.js";import"./index-CG2WSiiR.js";const se={key:2},oe={key:0,class:"q-ma-md flex flex-center"},le=["onClick"],re=["onClick"],ne={class:"text-left"},ie={class:"q-my-sm"},de={class:"q-my-sm"},me={class:"text-left"},ce={class:"text-left"},ue={class:"q-my-sm"},fe={class:"q-my-sm"},pe={class:"text-left"},ge={key:0},_e={class:"q-my-sm"},xe={key:0,class:"q-my-sm"},he={key:1,class:"q-my-sm"},ke={class:"text-right"},Ae={key:0},ye={class:"text-left"},be={key:0},Pe={class:"q-my-sm"},Ce={class:"q-my-sm"},Te={key:1,class:"q-ma-md flex flex-center"},Se=W({__name:"AttachmentsSharesPage",setup(ve){const{t:f}=X(),B=[{field:"createdAtTimestamp",title:"Created on",defaultClass:""},{field:"enabled",title:"Enabled",defaultClass:""},{field:"documentTitle",title:"Shared element",defaultClass:""},{field:"expiresAtTimestamp",title:"Expires on",defaultClass:""},{field:"accessCount",title:"Access count",defaultClass:"text-right"},{field:"lastAccessTimestamp",title:"Most recent access",defaultClass:""}],p=b(new J("createdAtTimestamp","createdAtTimestamp","DESC")),M=k(()=>p.order==="ASC"?"keyboard_double_arrow_up":"keyboard_double_arrow_down"),t=b({...E}),_=Z([]),C=I(!1),R=k(()=>_.value.length>0),U=k(()=>!t.ajaxRunning&&t.ajaxErrors),z=k(()=>!t.ajaxRunning&&C.value&&!R.value),l=b(new K(1,16,0,0)),T=I(!1),v=m=>{l.currentPageIndex=m,u(!1)},N=(m,a)=>{t.ajaxRunning||(p.toggle(m,a),u(!1))},u=m=>{m&&(l.currentPageIndex=1),Object.assign(t,E),t.ajaxRunning=!0,G.attachmentShare.search(l,p,T.value).then(a=>{a.data.sharedAttachments&&(_.value=[],_.value=a.data.sharedAttachments.map(e=>e),a.data.pager&&(l.currentPageIndex=a.data.pager?.currentPageIndex,l.resultsPage=a.data.pager?.resultsPage,l.totalResults=a.data.pager?.totalResults,l.totalPages=a.data.pager?.totalPages,T.value=!0),C.value=!0)}).catch(a=>{if(t.ajaxErrors=!0,a.isAPIError)switch(t.ajaxAPIErrorDetails=a.customAPIErrorDetails,a.response.status){case 400:t.ajaxErrorMessage="API Error: invalid/missing param";break;case 401:t.ajaxErrors=!1,d.emit("reAuthRequired",{emitter:"AdvancedSearchPage.onSubmitForm"});break;default:t.ajaxErrorMessage="API Error: fatal error";break}else t.ajaxErrorMessage=`Uncaught exception: ${a}`,console.error(a)}).finally(()=>{t.ajaxRunning=!1})},$=m=>{d.emit("showAttachmentShareDialog",{attachmentId:m,create:!1})};return ee(()=>{d.on("attachmentShareAdded",()=>{u(!0)}),d.on("attachmentShareChanged",()=>{u(!1)}),d.on("attachmentShareDeleted",()=>{u(!1)}),u(!0)}),ae(()=>{d.off("reAuthSucess"),d.off("attachmentShareAdded"),d.off("attachmentShareChanged"),d.off("attachmentShareDeleted")}),(m,a)=>(r(),P(S,null,{default:D(()=>[U.value?(r(),P(O,{key:0,text:t.ajaxErrorMessage||"Error loading data","api-error":t.ajaxAPIErrorDetails,class:"q-ma-md"},null,8,["text","api-error"])):z.value?(r(),P(H,{key:1,warning:"",text:"You haven't created any share yet",class:"q-ma-md"})):(r(),i("div",se,[l.totalPages>1?(r(),i("div",oe,[c(q,{modelValue:l.currentPageIndex,"onUpdate:modelValue":[a[0]||(a[0]=e=>l.currentPageIndex=e),v],color:"dark",max:l.totalPages,"max-pages":5,"boundary-numbers":"","direction-links":"","boundary-links":"",disable:t.ajaxRunning,class:"theme-default-q-pagination"},null,8,["modelValue","max","disable"])])):g("",!0),c(L,null,{default:D(()=>[s("thead",null,[s("tr",null,[(r(),i(V,null,Q(B,(e,j)=>s("th",{key:j,class:te(["text-left",e.defaultClass,{"cursor-not-allowed":t.ajaxRunning,"cursor-pointer":!t.ajaxRunning,"action-primary":p.field===e.field}]),onClick:je=>N(e.field)},[c(x,{name:p.field===e.field?M.value:"sort",size:"sm"},null,8,["name"]),A(" "+n(o(f)(e.title)),1)],10,le)),64))])]),s("tbody",null,[(r(!0),i(V,null,Q(_.value,e=>(r(),i("tr",{key:e.id,class:"cursor-pointer",onClick:j=>$(e.attachment.id)},[s("td",ne,[s("p",ie,n(o(y)(e.createdAtTimestamp)),1),s("p",de,"("+n(o(f)(o(h)(e.createdAtTimestamp).label,{count:o(h)(e.createdAtTimestamp).count}))+") ",1)]),s("td",me,[c(x,{class:"text-weight-bold",size:"sm",name:e.enabled?"done":"block"},null,8,["name"])]),s("td",ce,[s("p",ue,[c(x,{name:"file_download",class:"q-mr-sm"}),A(n(e.attachment.name)+" ("+n(o(F).humanStorageSize(e.attachment.size))+")",1)]),s("p",fe,[c(x,{name:"work",class:"q-mr-sm"}),A(n(e.document.title),1)])]),s("td",pe,[e.expiresAtTimestamp?(r(),i("div",ge,[s("p",_e,n(o(y)(e.expiresAtTimestamp)),1),e.expiresAtTimestamp>o(Y)()?(r(),i("p",xe,"("+n(o(f)(o(w)(e.expiresAtTimestamp).label,{count:o(w)(e.expiresAtTimestamp).count}))+") ",1)):(r(),i("p",he,n(o(f)("(expired)")),1))])):g("",!0)]),s("td",ke,[A(n(e.accessCount||0),1),e.accessLimit?(r(),i("span",Ae,"/"+n(e.accessLimit),1)):g("",!0)]),s("td",ye,[e.lastAccessTimestamp?(r(),i("div",be,[s("p",Pe,n(o(y)(e.lastAccessTimestamp)),1),s("p",Ce,"("+n(o(f)(o(h)(e.lastAccessTimestamp).label,{count:o(h)(e.lastAccessTimestamp).count}))+")",1)])):g("",!0)])],8,re))),128))])]),_:1}),l.totalPages>1?(r(),i("div",Te,[c(q,{modelValue:l.currentPageIndex,"onUpdate:modelValue":[a[1]||(a[1]=e=>l.currentPageIndex=e),v],color:"dark",max:l.totalPages,"max-pages":5,"boundary-numbers":"","direction-links":"","boundary-links":"",disable:t.ajaxRunning,class:"theme-default-q-pagination"},null,8,["modelValue","max","disable"])])):g("",!0)]))]),_:1}))}});export{Se as default};
