import{A as T,a as k}from"./index-CG2WSiiR.js";import{a8 as D,a9 as i,am as f}from"./index-DMsogX6U.js";const h=i("showToolTips",!1),u=i("alwaysOpenUploadDialog",!0),l=i("dateFormat","YYYY/MM/DD"),p=i("dateTimeFormat","YYYY/MM/DD HH:mm:ss"),d=i("searchDialogResultsPage",8),A=D("session",{state:()=>({session:{accessToken:{token:null,expiresAtTimestamp:null},other:{toolTips:h.get(),alwaysOpenUploadDialog:u.get(),dateFormat:l.get(),dateTimeFormat:p.get(),searchDialogResultsPage:d.get()}}}),getters:{hasAccessToken:e=>e.session.accessToken.token!==null&&e.session.accessToken.expiresAtTimestamp!==null,accessToken:e=>e.session.accessToken.token,accessTokenExpirationTimestamp:e=>e.session.accessToken.expiresAtTimestamp,toolTipsEnabled:e=>e.session.other.toolTips,openUploadDialog:e=>e.session.other.alwaysOpenUploadDialog,savedDateFormat:e=>e.session.other.dateFormat,savedDateTimeFormat:e=>e.session.other.dateTimeFormat,searchDialogResultsPage:e=>e.session.other.searchDialogResultsPage},actions:{async refreshAccessToken(){try{const e=await w.auth.renewAccessToken();return this.setAccessToken(e.data.accessToken.token,e.data.accessToken.expiresAtTimestamp),!0}catch(e){return e instanceof T?e.response?.status!==401&&console.error("Invalid error http response code",e.status):console.error("Invalid error response",e),!1}},accessTokenExpiresBeforeInterval(e){if(this.session.accessToken.expiresAtTimestamp){const t=Math.round(Date.now()/1e3);return this.session.accessToken.expiresAtTimestamp-t<=e}else return!1},setAccessToken(e,t){this.session.accessToken.token=e,this.session.accessToken.expiresAtTimestamp=t},removeAccessToken(){this.session.accessToken.token=null,this.session.accessToken.expiresAtTimestamp=null},toggleToolTips(e){this.session.other.toolTips=e,h.set(this.session.other.toolTips)},setOpenUploadDialog(e){this.session.other.alwaysOpenUploadDialog=e,u.set(this.session.other.alwaysOpenUploadDialog)},setDateFormat(e){this.session.other.dateFormat=e,l.set(this.session.other.dateFormat)},removeDateFormat(){this.session.other.dateFormat="YYYY/MM/DD",l.remove()},setDateTimeFormat(e){this.session.other.dateTimeFormat=e,p.set(this.session.other.dateTimeFormat)},removeDateTimeFormat(){this.session.other.dateTimeFormat="YYYY/MM/DD HH:mm:ss",p.remove()},setSearchDialogResultsPage(e){this.session.other.searchDialogResultsPage=e,d.set(this.session.other.searchDialogResultsPage)}}}),c=A(),s=k.create({baseURL:f});s.interceptors.request.use(e=>(c.hasAccessToken&&(e.headers.Authorization=`Bearer ${c.accessToken}`,e.withCredentials=!0),e),e=>{throw e});s.interceptors.response.use(e=>e,e=>{throw e?(e.response||(e.response={status:0,statusText:"undefined"}),e.response?.status===401&&c.hasAccessToken&&c.removeAccessToken(),e.isAPIError=e.response.headers["content-type"]=="application/json"&&e.response.data.APIError===!0,e.customAPIErrorDetails={method:e.config?.method||"N/A",url:e.request?.responseURL||"N/A",httpCode:e.response?.status||"N/A",httpStatus:e.response?.statusText||"Unknown error",contentType:e.response.headers["content-type"],request:{params:{query:e.config.params||null,data:e.config.data||null}},response:e.response.data||null},e):new Error("Unknown API error")});const F=async(e,t="fileName")=>{const a=Date.now(),o=await s.get(e,{responseType:"blob"}),n=new Blob([o.data]),r=document.createElement("a"),m=URL.createObjectURL(n);r.href=m,r.download=t,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(m);const g=Date.now();return{fileName:t,url:e,mimeType:n.type,length:n.size,msTime:g-a}},w={common:{getServerEnvironment:()=>s.get("/server_environment")},auth:{login:function(e,t){const a={email:e,password:t};return s.post("/auth/login",a)},renewAccessToken:function(){return s.post("/auth/renew_access_token")},logout:()=>s.post("/auth/logout"),register:function(e,t,a){const o={id:e,email:t,password:a};return s.post("/auth/register",o)}},user:{getProfile:()=>s.get("/user/profile"),setProfile:function(e,t){const a={email:e,password:t};return s.put("/user/profile",a)}},document:{searchRecent:function(e){const t={count:e};return s.post("/search/recent_documents",t)},search:function(e,t,a,o,n){const r={pager:e,filter:t,sort:a,returnFragments:o,skipCount:n};return s.post("/search/document",r)},add:function(e){const t={id:e.id,title:e.title,description:e.description||null,tags:e.tags||[],attachments:e.attachments||[],notes:e.notes||[]};return s.post("/document/"+e.id,t)},update:function(e){const t={id:e.id,title:e.title,description:e.description||null,tags:e.tags||[],attachments:e.attachments||[],notes:e.notes||[]};return s.put("/document/"+e.id,t)},remove:e=>s.delete("/document/"+e),get:e=>s.get("/document/"+e),getNotes:e=>s.get("/document/"+e+"/notes"),getAttachments:e=>s.get("/document/"+e+"/attachments"),removeFile:e=>s.delete("/attachment/"+e)},tag:{getCloud:()=>s.get("/tag-cloud"),search:()=>s.get("/tags")},stats:{documentCount:()=>s.get("/stats/total-published-documents"),attachmentCount:()=>s.get("/stats/total-uploaded-attachments"),attachmentDiskSize:()=>s.get("/stats/total-uploaded-attachments-disk-usage"),getActivityHeatMapData:e=>s.get("/stats/heatmap-activity-data",{params:{fromTimestamp:e||null}})},attachmentShare:{create:e=>s.post(`/attachment/${e}/share`),update:(e,t,a,o)=>{const n={enabled:t,expiresAtTimestamp:a,accessLimit:o};return s.put(`/attachment/${e}/share`,n)},remove:e=>s.delete(`/attachment/${e}/share`),get:e=>s.get(`/attachment/${e}/share`),search:function(e,t,a){const o={pager:e,sort:t,skipCount:a};return s.post("/search/attachment_share",o)}}};export{w as a,F as b,A as u};
