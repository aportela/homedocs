import{d as b,b as d,a as z,c as C}from"./CustomErrorBanner.vue_vue_type_script_setup_true_lang-DAGmktG4.js";import{Q as R,a as U}from"./QItem-COEiYpOr.js";import{Q as D,a as F}from"./QInput-DfsDjK3U.js";import{Q as T}from"./QBtn-DYGdk6J_.js";import{Q as G}from"./ClosePopup-IZA4X7XD.js";import{a as L,h as _,i as k,j,e as r,k as x,w as n,a5 as N,b as g,u as s,c as y,l as E,t as f,r as O,m as H,o as h,n as p}from"./index-DWyQQ7Hn.js";import{a as J}from"./api-BbjIOG7d.js";import{u as W}from"./useFormUtils-CW5fdy9P.js";import{u as K}from"./serverEnvironment-D3pJtLW6.js";import{u as X}from"./session-DarTIjXU.js";import{e as S,G as Y}from"./localStorage-BRK9taKx.js";import{d as Z,_ as ee}from"./PasswordFieldCustomInput.vue_vue_type_script_setup_true_lang-OMNcIr_y.js";import{_ as ae,a as se,b as re}from"./GitHubButton.vue_vue_type_script_setup_true_lang-sr7gsxAi.js";import{u as oe}from"./vue-i18n.runtime-CD4rYiPD.js";const te={class:"q-mt-sm q-mb-md text-h4 text-weight-bolder"},le={class:"text-color-secondary"},ne={key:0},be=L({__name:"LoginForm",props:{showExtraBottom:{type:Boolean,default:!0}},emits:["success"],setup(V,{emit:A}){const I=A,{t:i}=oe(),{requiredFieldRule:w}=W(),P=K(),Q=X(),a=_({...b}),t=_({...Z}),c=S.get(),l=_({email:c||"",password:""}),m=k(null),u=k(null),M=()=>{t.email.hasErrors=!1,t.email.message=null,t.password.hasErrors=!1,t.password.message=null,m.value?.resetValidation(),u.value?.resetValidation()},q=async()=>{M();try{await m.value?.validate(),await u.value?.validate(),m.value?.hasError?m.value?.focus():u.value?.hasError?u.value?.focus():B()}catch(o){console.error("Validation error",o)}},B=()=>{l.email&&l.password?(Object.assign(a,b),a.ajaxRunning=!0,J.auth.login(l.email,l.password).then(o=>{Q.setAccessToken(o.data.accessToken),S.set(l.email),I("success",o.data)}).catch(o=>{if(a.ajaxErrors=!0,o.isAPIError)switch(a.ajaxAPIErrorDetails=o.customAPIErrorDetails,o.response.status){case 400:o.response.data.invalidOrMissingParams.find(function(e){return e==="email"})?(a.ajaxErrorMessage="API Error: missing email param",p().then(()=>{m.value?.focus()}).catch(e=>{console.error(e)})):o.response.data.invalidOrMissingParams.find(function(e){return e==="password"})?(a.ajaxErrorMessage="API Error: missing password param",p().then(()=>{u.value?.focus()}).catch(e=>{console.error(e)})):(a.ajaxErrorMessage="API Error: invalid/missing param",p().then(()=>{m.value?.focus()}).catch(e=>{console.error(e)}));break;case 404:t.email.hasErrors=!0,t.email.message="Email not registered",p().then(()=>{m.value?.focus()}).catch(e=>{console.error(e)});break;case 401:t.password.hasErrors=!0,t.password.message="Invalid password",p().then(()=>{u.value?.focus()}).catch(e=>{console.error(e)});break;default:a.ajaxErrorMessage="API Error: fatal error";break}else a.ajaxErrorMessage=`Uncaught exception: ${o}`,console.error(o)}).finally(()=>{a.ajaxRunning=!1})):console.error("Missing email|password values")};return(o,e)=>{const $=O("router-link");return h(),j("form",{onSubmit:H(q,["prevent","stop"]),autocorrect:"off",autocapitalize:"off",autocomplete:"off",spellcheck:"false"},[r(d,{class:"text-center"},{default:n(()=>[r(z,{square:"",size:"128px"},{default:n(()=>[...e[2]||(e[2]=[g("img",{src:"icons/favicon-128x128.png"},null,-1)])]),_:1}),N(o.$slots,"slogan",{},()=>[g("h4",te,f(s(i)(s(c)?"Glad to see you again!":"Welcome aboard!")),1),g("div",le,f(s(i)(s(c)?"Let's get back to organizing.":"Let's start organizing.")),1)])]),_:3}),r(d,null,{default:n(()=>[r(s(D),{dense:"",outlined:"",ref_key:"emailRef",ref:m,modelValue:l.email,"onUpdate:modelValue":e[0]||(e[0]=v=>l.email=v),type:"email",name:"email",label:s(i)("Email"),disable:a.ajaxRunning,autofocus:!s(c),rules:[s(w)],"lazy-rules":"",error:t.email.hasErrors,"error-message":t.email.message?s(i)(t.email.message):""},{prepend:n(()=>[r(R,{name:"alternate_email"})]),_:1},8,["modelValue","label","disable","autofocus","rules","error","error-message"]),r(ee,{dense:"",outlined:"",ref_key:"passwordRef",ref:u,class:"q-mt-md",modelValue:l.password,"onUpdate:modelValue":e[1]||(e[1]=v=>l.password=v),name:"password",label:s(i)("Password"),disable:a.ajaxRunning,autofocus:!!s(c),rules:[s(w)],"lazy-rules":"",error:t.password.hasErrors,"error-message":t.password.message?s(i)(t.password.message):""},null,8,["modelValue","label","disable","autofocus","rules","error","error-message"])]),_:1}),r(d,null,{default:n(()=>[r(T,{color:"primary",size:"md",label:o.$t("Sign in"),"no-caps":"",class:"full-width",icon:"account_circle",disable:a.ajaxRunning||!(l.email&&l.password),loading:a.ajaxRunning,type:"submit"},{loading:n(()=>[r(F,{class:"on-left"}),E(" "+f(s(i)("Sign in")),1)]),_:1},8,["label","disable","loading"]),a.ajaxErrors&&a.ajaxErrorMessage?(h(),y(C,{key:0,text:a.ajaxErrorMessage,"api-error":a.ajaxAPIErrorDetails,class:"q-mt-lg"},null,8,["text","api-error"])):x("",!0)]),_:1}),V.showExtraBottom?(h(),j("div",ne,[s(P).isSignUpAllowed?(h(),y(d,{key:0,class:"text-center q-pt-none"},{default:n(()=>[g("div",null,[E(f(s(i)("Don't have an account yet ?"))+" ",1),r($,{to:{name:"register"},class:"main-app-text-link-hover"},{default:n(()=>[E(f(s(i)("Click here to sign up")),1)]),_:1})])]),_:1})):x("",!0),r(U,{class:"q-mb-sm"}),r(d,{class:"text-center q-py-none"},{default:n(()=>[r(G,{flat:"",square:""},{default:n(()=>[r(ae),r(se),r(re,{label:"@2025 HomeDocs",href:s(Y)},null,8,["href"])]),_:1})]),_:1})])):x("",!0)],32)}}});export{be as _};
