import{Q as y,_ as B}from"./QItem-COEiYpOr.js";import{a as L}from"./date-time-DmKSRVDV.js";import{a as _,i as g,g as V,h as k,M as H,z as Y,j as C,c as v,b as G,N as J,k as K,t as E,u as r,w as l,e as p,l as F,_ as W,P as $,O as R,Y as X,a5 as Z,n as ee,o as n}from"./index-DWyQQ7Hn.js";import{d as ae}from"./QMarkupTable-HKvvEuLV.js";import{a as j}from"./QItemLabel-C3K2K-_T.js";import{a as te}from"./api-BbjIOG7d.js";import{d as q}from"./CustomErrorBanner.vue_vue_type_script_setup_true_lang-DAGmktG4.js";import{_ as oe}from"./BrowseByTagButton.vue_vue_type_script_setup_true_lang-BygX_w0b.js";import{u as se}from"./vue-i18n.runtime-CD4rYiPD.js";import{_ as le}from"./_plugin-vue_export-helper-CbIelGhP.js";const ne={class:"readonly-label"},re=_({__name:"InteractiveTagsFieldCustomSelect",props:{startModeEditable:{type:Boolean,default:!1},denyChangeEditableMode:{type:Boolean,default:!1},modelValue:{},disabled:{type:Boolean,default:!1},dense:{type:Boolean},label:{default:"Document tags"}},emits:["update:modelValue","error"],setup(s,{expose:N,emit:P}){const{t:i}=se(),w=s,I=P,h=g(!1),d=g(!w.startModeEditable),u=g(null),c=V({get(){return w.modelValue||[]},set(e){I("update:modelValue",e||[])}}),a=k({...q}),f=k([]),b=k([]),m=g(!1),D=V(()=>m.value?"Only lowercase letters, numbers and hyphens are allowed in tags":"Error loading available tags"),O=(e,o)=>{const t=/^[0-9a-z-]*$/;m.value=e.length>0&&!t.test(e);const x=e===""?f:f.filter(A=>A.toLowerCase().includes(e.toLowerCase()));o(()=>{b.length=0,e.length>0&&!m.value&&b.push(...x)})},Q=(e,o)=>{m.value||o(e)},T=()=>{a.ajaxRunning||(Object.assign(a,q),a.ajaxRunning=!0,te.tag.search().then(e=>{f.length=0,f.push(...e.data.tags)}).catch(e=>{if(a.ajaxErrors=!0,e.isAPIError)switch(a.ajaxAPIErrorDetails=e.customAPIErrorDetails,e.response.status){case 401:a.ajaxErrors=!1,j.emit("reAuthRequired",{emitter:"InteractiveTagsFieldCustomSelect"});break;default:a.ajaxErrorMessage="API Error: fatal error";break}else a.ajaxErrorMessage=`Uncaught exception: ${e}`,console.error(e);I("error",e.response)}).finally(()=>{a.ajaxRunning=!1}))},U=()=>{u.value?.hidePopup(),u.value?.reset(),u.value?.updateInputValue("")},z=e=>{c.value?.splice(e,1)},M=()=>{ee().then(()=>{u.value?.focus()}).catch(e=>{console.error(e)})};N({focus:M});const S=()=>{d.value=!d.value,d.value||M()};return H(()=>{T(),j.on("reAuthSucess",e=>{e.to?.includes("InteractiveTagsFieldCustomSelect")&&T()})}),Y(()=>{j.off("reAuthSucess")}),(e,o)=>d.value?(n(),C("div",{key:0,class:"cursor-pointer q-pa-sm relative-position white-space-pre-line read-only-input-container",onMouseenter:o[0]||(o[0]=t=>h.value=!0),onMouseleave:o[1]||(o[1]=t=>h.value=!1),onClick:S},[G("div",ne,E(r(i)(s.label)),1),s.denyChangeEditableMode?K("",!0):J((n(),v(y,{key:0,name:"edit",size:"sm",class:"absolute-top-right text-grey cursor-pointer q-mr-sm q-mt-sm"},{default:l(()=>[p(B,null,{default:l(()=>[F(E(r(i)("Click to toggle edit mode")),1)]),_:1})]),_:1},512)),[[W,h.value]]),(n(!0),C($,null,R(c.value,t=>(n(),v(oe,{key:t,tag:t,icon:"tag"},null,8,["tag"]))),128))],32)):(n(),v(r(ae),{key:1,ref_key:"selectRef",ref:u,label:r(i)(s.label),modelValue:c.value,"onUpdate:modelValue":o[2]||(o[2]=t=>c.value=t),dense:s.dense,"options-dense":s.dense,outlined:"","use-input":"","use-chips":"",multiple:"","hide-dropdown-icon":"",options:b,"input-debounce":"0","new-value-mode":"add-unique",disable:s.disabled||a.ajaxRunning||a.ajaxErrors,loading:a.ajaxRunning,error:a.ajaxErrors||m.value,"error-message":r(i)(D.value),onFilter:O,onAdd:U,onNewValue:Q},X({prepend:l(()=>[Z(e.$slots,"prepend",{},()=>[p(y,{name:"tag"})],!0)]),selected:l(()=>[(n(!0),C($,null,R(c.value,(t,x)=>(n(),v(L,{square:"",removable:!d.value,dense:s.dense,key:t,onRemove:A=>z(x),color:"primary","text-color":"white",icon:"tag",label:t},null,8,["removable","dense","onRemove","label"]))),128))]),_:2},[s.denyChangeEditableMode?void 0:{name:"append",fn:l(()=>[p(y,{name:"done",class:"cursor-pointer",onClick:S},{default:l(()=>[p(B,null,{default:l(()=>[F(E(r(i)("Click to toggle edit mode")),1)]),_:1})]),_:1})]),key:"0"}]),1032,["label","modelValue","dense","options-dense","options","disable","loading","error","error-message"]))}}),be=le(re,[["__scopeId","data-v-f31666fe"]]);export{be as I};
